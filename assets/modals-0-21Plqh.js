function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./compose--6BTTL3e.js","./vendor-YNBWu-Mz.js","./index-_Y-Lyw2n.js","./db-Nrs-L85u.js","./useTitle-6bgur48O.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{a as U,c as C,s as l,j as pe,L as B,i as fe,_ as ge}from"./useTitle-6bgur48O.js";import{y as se,d as me,a as e,g as x,f as Y,M as be,b as j,F as z,p as A,_ as G,r as ie,q as ae,I as ye,e as we,U as ve,D as ke}from"./vendor-YNBWu-Mz.js";import{I as v,A as Se,N as Ae,d as le,c as Z,L as oe,x as ce,y as Ce,z as X,s as E,R as Me,r as V,n as _e,S as re,g as de,B as K,D as Te,G as xe,T as Ie,M as T}from"./db-Nrs-L85u.js";import{l as Le,i as Pe,b as Re,u as Q,c as ee,A as Ee,f as De,M as $e,S as Ne,d as Oe}from"./main-k_RAxOWG.js";import{I as Ue}from"./intl-segmenter-suspense-5Aqbh6LB.js";function ze({onClose:t}){const{masto:i}=U(),o=C.local.getJSON("accounts"),r=C.session.get("currentAccount"),c=o.length>1,[m,d]=se(a=>a+1,0),[b]=me();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(v,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:b,children:o.map((a,h)=>{const p=a.info.id===r,s=h===0;return e("li",{children:[e("div",{children:[c&&e("span",{class:`current ${p?"is-current":""}`,children:e(v,{icon:"check-circle",alt:"Current"})}),e(Se,{url:a.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(p)try{const u=await i.v1.accounts.$select(a.info.id).fetch();a.info=u,C.local.setJSON("accounts",o),d()}catch{}}}),e(Ae,{account:c?{...a.info,acct:/@/.test(a.info.acct)?a.info.acct:`${a.info.acct}@${a.instanceURL}`}:a.info,showAcct:!0,onClick:()=>{p?l.showAccount=`${a.info.username}@${a.instanceURL}`:(C.session.set("currentAccount",a.info.id),location.reload())}})]}),e("div",{class:"actions",children:[s&&c&&e(x,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(le,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(v,{icon:"more",size:"l",alt:"More"})}),children:[e(Y,{onClick:()=>{l.showAccount=`${a.info.username}@${a.instanceURL}`},children:[e(v,{icon:"user"}),e("span",{children:"View profile…"})]}),e(be,{}),c&&e(Y,{disabled:s,onClick:()=>{o.splice(h,1),o.unshift(a),C.local.setJSON("accounts",o),d()},children:[e(v,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Z,{subMenu:!0,confirmLabel:e(x,{children:[e(v,{icon:"exit"}),e("span",{children:["Log out @",a.info.acct,"?"]})]}),disabled:!p,menuItemClassName:"danger",onClick:()=>{o.splice(h,1),C.local.setJSON("accounts",o),location.href=location.pathname||"/"},children:[e(v,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},a.info.id)})}),e("p",{children:e(oe,{to:"/login",class:"button plain2",onClick:t,children:[e(v,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),c&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}var Ge={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const te=16,O=[14,15,16,17,18,19,20],{PHANPY_WEBSITE:ne,PHANPY_PRIVACY_POLICY_URL:He,PHANPY_IMG_ALT_API_URL:qe}=Ge;function Fe({onClose:t}){const i=j(l),o=C.local.get("theme")||"auto",r=z(),c=i.settings.contentTranslationTargetLanguage||null,m=ce(),d=Ce(m),b=C.local.get("textSize")||te,[a,h]=A(C.account.get("preferences")||{}),{masto:p,authenticated:s,instance:u}=U();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:r,onInput:n=>{n.preventDefault();const y=new FormData(r.current).get("theme"),k=document.documentElement;if(y==="auto"){k.classList.remove("is-light","is-dark");const g=document.querySelector('meta[data-theme-setting="manual"]');g&&(g.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(M=>{M.name="theme-color"})}else{k.classList.toggle("is-light",y==="light"),k.classList.toggle("is-dark",y==="dark");const g=document.querySelector('meta[data-theme-setting="manual"]');g&&(g.name="theme-color",g.content=y==="light"?g.dataset.themeLightColor:g.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(M=>{M.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",y==="auto"?"dark light":y),y==="auto"?C.local.del("theme"):C.local.set("theme",y)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:o==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:o==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:o!=="light"&&o!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:O[0]},children:"A"})," ",e("input",{type:"range",min:O[0],max:O[O.length-1],step:"1",value:b,list:"sizes",onChange:n=>{const f=parseInt(n.target.value,10);document.documentElement.style.setProperty("--text-size",`${f}px`),f===te?C.local.del("textSize"):C.local.set("textSize",n.target.value)}})," ",e("span",{style:{fontSize:O[O.length-1]},children:"A"}),e("datalist",{id:"sizes",children:O.map(n=>e("option",{value:n}))})]})]})]})}),s&&e(x,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(v,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:a["posting:default:visibility"]||"public",onChange:n=>{const{value:f}=n.target;(async()=>{try{await p.v1.accounts.updateCredentials({source:{privacy:f}}),h({...a,"posting:default:visibility":f}),C.account.set("preferences",{...a,"posting:default:visibility":f})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(v,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${u}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",u,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:i.settings.autoRefresh,onChange:n=>{l.settings.autoRefresh=n.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:i.settings.boostsCarousel,onChange:n=>{l.settings.boostsCarousel=n.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:i.settings.contentTranslation,onChange:n=>{const{checked:f}=n.target;l.settings.contentTranslation=f,f||(l.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${i.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:c||"",disabled:!i.settings.contentTranslation,onChange:n=>{l.settings.contentTranslationTargetLanguage=n.target.value||null},children:[e("option",{value:"",children:["System language (",d,")"]}),e("option",{disabled:!0,children:"──────────"}),X.map(n=>e("option",{value:n.code,children:n.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',i.settings.contentTranslationHideLanguages.length>0&&e(x,{children:[" ","(",i.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:X.map(n=>e("label",{children:[e("input",{type:"checkbox",checked:i.settings.contentTranslationHideLanguages.includes(n.code),onChange:f=>{const{checked:y}=f.target;y?l.settings.contentTranslationHideLanguages.push(n.code):l.settings.contentTranslationHideLanguages=i.settings.contentTranslationHideLanguages.filter(k=>k!==n.code)}})," ",n.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses external translation services, powered by"," ",e("a",{href:"https://github.com/cheeaun/lingva-api",target:"_blank",rel:"noopener noreferrer",children:"Lingva API"})," ","&"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:i.settings.contentTranslationAutoInline,disabled:!i.settings.contentTranslation,onChange:n=>{l.settings.contentTranslationAutoInline=n.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),!!qe&&s&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:i.settings.mediaAltGenerator,onChange:n=>{l.settings.mediaAltGenerator=n.target.checked}})," ","Image description generator"," ",e(v,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Only for new images while composing new posts."})}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external AI service, powered by"," ",e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener noreferrer",children:"img-alt-api"}),". May not work well. Only for images and in English."]})})]}),s&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:i.settings.shortcutSettingsCloudImportExport,onChange:n=>{l.settings.shortcutSettingsCloudImportExport=n.target.checked}})," ",'"Cloud" import/export for shortcuts settings'," ",e(v,{icon:"cloud",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["⚠️⚠️⚠️ Very experimental.",e("br",{}),"Stored in your own profile’s notes. Profile (private) notes are mainly used for other profiles, and hidden for own profile."]})}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Note: This feature uses currently-logged-in instance server API."})})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:i.settings.cloakMode,onChange:n=>{l.settings.cloakMode=n.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),s&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{l.showDrafts=!0,l.showSettings=!1},children:"Unsent drafts"})})]})}),s&&e(Ve,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:Le,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:n=>{n.preventDefault(),l.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:n=>{n.preventDefault(),l.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:He,target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[ne&&e(x,{children:[e("span",{class:"insignificant",children:"Site:"})," ",ne.replace(/https?:\/\//g,"").replace(/\/$/,""),e("br",{})]}),e("span",{class:"insignificant",children:"Version:"})," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2024-03-28T12:55:56.404Z".slice(0,10).replace(/-/g,".")}.ecd308c`,onClick:n=>{n.target.select();try{navigator.clipboard.writeText(n.target.value),E("Version string copied")}catch{E("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/ecd308c",target:"_blank",rel:"noopener noreferrer",children:e(Me,{datetime:new Date("2024-03-28T12:55:56.404Z")})}),")"]})]})]})]})]})}function Ve({onClose:t}){if(!Pe())return null;const{instance:i}=U(),[o,r]=A("default"),c=z(),[m,d]=A(!1),[b,a]=A(!1),h=z();G(()=>{(async()=>{r("loading");try{const{subscription:s,backendSubscription:u}=await Re();if(u!=null&&u.policy&&u.policy!=="none"){d(!0);const{alerts:n,policy:f}=u;h.current=f;const{elements:y}=c.current,k=y.namedItem("policy");k&&(k.value=f),Object.keys(n).forEach(g=>{const S=y.namedItem(g);(S==null?void 0:S.type)==="checkbox"&&(S.checked=!0)})}r("default")}catch(s){/outside.*authorized/i.test(s.message)?a(!0):alert((s==null?void 0:s.message)||s),r("error")}})()},[]);const p=o==="loading";return e("form",{ref:c,onChange:()=>{setTimeout(()=>{const s=Object.fromEntries(new FormData(c.current)),u=!!s["policy-allow"],n={data:{policy:s.policy,alerts:{mention:!!s.mention,favourite:!!s.favourite,reblog:!!s.reblog,follow:!!s.follow,follow_request:!!s.followRequest,poll:!!s.poll,update:!!s.update,status:!!s.status}}};let f=0;Object.keys(n.data.alerts).forEach(k=>{n.data.alerts[k]?f++:delete n.data.alerts[k]});const y=h.current!==n.data.policy;u&&f>0?y?ee().then(()=>{Q(n)}).catch(k=>{alert("Failed to update subscription. Please try again.")}):Q(n).catch(k=>{alert("Failed to update subscription. Please try again.")}):ee().catch(k=>{alert("Failed to remove subscription. Please try again.")})},100)},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:p||b,name:"policy-allow",checked:m,onChange:async s=>{const{checked:u}=s.target;if(u){const n=await Notification.requestPermission();n==="granted"?d(!0):(d(!1),n==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else d(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:p||b||!m,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(s=>e("option",{value:s.value,children:s.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!m,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(s=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:s.value})," ",s.label]})}))})})})}),b&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(oe,{to:`/login?instance=${i}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}function he(t){if(!t)return;const i=ie(),o=z(i.pathname);G(()=>{o.current&&i.pathname!==o.current&&(t==null||t())},[i.pathname,t])}function Be({account:t,instance:i,onClose:o}){const{masto:r,instance:c,authenticated:m}=U({instance:i}),d=typeof t=="string";return G(()=>{d||(l.accounts[`${t.id}@${c}`]=t)},[t]),he(o),e("div",{class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close outer",onClick:o,children:e(v,{icon:"x"})}),e(Ee,{instance:c,authenticated:m,account:t,fetchAccount:async()=>{if(d)try{return await r.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const a=await r.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:m});if(a.accounts.length)return a.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const h=new URL(t),{hostname:p,pathname:s}=h,u=s.replace(/^\//,"").replace(/\/$/,"")+"@"+p,n=await r.v2.search.fetch({q:u,type:"accounts",limit:1,resolve:m});if(n.accounts.length)return n.accounts[0]}}else return t}})]})}function Ye({onClose:t}){const{masto:i}=U(),[o,r]=A("default"),[c,m]=A([]),[d,b]=se(h=>h+1,0);G(()=>{r("loading"),(async()=>{try{const h=await V.drafts.keys();if(h.length){const p=pe(),s=h.filter(u=>u.startsWith(p));if(s.length){const u=await V.drafts.getMany(s);u.sort((n,f)=>new Date(f.updatedAt).getTime()-new Date(n.updatedAt).getTime()),m(u)}else m([])}else m([]);r("default")}catch{r("error")}})()},[d]);const a=(c==null?void 0:c.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(v,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(B,{abrupt:!0,hidden:o!=="loading"})]}),a&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:a?e(x,{children:[e("ul",{class:"drafts-list",children:c.map(h=>{const{updatedAt:p,key:s,draftStatus:u,replyTo:n}=h,f=new Date(p);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(v,{icon:n?"reply":"quill",size:"s"})," ",e("time",{children:[!!n&&e(x,{children:["@",n.account.acct,e("br",{})]}),_e(f)]})]}),e(Z,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:o==="loading",onClick:()=>{(async()=>{try{await V.drafts.del(s),b()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:o==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:o==="loading",class:"draft-item",onClick:async()=>{let y;if(n){r("loading");try{y=await i.v1.statuses.$select(n.id).fetch()}catch{alert("Error fetching reply-to status!"),r("default");return}r("default")}window.__COMPOSE__={draftStatus:u,replyToStatus:y},l.showCompose=!0,l.showDrafts=!1},children:e(je,{draft:h})})]},p)})}),c.length>1&&e("p",{children:e(Z,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:o==="loading",onClick:()=>{(async()=>{r("loading");try{await V.drafts.delMany(c.map(h=>h.key)),r("default"),b()}catch{alert("Error deleting drafts! Please try again."),r("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function je({draft:t}){var s;const{draftStatus:i,replyTo:o}=t,{status:r,spoilerText:c,poll:m,mediaAttachments:d}=i,b=((s=m==null?void 0:m.options)==null?void 0:s.length)>0,a=(d==null?void 0:d.length)>0,h=b||a,p=ae(()=>{if(!a)return;const u=d.find(y=>/image/.test(y.type));if(!u)return;const{file:n}=u;return URL.createObjectURL(n)},[a,d]);return e(x,{children:e("div",{class:"mini-draft",children:[h&&e("div",{class:`mini-draft-aside ${p?"has-image":""}`,style:p?{"--bg-image":`url(${p})`}:{},children:[b&&e(v,{icon:"poll"}),a&&e("span",{children:[e(v,{icon:"attachment"})," ",e("small",{children:d==null?void 0:d.length})]})]}),e("div",{class:"mini-draft-main",children:[!!c&&e("div",{class:"mini-draft-spoiler",children:c}),!!r&&e("div",{class:"mini-draft-status",children:r})]})]})})}function We({html:t,url:i,width:o,height:r,onClose:c=()=>{}}){return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>c(),children:e(v,{icon:"x"})}),i&&e("a",{href:i,target:"_blank",rel:"noopener noreferrer",class:"button plain",children:[e("span",{children:"Open link"})," ",e(v,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:t},style:{"--width":o+"px","--height":r+"px","--aspect-ratio":`${o}/${r}`}})]})}function Je({instance:t,excludeRelationshipAttrs:i=[],postID:o,onClose:r=()=>{}}){const{masto:c,instance:m}=U(),d=t?t===m:!0,b=j(l),[a,h]=A("default"),[p,s]=A([]),[u,n]=A(!1);if(he(r),!b.showGenericAccounts)return null;const{id:f,heading:y,fetchAccounts:k,accounts:g,showReactions:S}=b.showGenericAccounts,[M,$]=A({}),P=async w=>{if(!(w!=null&&w.length)||!d)return;const R=await De(w,M);R&&$({...M,...R})},I=w=>{k&&(w&&s([]),h("loading"),(async()=>{try{const{done:R,value:N}=await k(w);if(Array.isArray(N)){if(w){const D=[];for(let _=0;_<N.length;_++){const L=N[_],q=D.find((J,ue)=>J.id===L.id&&_!==ue);q?q._types.push(...L._types):D.push({_types:[],...L})}s(D)}else s(D=>{const _=D;for(const L of N){const q=_.find(J=>J.id===L.id);q?q._types.push(...L._types):_.push(L)}return _});n(!R),P(N)}else n(!1);h("default")}catch{h("error")}})())},H=z(!0);G(()=>{(g==null?void 0:g.length)>0?(s(g),P(g)):(I(!0),H.current=!1)},[g,k]),G(()=>{var w;H.current||((w=b.reloadGenericAccounts)==null?void 0:w.id)===f&&I(!0)},[b.reloadGenericAccounts.counter]);const W=l.statuses[o];return e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:r,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:y||"Accounts"})}),e("main",{children:[W&&e("div",{class:"post-preview",children:e(re,{status:W,size:"s",readOnly:!0})}),p.length>0?e(x,{children:[e("ul",{class:"accounts-list",children:p.map(w=>{var D,_;const R=M[w.id],N=`${w.id}-${((D=w._types)==null?void 0:D.length)||""}`;return e("li",{children:[S&&((_=w._types)==null?void 0:_.length)>0&&e("div",{class:"reactions-block",children:w._types.map(L=>e(v,{icon:{reblog:"rocket",favourite:"heart"}[L],class:`${L}-icon`}))}),e("div",{class:"account-relationships",children:e(de,{account:w,showStats:!0,relationship:R,excludeRelationshipAttrs:i})})]},N)})}),a==="default"?u?e(ye,{onChange:w=>{w&&I()},children:e("button",{type:"button",class:"plain block",onClick:()=>I(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):a==="loading"&&e("p",{class:"ui-state",children:e(B,{abrupt:!0})})]}):a==="loading"?e("p",{class:"ui-state",children:e(B,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})]})]})}function Ze({alt:t,lang:i,onClose:o}){const r=j(l),[c,m]=A(!1),d=ce(!0),b=r.settings.contentTranslationHideLanguages||[],a=!!i&&i!==d&&!K([i],[d])&&!b.find(h=>i===h||K([i],[h]));return e("div",{class:"sheet",tabindex:"-1",children:[!!o&&e("button",{type:"button",class:"sheet-close outer",onClick:o,children:e(v,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(le,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(v,{icon:"more",alt:"More",size:"xl"})}),children:[e(Y,{disabled:c,onClick:()=>{m(!0)},children:[e(v,{icon:"translate"}),e("span",{children:"Translate"})]}),Te&&e(Y,{onClick:()=>{xe(t,i)},children:[e(v,{icon:"speak"}),e("span",{children:"Speak"})]})]})})]}),e("main",{lang:i,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(a||c)&&e(Ie,{forceTranslate:c,sourceLanguage:i,text:t})]})]})}const Xe=[,"spam","legal","violation","other"],F={spam:{label:"Spam",description:"Malicious links, fake engagement, or repetitive replies"},legal:{label:"Illegal",description:"Violates the law of your or the server's country"},violation:{label:"Server rule violation",description:"Breaks specific server rules",stampLabel:"Violation"},other:{label:"Other",description:"Issue doesn't fit other categories",excludeStamp:!0}};function Ke({account:t,post:i,onClose:o}){const{masto:r}=U(),[c,m]=A("default"),[d,b]=t.acct.split("@"),[a,h]=ae(()=>{const{rules:g,domain:S}=fe();return[g||[],S]}),[p,s]=A(null),[u,n]=A(!1),f=z(null),[y,k]=A(!1);return e("div",{class:"report-modal-container",children:[e("div",{class:"top-controls",children:[e("h1",{children:i?"Report Post":`Report @${d}`}),e("button",{type:"button",class:"plain4 small",disabled:c==="loading",onClick:()=>o(),children:e(v,{icon:"x",size:"xl"})})]}),e("main",{children:[e("div",{class:"report-preview",children:i?e(re,{status:i,size:"s",previewMode:!0}):e(de,{account:t,avatarSize:"xxl",useAvatarStatic:!0,showStats:!0,showActivity:!0})}),!!p&&!F[p].excludeStamp&&e("span",{class:"rubber-stamp","aria-hidden":"true",children:[F[p].stampLabel||F[p].label,e("small",{children:"Pending review"})]},p),e("form",{onSubmit:g=>{g.preventDefault();const S=new FormData(g.target),M=Object.fromEntries(S.entries());let{category:$,comment:P,forward:I}=M;P||(P=void 0),I==="on"&&(I=!0);const H=$==="violation"?Object.entries(M).filter(([w])=>w.startsWith("rule_ids")).map(([w,R])=>R):void 0,W={category:$,comment:P,forward:I,ruleIds:H};m("loading"),(async()=>{try{await r.v1.reports.create({accountId:t.id,statusIds:i!=null&&i.id?[i.id]:void 0,category:$,comment:P,ruleIds:H,forward:I}),m("success"),E(i?"Post reported":"Profile reported"),o()}catch(w){m("error"),E((w==null?void 0:w.message)||(i?"Unable to report post":"Unable to report profile"))}})()},children:[e("p",{children:i?"What's the issue with this post?":"What's the issue with this profile?"}),e("section",{class:"report-categories",children:Xe.map(g=>g==="violation"&&!(a!=null&&a.length)?null:e(x,{children:[e("label",{class:"report-category",children:[e("input",{type:"radio",name:"category",value:g,required:!0,disabled:c==="loading",onChange:S=>{s(S.target.value),n(S.target.value==="violation")}}),e("span",{children:[F[g].label,"  ",e("small",{class:"ib insignificant",children:F[g].description})]})]}),g==="violation"&&!!(a!=null&&a.length)&&e("div",{class:"shazam-container no-animation",hidden:!u,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"report-rules",ref:f,children:a.map((S,M)=>e("label",{class:"report-rule",children:[e("input",{type:"checkbox",name:`rule_ids[${M}]`,value:S.id,required:u&&!y,disabled:c==="loading",onChange:$=>{const{checked:P}=$.target;P?k(!0):f.current.querySelectorAll("input:checked").length||k(!1)}}),e("span",{children:S.text})]},S.id))})})})]},g))}),e("section",{class:"report-comment",children:[e("p",{children:e("label",{for:"report-comment",children:"Additional info"})}),e("textarea",{maxlength:"1000",rows:"1",name:"comment",id:"report-comment",disabled:c==="loading"})]}),!!b&&b!==h&&e("section",{children:e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,name:"forward",disabled:c==="loading"})," ",e("span",{children:["Forward to ",e("i",{children:b})]})]})})}),e("footer",{children:[e("button",{type:"submit",disabled:c==="loading",children:"Send Report"})," ",e("button",{type:"submit",class:"plain2",disabled:c==="loading",onClick:async()=>{try{await r.v1.accounts.$select(t.id).mute(),E(`Muted ${d}`)}catch{E(`Unable to mute ${d}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Mute profile"})]})," ",e("button",{type:"submit",class:"plain2",disabled:c==="loading",onClick:async()=>{try{await r.v1.accounts.$select(t.id).block(),E(`Blocked ${d}`)}catch{E(`Unable to block ${d}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Block profile"})]}),e(B,{hidden:c!=="loading"})]})]})]})]})}const Qe=ve(()=>ge(()=>import("./compose--6BTTL3e.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url));ke(l,t=>{for(const[i,o,r,c]of t)/^show/i.test(o)&&!r&&Oe()});function at(){var r,c,m,d,b,a,h,p;const t=j(l),i=we(),o=ie();return e(x,{children:[!!t.showCompose&&e(T,{class:"solid",children:e(Ue,{children:e(Qe,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((r=window.__COMPOSE__)==null?void 0:r.replyToStatus)||null,editStatus:((c=l.showCompose)==null?void 0:c.editStatus)||((m=window.__COMPOSE__)==null?void 0:m.editStatus)||null,draftStatus:((d=l.showCompose)==null?void 0:d.draftStatus)||((b=window.__COMPOSE__)==null?void 0:b.draftStatus)||null,onClose:s=>{const{newStatus:u,instance:n,type:f}=s||{};l.showCompose=!1,window.__COMPOSE__=null,u&&(l.reloadStatusPage++,E({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[f||"post"],delay:1e3,duration:1e4,onClick:y=>{y.hideToast(),l.prevLocation=o,i(n?`/${n}/s/${u.id}`:`/s/${u.id}`)}}))}})})}),!!t.showSettings&&e(T,{onClose:()=>{l.showSettings=!1},children:e(Fe,{onClose:()=>{l.showSettings=!1}})}),!!t.showAccounts&&e(T,{onClose:()=>{l.showAccounts=!1},children:e(ze,{onClose:()=>{l.showAccounts=!1}})}),!!t.showAccount&&e(T,{onClose:()=>{l.showAccount=!1},children:e(Be,{account:((a=t.showAccount)==null?void 0:a.account)||t.showAccount,instance:(h=t.showAccount)==null?void 0:h.instance,onClose:({destination:s}={})=>{l.showAccount=!1}})}),!!t.showDrafts&&e(T,{onClose:()=>{l.showDrafts=!1},children:e(Ye,{onClose:()=>l.showDrafts=!1})}),!!t.showMediaModal&&e(T,{onClick:s=>{(s.target===s.currentTarget||s.target.classList.contains("media"))&&(l.showMediaModal=!1)},children:e($e,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{l.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(T,{onClose:()=>{l.showShortcutsSettings=!1},children:e(Ne,{onClose:()=>l.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(T,{onClose:()=>{l.showGenericAccounts=!1},children:e(Je,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,postID:t.showGenericAccounts.postID,onClose:()=>l.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(T,{onClose:s=>{l.showMediaAlt=!1},children:e(Ze,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(p=t.showMediaAlt)==null?void 0:p.lang,onClose:()=>{l.showMediaAlt=!1}})}),!!t.showEmbedModal&&e(T,{class:"solid",onClose:()=>{l.showEmbedModal=!1},children:e(We,{html:t.showEmbedModal.html,url:t.showEmbedModal.url,width:t.showEmbedModal.width,height:t.showEmbedModal.height,onClose:()=>{l.showEmbedModal=!1}})}),!!t.showReportModal&&e(T,{onClose:()=>{l.showReportModal=!1},children:e(Ke,{account:t.showReportModal.account,post:t.showReportModal.post,onClose:()=>{l.showReportModal=!1}})})]})}export{at as default};
//# sourceMappingURL=modals-0-21Plqh.js.map
