{"version":3,"file":"compose-J8YjB9bn.js","sources":["../../src/compose.jsx"],"sourcesContent":["import './index.css';\nimport './app.css';\nimport './polyfills';\n\nimport { i18n } from '@lingui/core';\nimport { t, Trans } from '@lingui/macro';\nimport { I18nProvider } from '@lingui/react';\nimport { render } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\n\nimport ComposeSuspense from './components/compose-suspense';\nimport { initActivateLang } from './utils/lang';\nimport { initStates } from './utils/states';\nimport useTitle from './utils/useTitle';\n\ninitActivateLang();\n\nif (window.opener) {\n  console = window.opener.console;\n}\n\nfunction App() {\n  const [uiState, setUIState] = useState('default');\n\n  const { editStatus, replyToStatus, draftStatus } = window.__COMPOSE__ || {};\n\n  useTitle(\n    editStatus\n      ? t`Editing source status`\n      : replyToStatus\n      ? t`Replying to @${\n          replyToStatus.account?.acct || replyToStatus.account?.username\n        }`\n      : t`Compose`,\n  );\n\n  useEffect(() => {\n    initStates();\n  }, []);\n\n  useEffect(() => {\n    if (uiState === 'closed') {\n      try {\n        // Focus parent window\n        window.opener.focus();\n      } catch (e) {}\n      window.close();\n    }\n  }, [uiState]);\n\n  if (uiState === 'closed') {\n    return (\n      <div class=\"box\">\n        <p>\n          <Trans>You may close this page now.</Trans>\n        </p>\n        <p>\n          <button\n            onClick={() => {\n              window.close();\n            }}\n          >\n            <Trans>Close window</Trans>\n          </button>\n        </p>\n      </div>\n    );\n  }\n\n  console.debug('OPEN COMPOSE');\n\n  return (\n    <ComposeSuspense\n      editStatus={editStatus}\n      replyToStatus={replyToStatus}\n      draftStatus={draftStatus}\n      standalone\n      hasOpener={window.opener}\n      onClose={(results) => {\n        const { newStatus, fn = () => {} } = results || {};\n        try {\n          if (newStatus) {\n            window.opener.__STATES__.reloadStatusPage++;\n          }\n          fn();\n          setUIState('closed');\n        } catch (e) {}\n      }}\n    />\n  );\n}\n\nrender(\n  <I18nProvider i18n={i18n}>\n    <App />\n  </I18nProvider>,\n  document.getElementById('app-standalone'),\n);\n"],"names":["initActivateLang","window","opener","console","App","uiState","setUIState","useState","editStatus","replyToStatus","draftStatus","__COMPOSE__","useTitle","i18n","_","id","values","0","account","acct","username","useEffect","initStates","focus","close","_jsxs","class","children","_jsx","Trans","onClick","standalone","hasOpener","newStatus","results","fn","render","I18nProvider"],"mappings":"qHAeAA,IAEIC,OAAOC,SACTC,QAAUF,OAAOC,OAAOC,SAG1B,SAASC,GAAM,SACb,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAS,SAAS,EAE1C,CAAEC,WAAAA,EAAYC,cAAAA,EAAeC,YAAAA,CAAAA,EAAgBT,OAAOU,aAAe,GA0BzE,OAxBAC,EACEJ,EAAUK,EAAAC,EACN,CAAAC,GAAA,QAAuB,CAAA,EACvBN,EAAaI,EAAAC,EACb,CAAAC,GAAA,SAAAC,OAAA,CAAAC,IACER,EAAAA,EAAcS,UAAdT,YAAAA,EAAuBU,SAAQV,EAAAA,EAAcS,UAAdT,YAAAA,EAAuBW,SAAQ,CAC/D,GAACP,EAAAC,EACF,CAAAC,GAAA,QAAS,CAAA,CACf,EAEAM,EAAU,IAAM,CACHC,GACb,EAAG,CAAE,CAAA,EAELD,EAAU,IAAM,CACd,GAAIhB,IAAY,SAAU,CACpB,GAAA,CAEFJ,OAAOC,OAAOqB,aACJ,CAAC,CACbtB,OAAOuB,MAAM,CACf,CAAA,EACC,CAACnB,CAAO,CAAC,EAERA,IAAY,SAEZoB,EAAA,MAAA,CAAKC,MAAM,MAAKC,UACdC,EAAA,IAAA,CAAAD,SACEC,EAAAC,EAAA,CAAAd,GAAA,QAAA,CAA0C,CAAA,CACzC,EACHa,EAAA,IAAA,CAAAD,SACEC,EAAA,SAAA,CACEE,QAASA,IAAM,CACb7B,OAAOuB,MAAM,CACf,EAAEG,SAEFC,EAAAC,EAAA,CAAAd,GAAA,QAAA,CAA0B,CAAA,CACpB,CAAA,CACP,CAAC,CAAA,CACD,EAITZ,IAA4B,CAE5B,WAAAK,EAEIA,cAAAA,EACAC,YAAAA,EACAC,WAAAA,GACAqB,UAAU,OAAA,OACVC,WAAkB9B,OAEV,UAAA+B,EAAEA,GAAAA,EAAAA,IAAAA,EAAsB,EAACC,GAAA,CAAA,EAAE,GAAIA,CACjCD,GACF,OAAe,OAAA,WAAA,mBAEfE,IACG7B,EAAA,QAAA,CACHA,MAAAA,EACW,CAAA,CACf,CAAA,CAGN8B,EAAAR,EAAAS,EAAA,CAEAD,KAAAA,EACgBvB,SAAAA,EAAAA,EAAAA,EAAAA,CAAAA,CAAAA,EACZe,SAAAA,eAAM,gBAAA,CAAA"}