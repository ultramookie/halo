function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./compose-W37-uzig.js","./vendor-YPJA51US.js","./status-RflqUT9k.js","./useTitle-99A2ZsmL.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{s as C,a as K,b as Be,c as ce,g as vt,p as lt,u as Hs,L as $e,d as Ht,e as os,_ as Vs,I as Gs,f as We,h as js,i as qe,j as cs,t as Ys,k as Ws,l as In,m as Ks,n as Cn,o as Tn}from"./useTitle-99A2ZsmL.js";import{F as B,_ as W,p as A,u as Me,w as Ze,a as e,b as Pe,g as R,y as ht,c as ln,M as he,d as Oe,e as It,q as ge,f as Ct,x as Xe,I as ot,A as ct,h as dn,l as xn,U as Zs,s as as,i as rs,j as nt,T as Js,N as Xs,k as Qs,P as ei,J as ti,C as ls,m as ni,n as pt,o as si,r as ii,t as ds,v as oi,z as ci,B as ai,D as Lt,E as us,G as $n,H as ri,R as un,K as Fe,L as li,O as di}from"./vendor-YPJA51US.js";import{u as hn,s as ie,o as ui,I as w,M as _e,A as tt,N as kt,a as Ke,b as Qe,L as ae,g as hs,l as hi,t as An,R as ft,c as ps,d as Je,e as Ee,h as fs,f as tn,E as ms,i as Ge,n as st,S as Vt,j as Rn,T as gs,k as et,m as ze,p as Ln,q as pi,r as fi,v as bs,C as mi,w as gi,F as ys,x as Gt,y as bi,z as Tt,B as pn,D as ws,G as yi,H as Et}from"./status-RflqUT9k.js";function St(t=()=>{},n=[]){const i=B(t);W(()=>{i.current=t},[n]),W(()=>{const s=()=>{const o=document.hidden||document.visibilityState==="hidden";i.current(!o)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[])}const wi=1e3*3,vi=15e3,ki=Ze(function({isLoggedIn:n}){const[i,s]=A(!0);St(s);const o=async(d,r,h)=>{var f;if(C.notificationsLast){const a=d.v1.notifications.list({limit:1,sinceId:C.notificationsLast.id}),{value:p}=await a.next();if(p!=null&&p.length)if(h)C.notificationsShowNew=!0;else{let u;try{const g=await d.v1.markers.fetch({timeline:"notifications"});u=(f=g==null?void 0:g.notifications)==null?void 0:f.lastReadId}catch{}u?C.notificationsShowNew=p[0].id!==u:C.notificationsShowNew=!0}}};W(()=>{let d,r;if(n&&i){const{masto:h,streaming:f,instance:a}=K();(async()=>{await o(h,a);let p=!1;f&&(r=setTimeout(()=>{(async()=>{try{p=!0,d=f.user.notification.subscribe();for await(const u of d){if(!d||!i)break;u.event==="notification"&&Be(u.payload,a,{skipThreading:!0}),C.notificationsShowNew=!0}}catch{p=!1}p||(r=setInterval(()=>{o(h,a,!0)},vi))})()},wi))})()}return()=>{var h;(h=d==null?void 0:d.unsubscribe)==null||h.call(d),d=null,clearTimeout(r),clearInterval(r)}},[i,n]);const c=B(),l=()=>{c.current=Date.now(),fetch("./version.json").then(d=>d.json()).then(d=>{d&&(C.appVersion=d)}).catch(d=>{})};return hn(l,i&&1e3*60*30),St(d=>{d&&(c.current?Date.now()-c.current>1e3*60*60&&l():l())}),Me("shift+alt+k",()=>{const d=C.settings.cloakMode;C.settings.cloakMode=!d,ie({text:`Cloak mode ${d?"disabled":"enabled"}`})}),null}),Si=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function Ii(){if(Si){const t=document.createElement("input");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.opacity="0",document.body.appendChild(t),t.focus(),setTimeout(()=>{document.body.removeChild(t)},500)}}function Ci(){function t(n){n.shiftKey?ui()||(C.showCompose=!0):(Ii(),C.showCompose=!0)}return Me("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const Ti=Ze(function(){const n=Pe(C);function i(){C.showKeyboardShortcutsHelp=!1}return Me("?, shift+?, shift+slash",s=>{C.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:s=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&e(_e,{onClose:i,children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Load new posts",keys:e("kbd",{children:"."})},{action:"Open post details",keys:e(R,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:e(R,{children:["Expand content warning or",e("br",{}),"toggle expanded/collapsed thread"]}),keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(R,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(R,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"c"})]})},{action:"Send post",keys:e(R,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:e(R,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:s,className:o,keys:c})=>e("tr",{children:[e("th",{class:o,children:s}),e("td",{children:c})]},s))})})]})})});function xi({onClose:t}){const{masto:n}=K(),i=ce.local.getJSON("accounts"),s=ce.session.get("currentAccount"),o=i.length>1,[c,l]=ht(r=>r+1,0),[d]=ln();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:d,children:i.map((r,h)=>{const f=r.info.id===s,a=h===0;return e("li",{children:[e("div",{children:[o&&e("span",{class:`current ${f?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(tt,{url:r.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const p=await n.v1.accounts.$select(r.info.id).fetch();r.info=p,ce.local.setJSON("accounts",i),l()}catch{}}}),e(kt,{account:o?{...r.info,acct:/@/.test(r.info.acct)?r.info.acct:`${r.info.acct}@${r.instanceURL}`}:r.info,showAcct:!0,onClick:()=>{f?C.showAccount=`${r.info.username}@${r.instanceURL}`:(ce.session.set("currentAccount",r.info.id),location.reload())}})]}),e("div",{class:"actions",children:[a&&o&&e(R,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ke,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(he,{onClick:()=>{C.showAccount=`${r.info.username}@${r.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(Oe,{}),o&&e(he,{disabled:a,onClick:()=>{i.splice(h,1),i.unshift(r),ce.local.setJSON("accounts",i),l()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Qe,{subMenu:!0,confirmLabel:e(R,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",r.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{i.splice(h,1),ce.local.setJSON("accounts",i),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},r.info.id)})}),e("p",{children:e(ae,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),o&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const fn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e";function _n(t){const{masto:n}=K();return n.v1.push.subscription.create(t)}function $i(){const{masto:t}=K();return t.v1.push.subscription.fetch()}function Ai(t){const{masto:n}=K();return n.v1.push.subscription.update(t)}function Ri(){const{masto:t}=K();return t.v1.push.subscription.remove()}function Wt(){return"serviceWorker"in navigator&&"PushManager"in window}function Li(){return navigator.serviceWorker.getRegistration()}async function mn(){const t=await Li(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function vs(t){const n="=".repeat((4-t.length%4)%4),i=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),s=window.atob(i),o=new Uint8Array(s.length);for(let c=0;c<s.length;++c)o[c]=s.charCodeAt(c);return o}async function _i(){if(!Wt())return;const{subscription:t}=await mn();let n=null;try{n=await $i()}catch(i){if(!/(not found|unknown)/i.test(i.message))throw i}if(n&&t){const i=n.endpoint===t.endpoint,{vapidKey:s}=vt(),o=n.serverKey===s;if(!i)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:i}=vt(),{applicationServerKey:s}=t.options,o=vs(i).toString(),c=new Uint8Array(s).toString();if(!(o===c))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function En({data:t,policy:n}){if(!Wt())return;let{registration:i,subscription:s}=await mn(),o=null;if(s)try{o=await Ai({data:t,policy:n})}catch{o=await _n({subscription:s,data:t,policy:n})}else{const{vapidKey:c}=vt();if(!c)throw new Error("No server key found");s=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:vs(c)}),o=await _n({subscription:s,data:t,policy:n})}return{subscription:s,backendSubscription:o}}async function Mn(){if(!Wt())return;const{subscription:t}=await mn();t&&(await Ri(),await t.unsubscribe())}var Ei={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Dn=16,ut=[14,15,16,17,18,19,20],{PHANPY_WEBSITE:Pn,PHANPY_PRIVACY_POLICY_URL:Mi,PHANPY_IMG_ALT_API_URL:Di,PHANPY_GIPHY_API_KEY:Pi}=Ei;function Ni({onClose:t}){const n=Pe(C),i=ce.local.get("theme")||"auto",s=B(),o=n.settings.contentTranslationTargetLanguage||null,c=hs(),l=hi(c),d=ce.local.get("textSize")||Dn,[r,h]=A(ce.account.get("preferences")||{}),{masto:f,authenticated:a,instance:p}=K();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:s,onInput:u=>{u.preventDefault();const y=new FormData(s.current).get("theme"),S=document.documentElement;if(y==="auto"){S.classList.remove("is-light","is-dark");const m=document.querySelector('meta[data-theme-setting="manual"]');m&&(m.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(I=>{I.name="theme-color"})}else{S.classList.toggle("is-light",y==="light"),S.classList.toggle("is-dark",y==="dark");const m=document.querySelector('meta[data-theme-setting="manual"]');m&&(m.name="theme-color",m.content=y==="light"?m.dataset.themeLightColor:m.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(I=>{I.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",y==="auto"?"dark light":y),y==="auto"?ce.local.del("theme"):ce.local.set("theme",y)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:i==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:i==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:i!=="light"&&i!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:ut[0]},children:"A"})," ",e("input",{type:"range",min:ut[0],max:ut[ut.length-1],step:"1",value:d,list:"sizes",onChange:u=>{const g=parseInt(u.target.value,10);document.documentElement.style.setProperty("--text-size",`${g}px`),g===Dn?ce.local.del("textSize"):ce.local.set("textSize",u.target.value)}})," ",e("span",{style:{fontSize:ut[ut.length-1]},children:"A"}),e("datalist",{id:"sizes",children:ut.map(u=>e("option",{value:u}))})]})]})]})}),a&&e(R,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:r["posting:default:visibility"]||"public",onChange:u=>{const{value:g}=u.target;(async()=>{try{await f.v1.accounts.updateCredentials({source:{privacy:g}}),h({...r,"posting:default:visibility":g}),ce.account.set("preferences",{...r,"posting:default:visibility":g})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${p}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",p,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:u=>{C.settings.autoRefresh=u.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:u=>{C.settings.boostsCarousel=u.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:u=>{const{checked:g}=u.target;C.settings.contentTranslation=g,g||(C.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:o||"",disabled:!n.settings.contentTranslation,onChange:u=>{C.settings.contentTranslationTargetLanguage=u.target.value||null},children:[e("option",{value:"",children:["System language (",l,")"]}),e("option",{disabled:!0,children:"──────────"}),An.map(u=>e("option",{value:u.code,children:u.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(R,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:An.map(u=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(u.code),onChange:g=>{const{checked:y}=g.target;y?C.settings.contentTranslationHideLanguages.push(u.code):C.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(S=>S!==u.code)}})," ",u.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses external translation services, powered by"," ",e("a",{href:"https://github.com/cheeaun/lingva-api",target:"_blank",rel:"noopener noreferrer",children:"Lingva API"})," ","&"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:u=>{C.settings.contentTranslationAutoInline=u.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),!!Pi&&a&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.composerGIFPicker,onChange:u=>{C.settings.composerGIFPicker=u.target.checked}})," ","GIF Picker for composer"]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external GIF search service, powered by"," ",e("a",{href:"https://developers.giphy.com/",target:"_blank",rel:"noopener noreferrer",children:"GIPHY"}),". G-rated (suitable for viewing by all ages), tracking parameters are stripped, referrer information is omitted from requests, but search queries and IP address information will still reach their servers."]})})]}),!!Di&&a&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.mediaAltGenerator,onChange:u=>{C.settings.mediaAltGenerator=u.target.checked}})," ","Image description generator"," ",e(w,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Only for new images while composing new posts."})}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external AI service, powered by"," ",e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener noreferrer",children:"img-alt-api"}),". May not work well. Only for images and in English."]})})]}),a&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.shortcutSettingsCloudImportExport,onChange:u=>{C.settings.shortcutSettingsCloudImportExport=u.target.checked}})," ",'"Cloud" import/export for shortcuts settings'," ",e(w,{icon:"cloud",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["⚠️⚠️⚠️ Very experimental.",e("br",{}),"Stored in your own profile’s notes. Profile (private) notes are mainly used for other profiles, and hidden for own profile."]})}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Note: This feature uses currently-logged-in instance server API."})})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:u=>{C.settings.cloakMode=u.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),a&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{C.showDrafts=!0,C.showSettings=!1},children:"Unsent drafts"})})]})}),a&&e(Ui,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:fn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:u=>{u.preventDefault(),C.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:u=>{u.preventDefault(),C.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:Mi,target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[Pn&&e(R,{children:[e("span",{class:"insignificant",children:"Site:"})," ",Pn.replace(/https?:\/\//g,"").replace(/\/$/,""),e("br",{})]}),e("span",{class:"insignificant",children:"Version:"})," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2024-04-04T11:41:32.789Z".slice(0,10).replace(/-/g,".")}.65d51b0`,onClick:u=>{u.target.select();try{navigator.clipboard.writeText(u.target.value),ie("Version string copied")}catch{ie("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/65d51b0",target:"_blank",rel:"noopener noreferrer",children:e(ft,{datetime:new Date("2024-04-04T11:41:32.789Z")})}),")"]})]})]})]})]})}function Ui({onClose:t}){if(!Wt())return null;const{instance:n}=K(),[i,s]=A("default"),o=B(),[c,l]=A(!1),[d,r]=A(!1),h=B();W(()=>{(async()=>{s("loading");try{const{subscription:a,backendSubscription:p}=await _i();if(p!=null&&p.policy&&p.policy!=="none"){l(!0);const{alerts:u,policy:g}=p;h.current=g;const{elements:y}=o.current,S=y.namedItem("policy");S&&(S.value=g),Object.keys(u).forEach(m=>{const b=y.namedItem(m);(b==null?void 0:b.type)==="checkbox"&&(b.checked=!0)})}s("default")}catch(a){/outside.*authorized/i.test(a.message)?r(!0):alert((a==null?void 0:a.message)||a),s("error")}})()},[]);const f=i==="loading";return e("form",{ref:o,onChange:()=>{setTimeout(()=>{const a=Object.fromEntries(new FormData(o.current)),p=!!a["policy-allow"],u={data:{policy:a.policy,alerts:{mention:!!a.mention,favourite:!!a.favourite,reblog:!!a.reblog,follow:!!a.follow,follow_request:!!a.followRequest,poll:!!a.poll,update:!!a.update,status:!!a.status}}};let g=0;Object.keys(u.data.alerts).forEach(S=>{u.data.alerts[S]?g++:delete u.data.alerts[S]});const y=h.current!==u.data.policy;p&&g>0?y?Mn().then(()=>{En(u)}).catch(S=>{alert("Failed to update subscription. Please try again.")}):En(u).catch(S=>{alert("Failed to update subscription. Please try again.")}):Mn().catch(S=>{alert("Failed to remove subscription. Please try again.")})},100)},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:f||d,name:"policy-allow",checked:c,onChange:async a=>{const{checked:p}=a.target;if(p){const u=await Notification.requestPermission();u==="granted"?l(!0):(l(!1),u==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else l(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:f||d||!c,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(a=>e("option",{value:a.value,children:a.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!c,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(a=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:a.value})," ",a.label]})}))})})})}),d&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(ae,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const nn=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const i=document.querySelectorAll("#modal-container > *");if(i!=null&&i.length){const l=i[i.length-1],d=l.querySelector('[tabindex="-1"]')||l;if(d){d.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),c=o[o.length-1];c&&c.tabIndex===-1&&c.focus()}},100);return()=>clearTimeout(t)};function ks(t){if(!t)return;const n=It(),i=B(n.pathname);W(()=>{i.current&&n.pathname!==i.current&&(t==null||t())},[n.pathname,t])}const Ss=1e3*60,Fi=24*60*60*1e3,sn=lt(async()=>{const{masto:t}=K(),n=await t.v1.lists.list();return n.sort((i,s)=>i.title.localeCompare(s.title)),n.length&&setTimeout(()=>{ce.account.set("lists",{lists:n,updatedAt:Date.now()})},1),n},{maxAge:Ss});async function _t(){try{const{lists:t,updatedAt:n}=ce.account.get("lists")||{};return t!=null&&t.length?(Date.now()-n>Fi&&sn(),t):await sn()}catch{return[]}}const Oi=lt(t=>{const{masto:n}=K();return n.v1.lists.$select(t).fetch()},{maxAge:Ss});async function Is(t){const{lists:n}=ce.account.get("lists")||{};if(n!=null&&n.length){const i=n.find(s=>s.id===t);if(i)return i}try{return Oi(t)}catch{return null}}async function zi(t){const n=await Is(t);return(n==null?void 0:n.title)||""}function Bi(t){const{lists:n}=ce.account.get("lists")||{};n!=null&&n.length&&(n.push(t),n.sort((i,s)=>i.title.localeCompare(s.title)),ce.account.set("lists",{lists:n,updatedAt:Date.now()}))}function qi(t){const{lists:n}=ce.account.get("lists")||{};if(n!=null&&n.length){const i=n.findIndex(s=>s.id===t.id);i!==-1&&(n[i]=t,n.sort((s,o)=>s.title.localeCompare(o.title)),ce.account.set("lists",{lists:n,updatedAt:Date.now()}))}}function Hi(t){const{lists:n}=ce.account.get("lists")||{};if(n!=null&&n.length){const i=n.findIndex(s=>s.id===t);i!==-1&&(n.splice(i,1),ce.account.set("lists",{lists:n,updatedAt:Date.now()}))}}function gn({list:t,onClose:n}){const{masto:i}=K(),[s,o]=A("default"),c=!!t,l=B(),d=B(),r=B();W(()=>{c&&(l.current.value=t.title,d.current.value=t.repliesPolicy,r.current&&(r.current.checked=t.exclusive))},[c]);const h=ps("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:c?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:f=>{f.preventDefault();const a=new FormData(f.target),p=a.get("title"),u=a.get("replies_policy"),g=a.get("exclusive")==="on";o("loading"),(async()=>{try{let y;c?y=await i.v1.lists.$select(t.id).update({title:p,replies_policy:u,exclusive:g}):y=await i.v1.lists.create({title:p,replies_policy:u,exclusive:g}),o("default"),n==null||n({state:"success",list:y}),setTimeout(()=>{c?qi(y):Bi(y)},1)}catch{o("error"),alert(c?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:l,type:"text",id:"list-title",name:"title",required:!0,disabled:s==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:d,name:"replies_policy",required:!0,disabled:s==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),h&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:r,type:"checkbox",name:"exclusive",disabled:s==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:s==="loading",children:c?"Save":"Create"}),c&&e(Qe,{disabled:s==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await i.v1.lists.$select(t.id).remove(),o("default"),n==null||n({state:"deleted"}),setTimeout(()=>{Hi(t.id)},1)}catch{o("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:s==="loading",children:"Delete…"})})]})]})})]})}const Vi=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],Nn={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},Un=80,Cs=1e3*60*10;function Gi(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const ji=lt(Gi,{maxAge:Cs});async function Yi(t,n){const i=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:s}=await i,o={total:s.length,originals:0,replies:0,boosts:0};return s.forEach(c=>{c.reblog?o.boosts++:c.inReplyToId&&c.inReplyToAccountId!==c.account.id?o.replies++:o.originals++}),s.length&&(o.daysSinceLastPost=Math.ceil((Date.now()-new Date(s[s.length-1].createdAt))/864e5)),o}const Wi=lt(Yi,{maxAge:Cs});function Ts({account:t,fetchAccount:n=()=>{},standalone:i,instance:s,authenticated:o}){const{masto:c}=K({instance:s}),{masto:l,instance:d}=K(),[r,h]=A("default"),f=typeof t=="string",[a,p]=A(f?null:t),u=ge(()=>s===d,[s,d]);W(()=>{if(!f){p(t);return}h("loading"),(async()=>{try{const k=await n();C.accounts[`${k.id}@${s}`]=k,p(k),h("default")}catch{p(null),h("error")}})()},[f,t,n]);const{acct:g,avatar:y,avatarStatic:S,bot:m,createdAt:b,displayName:I,emojis:v,fields:T,followersCount:$,followingCount:M,group:V,id:U,lastStatusAt:F,locked:ee,note:E,statusesCount:D,url:x,username:q,memorial:P,moved:oe,roles:Ce}=a||{};let Ie=!1,{header:H,headerStatic:we}=a||{};(!H||/missing\.png$/.test(H))&&y&&!/missing\.png$/.test(y)&&(H=y,Ie=!0,S&&!/missing\.png$/.test(S)&&(we=S));const re=ge(()=>U===ce.session.get("currentAccount"),[U]);W(()=>{const k=!!(a!=null&&a.id&&(a!=null&&a.username)&&(a!=null&&a.acct)&&(a!=null&&a.avatar)&&(a!=null&&a.avatarStatic)&&(a!=null&&a.displayName)&&(a!=null&&a.url));if(re&&s&&k){const N=ce.local.getJSON("accounts");let z=!1;N.forEach(O=>{O.info.id===a.id&&O.instanceURL===s&&(O.info=a,z=!0)}),z&&ce.local.setJSON("accounts",N)}},[re,a,s]);const pe=ge(()=>x?Ct.toUnicode(new URL(x).hostname):null,[x]),[ve,De]=A([]),Se=B(),Ue=B([]);async function Ne(k){(k||!Se.current)&&(Se.current=c.v1.accounts.$select(U).followers.list({limit:Un}));const N=await Se.current.next();if(re||!u)return N;const{value:z}=N;let O=[];if(k){const j=await c.v1.accounts.familiarFollowers.fetch({id:[U]});Ue.current=j[0].accounts,O=[...Ue.current,...z.filter(be=>!Ue.current.some(ue=>ue.id===be.id))]}else z!=null&&z.length&&(O=z.filter(j=>!Ue.current.some(be=>be.id===j.id)));return{...N,value:O}}const Te=B();async function X(k){return(k||!Te.current)&&(Te.current=c.v1.accounts.$select(U).following.list({limit:Un})),await Te.current.next()}const le=i?"div":ae,te=s?`/${s}/a/${U}`:`/a/${U}`,[xe,de]=A([]),[ne,G]=A(),[L,J]=A("default"),se=!!(ne!=null&&ne.total),_=async k=>{try{const N=await ji(k,l);de(N[0].accounts.slice(0,Ki))}catch{}},Y=async()=>{if(U){J("loading");try{const k=await Wi(U,c);G(k),J("default")}catch{J("error")}}},Q=Xe(({relationship:k,currentID:N})=>{k.following||(_(N),!i&&D>0&&Y())},[i,U,D]),ke=Xe(k=>{k.id===U&&(p(k),C.accounts[`${k.id}@${s}`]=k)},[U,s]);return e("div",{tabIndex:"-1",class:`account-container ${r==="loading"?"skeleton":""}`,style:{"--header-color-1":ve[0],"--header-color-2":ve[1],"--header-color-3":ve[2],"--header-color-4":ve[3]},children:[r==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:f?t:x,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),r==="loading"?e(R,{children:[e("header",{children:e(Je,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):a&&e(R,{children:[!!oe&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:I})," has indicated that their new account is now:"]}),e(Je,{account:oe,instance:s,onClick:k=>{k.stopPropagation(),C.showAccount=oe}})]}),!!H&&!/missing\.png$/.test(H)&&e("img",{src:H,alt:"",class:`header-banner ${Ie?"header-is-avatar":""}`,onError:k=>{k.target.crossOrigin?k.target.src!==we?k.target.src=we:(k.target.removeAttribute("crossorigin"),k.target.src=H):k.target.src!==we?k.target.src=we:k.target.remove()},crossOrigin:"anonymous",onLoad:k=>{k.target.classList.add("loaded");try{const N=window.OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas"),z=N.getContext("2d",{willReadFrequently:!0});N.width=k.target.width,N.height=k.target.height,z.imageSmoothingEnabled=!1,z.drawImage(k.target,0,0);const O=10,be=[z.getImageData(0,0,O,O).data,z.getImageData(k.target.width-O,0,O,O).data,z.getImageData(0,k.target.height-O,O,O).data,z.getImageData(k.target.width-O,k.target.height-O,O,O).data].map(ue=>{let me=0,fe=0,Ae=0,Ve=0;for(let He=0;He<ue.length;He+=4)me+=ue[He],fe+=ue[He+1],Ae+=ue[He+2],Ve+=ue[He+3];const Re=ue.length/4;return[me/Re,fe/Re,Ae/Re,Ve/Re]}).map(ue=>{const[me,fe,Ae,Ve]=Ji(ue);return`rgba(${me}, ${fe}, ${Ae}, ${Ve})`});De(be)}catch{}}}),e("header",{children:i?e(Ke,{shift:window.matchMedia("(min-width: calc(40em))").matches?114:64,menuButton:e("div",{children:e(Je,{account:a,instance:s,avatarSize:"xxxl",onClick:()=>{}})}),children:[e("div",{class:"szh-menu__header",children:e(io,{acct:g,instance:s})}),e(he,{onClick:()=>{const k=`@${g}`;try{navigator.clipboard.writeText(k),ie("Handle copied")}catch{ie("Unable to copy handle")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy handle"})]}),e(he,{href:x,target:"_blank",children:[e(w,{icon:"external"}),e("span",{children:"Go to original profile page"})]}),e(Oe,{}),e(Ee,{href:a.avatar,target:"_blank",children:[e(w,{icon:"user"}),e("span",{children:"View profile image"})]}),e(Ee,{href:a.header,target:"_blank",children:[e(w,{icon:"media"}),e("span",{children:"View profile header"})]})]}):e(Je,{account:a,instance:s,avatarSize:"xxxl",internal:!0})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!P&&e("span",{class:"tag",children:"In Memoriam"}),!!m&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!V&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),Ce==null?void 0:Ce.map(k=>e("span",{class:"tag",children:[k.name,!!pe&&e(R,{children:[" ",e("span",{class:"more-insignificant",children:pe})]})]})),e("div",{class:"note",dir:"auto",onClick:fs({instance:d}),dangerouslySetInnerHTML:{__html:tn(E,{emojis:v})}}),e("div",{class:"account-metadata-box",children:[(T==null?void 0:T.length)>0&&e("div",{class:"profile-metadata",children:T.map(({name:k,value:N,verifiedAt:z},O)=>e("div",{class:`profile-field ${z?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(ms,{text:k,emojis:v})," ",!!z&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:tn(N,{emojis:v})}})]},k+O))}),e("div",{class:"stats",children:[e(le,{tabIndex:0,to:te,onClick:()=>{setTimeout(()=>{C.showGenericAccounts={id:"followers",heading:"Followers",fetchAccounts:Ne,instance:s,excludeRelationshipAttrs:re?["followedBy"]:[]}},0)},children:[!!xe.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:xe.map(k=>e(tt,{url:k.avatarStatic,size:"s",alt:`${k.displayName} @${k.acct}`,squircle:k==null?void 0:k.bot}))})}),e("span",{title:$,children:Ge($)})," ","Followers"]}),e(le,{class:"insignificant",tabIndex:0,to:te,onClick:()=>{setTimeout(()=>{C.showGenericAccounts={heading:"Following",fetchAccounts:X,instance:s,excludeRelationshipAttrs:re?["following"]:[]}},0)},children:[e("span",{title:M,children:Ge(M)})," ","Following",e("br",{})]}),e(le,{class:"insignificant",to:te,children:[e("span",{title:D,children:Ge(D)})," ","Posts"]}),!!b&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:b,children:st(b,{hideTime:!0})})]})]})]}),!!ne&&e(le,{to:te,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:se?e("div",{class:"posting-stats",title:`${Math.round(ne.originals/ne.total*100)}% original posts, ${Math.round(ne.replies/ne.total*100)}% replies, ${Math.round(ne.boosts/ne.total*100)}% boosts`,children:[e("div",{children:ne.daysSinceLastPost<365?`Last ${ne.total} post${ne.total>1?"s":""} in the past 
                      ${ne.daysSinceLastPost} day${ne.daysSinceLastPost>1?"s":""}`:`
                      Last ${ne.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${ne.originals/ne.total*100}%`,"--replies-percentage":`${(ne.originals+ne.replies)/ne.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),!oe&&e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!ne,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:L==="loading",onClick:()=>{Y()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${L==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(Zi,{info:a,instance:s,standalone:i,authenticated:o,onRelationshipChange:Q,onProfileUpdate:ke})})]})]})}const Ki=3;function Zi({info:t,instance:n,standalone:i,authenticated:s,onRelationshipChange:o=()=>{},onProfileUpdate:c=()=>{}}){var ne;if(!t)return null;const{masto:l,instance:d,authenticated:r}=K(),h=n===d,[f,a]=A("default"),[p,u]=A(null),{id:g,acct:y,url:S,username:m,locked:b,lastStatusAt:I,note:v,fields:T,moved:$}=t,M=B(g),{following:V,showingReblogs:U,notifying:F,followedBy:ee,blocking:E,blockedBy:D,muting:x,mutingNotifications:q,requested:P,domainBlocking:oe,endorsed:Ce,note:Ie}=p||{},[H,we]=A(null),[re,pe]=A(!1);W(()=>{if(t){const G=ce.session.get("currentAccount");let L;(async()=>{if(h&&s)L=g;else if(!h&&r){const se=t.acct.includes("@");try{const _=await l.v2.search.fetch({q:se?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});_.accounts.length&&(L=_.accounts[0].id,we(_.accounts[0]))}catch{}}if(!L)return;if(G===L){pe(!0);return}M.current=L,a("loading");const J=l.v1.accounts.relationships.fetch({id:[L]});try{const se=await J;if(a("default"),se.length){const _=se[0];u(_),o({relationship:_,currentID:L})}}catch{a("error")}})()}},[t,s]),W(()=>{t&&re&&Hs(t)},[t,re]);const ve=f==="loading",[De,Se]=A(!1),[Ue,Ne]=A(!1),[Te,X]=A(!1),[le,te]=A(!1),[xe,de]=A([]);return e(R,{children:[e("div",{class:"actions",children:[e("span",{children:[ee?e("span",{class:"tag",children:"Follows you"}):I?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:st(I,{hideTime:!0})})]}):e("span",{}),x&&e("span",{class:"tag danger",children:"Muted"}),E&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!Ie&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{X(!0)},dir:"auto",children:e("span",{children:Ie})}),e(Ke,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:ve,children:e(w,{icon:"more",size:"l",alt:"More"})}),onMenuChange:G=>{V&&G.open&&(async()=>{try{const L=await l.v1.accounts.$select(M.current).lists.list();de(L)}catch{}})()},children:[r&&!re&&e(R,{children:[e(he,{onClick:()=>{C.showCompose={draftStatus:{status:`@${(H==null?void 0:H.acct)||y} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",m]})]}),e(he,{onClick:()=>{Se(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(he,{onClick:()=>{X(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:Ie?"Edit private note":"Add private note"})]}),V&&!!p&&e(R,{children:[e(he,{onClick:()=>{a("loading"),(async()=>{try{const G=await l.v1.accounts.$select(M.current).follow({notify:!F});G&&u(G),a("default"),ie(G.notifying?`Notifications enabled for @${m}'s posts.`:` Notifications disabled for @${m}'s posts.`)}catch(G){alert(G),a("error")}})()},children:[e(w,{icon:"notification"}),e("span",{children:F?"Disable notifications":"Enable notifications"})]}),e(he,{onClick:()=>{a("loading"),(async()=>{try{const G=await l.v1.accounts.$select(M.current).follow({reblogs:!U});G&&u(G),a("default"),ie(G.showingReblogs?`Boosts from @${m} disabled.`:`Boosts from @${m} enabled.`)}catch(G){alert(G),a("error")}})()},children:[e(w,{icon:"rocket"}),e("span",{children:U?"Disable boosts":"Enable boosts"})]})]}),V&&e(he,{onClick:()=>{Ne(!0)},children:[e(w,{icon:"list"}),xe.length?e(R,{children:[e("small",{class:"menu-grow",children:["Add/Remove from Lists",e("br",{}),e("span",{class:"more-insignificant",children:xe.map(G=>G.title).join(", ")})]}),e("small",{class:"more-insignificant",children:xe.length})]}):e("span",{children:"Add/Remove from Lists"})]}),e(Oe,{})]}),e(he,{onClick:()=>{const G=`@${(H==null?void 0:H.acct)||y}`;try{navigator.clipboard.writeText(G),ie("Handle copied")}catch{ie("Unable to copy handle")}},children:[e(w,{icon:"copy"}),e("small",{children:["Copy handle",e("br",{}),e("span",{class:"more-insignificant",children:["@",(H==null?void 0:H.acct)||y]})]})]}),e(he,{href:S,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:Xi(S)})]}),e("div",{class:"menu-horizontal",children:[e(he,{onClick:()=>{try{navigator.clipboard.writeText(S),ie("Link copied")}catch{ie("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((ne=navigator==null?void 0:navigator.canShare)==null?void 0:ne.call(navigator,{url:S}))&&e(he,{onClick:()=>{try{navigator.share({url:S})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!p&&e(R,{children:[e(Oe,{}),x?e(he,{onClick:()=>{a("loading"),(async()=>{try{const G=await l.v1.accounts.$select((H==null?void 0:H.id)||g).unmute();u(G),a("default"),ie(`Unmuted @${m}`),C.reloadGenericAccounts.id="mute",C.reloadGenericAccounts.counter++}catch{a("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",m]})]}):e(Vt,{menuClassName:"menu-blur",openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(R,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",m,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:Vi.map(G=>e(he,{onClick:()=>{a("loading"),(async()=>{try{const L=await l.v1.accounts.$select((H==null?void 0:H.id)||g).mute({duration:G});u(L),a("default"),ie(`Muted @${m} for ${Nn[G]}`),C.reloadGenericAccounts.id="mute",C.reloadGenericAccounts.counter++}catch{a("error"),ie(`Unable to mute @${m}`)}})()},children:Nn[G]}))})}),ee&&e(Qe,{subMenu:!0,menuItemClassName:"danger",confirmLabel:e(R,{children:[e(w,{icon:"user-x"}),e("span",{children:["Remove @",m," from followers?"]})]}),onClick:()=>{a("loading"),(async()=>{try{const G=await l.v1.accounts.$select((H==null?void 0:H.id)||g).removeFromFollowers();u(G),a("default"),ie(`@${m} removed from followers`),C.reloadGenericAccounts.id="followers",C.reloadGenericAccounts.counter++}catch{a("error")}})()},children:[e(w,{icon:"user-x"}),e("span",{children:"Remove follower…"})]}),e(Qe,{subMenu:!0,confirm:!E,confirmLabel:e(R,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{a("loading"),(async()=>{try{if(E){const G=await l.v1.accounts.$select((H==null?void 0:H.id)||g).unblock();u(G),a("default"),ie(`Unblocked @${m}`)}else{const G=await l.v1.accounts.$select((H==null?void 0:H.id)||g).block();u(G),a("default"),ie(`Blocked @${m}`)}C.reloadGenericAccounts.id="block",C.reloadGenericAccounts.counter++}catch{a("error"),E?ie(`Unable to unblock @${m}`):ie(`Unable to block @${m}`)}})()},children:E?e(R,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",m]})]}):e(R,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"…"]})]})}),e(he,{className:"danger",onClick:()=>{C.showReportModal={account:H||t}},children:[e(w,{icon:"flag"}),e("span",{children:["Report @",m,"…"]})]})]}),r&&re&&i&&e(R,{children:[e(Oe,{}),e(he,{onClick:()=>{te(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:"Edit profile"})]})]}),!1]}),!p&&f==="loading"&&e($e,{abrupt:!0}),!!p&&!$&&e(Qe,{confirm:V||P,confirmLabel:e("span",{children:P?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:ve,onClick:()=>{a("loading"),(async()=>{try{let G;V||P?G=await l.v1.accounts.$select(M.current).unfollow():G=await l.v1.accounts.$select(M.current).follow(),G&&u(G),a("default")}catch(G){alert(G),a("error")}})()},children:e("button",{type:"button",class:`${V||P?"light swap":""}`,"data-swap-state":V||P?"danger":"",disabled:ve,children:V?e(R,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):P?e(R,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):b?e(R,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!De&&e(_e,{onClose:()=>{Se(!1)},children:e(Qi,{note:v,fields:T,onClose:()=>Se(!1)})}),!!Ue&&e(_e,{onClose:()=>{Ne(!1)},children:e(eo,{accountID:M.current,onClose:()=>Ne(!1)})}),!!Te&&e(_e,{onClose:()=>{X(!1)},children:e(to,{account:t,note:Ie,onRelationshipChange:G=>{u(G)},onClose:()=>X(!1)})}),!!le&&e(_e,{onClose:()=>{te(!1)},children:e(no,{onClose:({state:G,account:L}={})=>{te(!1),G==="success"&&L&&c(L)}})})]})}function Ji([t,n,i]){const s=.2126*t+.7152*n+.0722*i;let o;return s>=220?o=1:s<=50?o=.1:o=s/255,o=Math.min(1,o),[t,n,i,o]}function Xi(t){if(!t)return;const n=new URL(t),{host:i,pathname:s}=n,o=s.replace(/\/$/,"").replace(/^\//,"");return e(R,{children:[e("span",{class:"more-insignificant",children:[Ct.toUnicode(i),"/"]}),e("wbr",{}),e("span",{children:o})]})}function Qi({note:t,fields:n,onClose:i}){const s=(n==null?void 0:n.map(({name:c,value:l})=>`${c}
${Rn(l)}`).join(`

`))||"",o=Rn(t)+(s?`

${s}`:"");return e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:o}),e(gs,{forceTranslate:!0,text:o})]})]})}function eo({accountID:t,onClose:n}){const{masto:i}=K(),[s,o]=A("default"),[c,l]=A([]),[d,r]=A([]),[h,f]=ht(u=>u+1,0);W(()=>{o("loading"),(async()=>{try{const u=await _t();l(u);const g=await i.v1.accounts.$select(t).lists.list();r(g),o("default")}catch{o("error")}})()},[h]);const[a,p]=A(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[c.length>0?e("ul",{class:"list-add-remove",children:c.map(u=>{const g=d.some(y=>y.id===u.id);return e("li",{children:e("button",{type:"button",class:`light ${g?"checked":""}`,disabled:s==="loading",onClick:()=>{o("loading"),(async()=>{try{g?await i.v1.lists.$select(u.id).accounts.remove({accountIds:[t]}):await i.v1.lists.$select(u.id).accounts.create({accountIds:[t]}),f()}catch{o("error"),alert(g?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:u.title})]})})})}):s==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):s==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>p(!0),disabled:s!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),a&&e(_e,{onClick:u=>{u.target===u.currentTarget&&p(!1)},children:e(gn,{list:a==null?void 0:a.list,onClose:u=>{u.state==="success"&&f(),p(!1)}})})]})}function to({account:t,note:n,onRelationshipChange:i=()=>{},onClose:s=()=>{}}){const{masto:o}=K(),[c,l]=A("default"),d=B(null);return W(()=>{let r;return d.current&&!n&&(r=setTimeout(()=>{var h,f;(f=(h=d.current).focus)==null||f.call(h)},100)),()=>{clearTimeout(r)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!s&&e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:r=>{r.preventDefault();const f=new FormData(r.target).get("note");(f==null?void 0:f.trim())!==(n==null?void 0:n.trim())&&(l("loading"),(async()=>{try{const a=await o.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:f});l("default"),i(a),s()}catch(a){l("error"),alert((a==null?void 0:a.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:d,name:"note",disabled:c==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:c==="loading",onClick:()=>{s==null||s()},children:"Cancel"}),e("span",{children:[e($e,{abrupt:!0,hidden:c!=="loading"}),e("button",{disabled:c==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function no({onClose:t=()=>{}}){const{masto:n}=K(),[i,s]=A("loading"),[o,c]=A(null);W(()=>{(async()=>{try{const a=await n.v1.accounts.verifyCredentials();c(a),s("default")}catch{s("error")}})()},[]);const{displayName:l,source:d}=o||{},{note:r,fields:h}=d||{},f=B(null);return e("div",{class:"sheet",id:"edit-profile-container",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Edit profile"})}),e("main",{children:i==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):e("form",{onSubmit:a=>{a.preventDefault();const p=new FormData(a.target),u=p.get("display_name"),g=p.get("note"),y=f.current.querySelectorAll('input[name^="fields_attributes"]'),S=[];y.forEach(m=>{const b=m.name,[I,v,T]=b.match(/fields_attributes\[(\d+)\]\[(.+)\]/)||[],$=m.value?m.value.trim():"";v&&T&&$&&(S[v]||(S[v]={}),S[v][T]=$)}),S.forEach(m=>{m.name&&!m.value&&(m.value="")}),(async()=>{try{const m=await n.v1.accounts.updateCredentials({displayName:u,note:g,fieldsAttributes:S});t==null||t({state:"success",account:m})}catch(m){alert((m==null?void 0:m.message)||"Unable to update profile.")}})()},children:[e("p",{children:e("label",{children:["Name"," ",e("input",{type:"text",name:"display_name",defaultValue:l,maxLength:30,disabled:i==="loading"})]})}),e("p",{children:e("label",{children:["Bio",e("textarea",{defaultValue:r,name:"note",maxLength:500,rows:"5",disabled:i==="loading"})]})}),e("p",{children:"Extra fields"}),e("table",{ref:f,children:[e("thead",{children:e("tr",{children:[e("th",{children:"Label"}),e("th",{children:"Content"})]})}),e("tbody",{children:Array.from({length:Math.max(4,h.length)}).map((a,p)=>{const{name:u="",value:g=""}=h[p]||{};return e(so,{name:u,value:g,index:p,disabled:i==="loading"},p)})})]}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:i==="loading",onClick:()=>{t==null||t()},children:"Cancel"}),e("button",{type:"submit",disabled:i==="loading",children:"Save"})]})]})})]})}function so({name:t,value:n,disabled:i,index:s}){const[o,c]=A(!!n);return e("tr",{children:[e("td",{children:e("input",{type:"text",name:`fields_attributes[${s}][name]`,defaultValue:t,disabled:i,maxLength:255,required:o})}),e("td",{children:e("input",{type:"text",name:`fields_attributes[${s}][value]`,defaultValue:n,disabled:i,maxLength:255,onChange:l=>c(!!l.currentTarget.value)})})]})}function io({acct:t,instance:n}){let[i,s]=t.split("@");return s||(s=n),e("div",{class:"handle-info",children:[e("span",{class:"handle-handle",children:[e("b",{class:"handle-username",children:i}),e("span",{class:"handle-at",children:"@"}),e("b",{class:"handle-server",children:s})]}),e("div",{class:"handle-legend",children:[e("span",{class:"ib",children:[e("span",{class:"handle-legend-icon username"})," username"]})," ",e("span",{class:"ib",children:[e("span",{class:"handle-legend-icon server"})," server domain name"]})]})]})}function oo({account:t,instance:n,onClose:i}){const{masto:s,instance:o,authenticated:c}=K({instance:n}),l=typeof t=="string";return W(()=>{l||(C.accounts[`${t.id}@${o}`]=t)},[t]),ks(i),e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close outer",onClick:i,children:e(w,{icon:"x"})}),e(Ts,{instance:o,authenticated:c,account:t,fetchAccount:async()=>{if(l)try{return await s.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const r=await s.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:c});if(r.accounts.length)return r.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const h=new URL(t),{hostname:f,pathname:a}=h,p=a.replace(/^\//,"").replace(/\/$/,"")+"@"+f,u=await s.v2.search.fetch({q:p,type:"accounts",limit:1,resolve:c});if(u.accounts.length)return u.accounts[0]}}else return t}})]})}function co({onClose:t}){const{masto:n}=K(),[i,s]=A("default"),[o,c]=A([]),[l,d]=ht(h=>h+1,0);W(()=>{s("loading"),(async()=>{try{const h=await et.drafts.keys();if(h.length){const f=Ht(),a=h.filter(p=>p.startsWith(f));if(a.length){const p=await et.drafts.getMany(a);p.sort((u,g)=>new Date(g.updatedAt).getTime()-new Date(u.updatedAt).getTime()),c(p)}else c([])}else c([]);s("default")}catch{s("error")}})()},[l]);const r=(o==null?void 0:o.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e($e,{abrupt:!0,hidden:i!=="loading"})]}),r&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:r?e(R,{children:[e("ul",{class:"drafts-list",children:o.map(h=>{const{updatedAt:f,key:a,draftStatus:p,replyTo:u}=h,g=new Date(f);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:u?"reply":"quill",size:"s"})," ",e("time",{children:[!!u&&e(R,{children:["@",u.account.acct,e("br",{})]}),st(g)]})]}),e(Qe,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:i==="loading",onClick:()=>{(async()=>{try{await et.drafts.del(a),d()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:i==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:i==="loading",class:"draft-item",onClick:async()=>{let y;if(u){s("loading");try{y=await n.v1.statuses.$select(u.id).fetch()}catch{alert("Error fetching reply-to status!"),s("default");return}s("default")}window.__COMPOSE__={draftStatus:p,replyToStatus:y},C.showCompose=!0,C.showDrafts=!1},children:e(ao,{draft:h})})]},f)})}),o.length>1&&e("p",{children:e(Qe,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:i==="loading",onClick:()=>{(async()=>{s("loading");try{await et.drafts.delMany(o.map(h=>h.key)),s("default"),d()}catch{alert("Error deleting drafts! Please try again."),s("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function ao({draft:t}){var a;const{draftStatus:n,replyTo:i}=t,{status:s,spoilerText:o,poll:c,mediaAttachments:l}=n,d=((a=c==null?void 0:c.options)==null?void 0:a.length)>0,r=(l==null?void 0:l.length)>0,h=d||r,f=ge(()=>{if(!r)return;const p=l.find(y=>/image/.test(y.type));if(!p)return;const{file:u}=p;return URL.createObjectURL(u)},[r,l]);return e(R,{children:e("div",{class:"mini-draft",children:[h&&e("div",{class:`mini-draft-aside ${f?"has-image":""}`,style:f?{"--bg-image":`url(${f})`}:{},children:[d&&e(w,{icon:"poll"}),r&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:l==null?void 0:l.length})]})]}),e("div",{class:"mini-draft-main",children:[!!o&&e("div",{class:"mini-draft-spoiler",children:o}),!!s&&e("div",{class:"mini-draft-status",children:s})]})]})})}function ro({html:t,url:n,width:i,height:s,onClose:o=()=>{}}){return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>o(),children:e(w,{icon:"x"})}),n&&e("a",{href:n,target:"_blank",rel:"noopener noreferrer",class:"button plain",children:[e("span",{children:"Open link"})," ",e(w,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:t},style:{"--width":i+"px","--height":s+"px","--aspect-ratio":`${i}/${s}`}})]})}async function bn(t,n={}){if(!(t!=null&&t.length))return;const{masto:i}=K(),s=ce.session.get("currentAccount"),o=t.reduce((c,l)=>(!c.includes(l.id)&&!n[l.id]&&l.id!==s&&c.push(l.id),c),[]);if(!o.length)return null;try{return(await i.v1.accounts.relationships.fetch({id:o})).reduce((d,r)=>(d[r.id]=r,d),{})}catch{return null}}function lo({instance:t,excludeRelationshipAttrs:n=[],postID:i,onClose:s=()=>{}}){const{masto:o,instance:c}=K(),l=t?t===c:!0,d=Pe(C),[r,h]=A("default"),[f,a]=A([]),[p,u]=A(!1);if(ks(s),!d.showGenericAccounts)return null;const{id:g,heading:y,fetchAccounts:S,accounts:m,showReactions:b}=d.showGenericAccounts,[I,v]=A({}),T=async U=>{if(!(U!=null&&U.length)||!l)return;const F=await bn(U,I);F&&v({...I,...F})},$=U=>{S&&(U&&a([]),h("loading"),(async()=>{try{const{done:F,value:ee}=await S(U);if(Array.isArray(ee)){if(U){const E=[];for(let D=0;D<ee.length;D++){const x=ee[D],q=E.find((P,oe)=>P.id===x.id&&D!==oe);q?q._types.push(...x._types):E.push({_types:[],...x})}a(E)}else a(E=>{const D=E;for(const x of ee){const q=D.find(P=>P.id===x.id);q?q._types.push(...x._types):D.push(x)}return D});u(!F),T(ee)}else u(!1);h("default")}catch{h("error")}})())},M=B(!0);W(()=>{(m==null?void 0:m.length)>0?(a(m),T(m)):($(!0),M.current=!1)},[m,S]),W(()=>{var U;M.current||((U=d.reloadGenericAccounts)==null?void 0:U.id)===g&&$(!0)},[d.reloadGenericAccounts.counter]);const V=C.statuses[i];return e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:y||"Accounts"})}),e("main",{children:[V&&e("div",{class:"post-preview",children:e(ze,{status:V,size:"s",readOnly:!0})}),f.length>0?e(R,{children:[e("ul",{class:"accounts-list",children:f.map(U=>{var E,D;const F=I[U.id],ee=`${U.id}-${((E=U._types)==null?void 0:E.length)||""}`;return e("li",{children:[b&&((D=U._types)==null?void 0:D.length)>0&&e("div",{class:"reactions-block",children:U._types.map(x=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[x],class:`${x}-icon`}))}),e("div",{class:"account-relationships",children:e(Je,{account:U,showStats:!0,relationship:F,excludeRelationshipAttrs:n})})]},ee)})}),r==="default"?p?e(ot,{onChange:U=>{U&&$()},children:e("button",{type:"button",class:"plain block",onClick:()=>$(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):r==="loading"&&e("p",{class:"ui-state",children:e($e,{abrupt:!0})})]}):r==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):r==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})]})]})}function uo({alt:t,lang:n,onClose:i}){const s=Pe(C),[o,c]=A(!1),l=hs(!0),d=s.settings.contentTranslationHideLanguages||[],r=!!n&&n!==l&&!Ln([n],[l])&&!d.find(h=>n===h||Ln([n],[h]));return e("div",{class:"sheet",tabindex:"-1",children:[!!i&&e("button",{type:"button",class:"sheet-close outer",onClick:i,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ke,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:[e(he,{disabled:o,onClick:()=>{c(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]}),pi&&e(he,{onClick:()=>{fi(t,n)},children:[e(w,{icon:"speak"}),e("span",{children:"Speak"})]})]})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(r||o)&&e(gs,{forceTranslate:o,sourceLanguage:n,text:t})]})]})}function Zt(t,n,i){return Math.max(Math.min(t,i),n)}const Jt=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Xt=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function yn([t,n,i]){t=Jt(t/255),n=Jt(n/255),i=Jt(i/255);var s=.4122214708*t+.5363325363*n+.0514459929*i,o=.2119034982*t+.6806995451*n+.1073969566*i,c=.0883024619*t+.2817188376*n+.6299787005*i;return s=Math.cbrt(s),o=Math.cbrt(o),c=Math.cbrt(c),[s*.2104542553+o*.793617785+c*-.0040720468,s*1.9779984951+o*-2.428592205+c*.4505937099,s*.0259040371+o*.7827717662+c*-.808675766]}function wn([t,n,r]){var s=t+n*.3963377774+r*.2158037573,o=t+n*-.1055613458+r*-.0638541728,c=t+n*-.0894841775+r*-1.291485548;s=s**3,o=o**3,c=c**3;var l=s*4.0767416621+o*-3.3077115913+c*.2309699292,d=s*-1.2684380046+o*2.6097574011+c*-.3413193965,r=s*-.0041960863+o*-.7034186147+c*1.707614701;return l=255*Xt(l),d=255*Xt(d),r=255*Xt(r),l=Zt(l,0,255),d=Zt(d,0,255),r=Zt(r,0,255),l=Math.round(l),d=Math.round(d),r=Math.round(r),[l,d,r]}var ho={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:qa}=ho;function xs({mediaAttachments:t,statusID:n,instance:i,lang:s,index:o=0,onClose:c=()=>{}}){var b,I;const[l,d]=A("default"),r=B(null),[h,f]=A(o),a=B(null);ct(()=>{var v;(v=a.current)==null||v.scrollIntoView()},[]);const p=B(n);W(()=>{const v=o*r.current.clientWidth,T=p.current!==n;T&&(p.current=n),r.current.scrollTo({left:v,behavior:T?"auto":"smooth"}),r.current.focus()},[o,n]);const[u,g]=A(!0);W(()=>{let v=()=>{c()};return r.current&&r.current.addEventListener("swiped-down",v),()=>{r.current&&r.current.removeEventListener("swiped-down",v)}},[]),Me("esc",c,{ignoreEventWhen:v=>!!document.querySelector("#modal-container > *")},[c]),W(()=>{let v=()=>{const{clientWidth:T,scrollLeft:$}=r.current,M=Math.round($/T);f(M)};return r.current&&r.current.addEventListener("scroll",v,{passive:!0}),()=>{r.current&&r.current.removeEventListener("scroll",v)}},[]),W(()=>{let v=setTimeout(()=>{var T,$;($=(T=r.current)==null?void 0:T.focus)==null||$.call(T)},100);return()=>clearTimeout(v)},[]);const y=ge(()=>t==null?void 0:t.map(v=>{const{blurhash:T}=v;if(T){const $=dn(T),M=yn($);return wn([.6,M[1],M[2]])}return null}),[t]),S=ge(()=>{var $;const T=100/y.length;return(($=y==null?void 0:y.map((M,V)=>{const U=V*T+5,F=(V+1)*T-5;return M?`
            rgba(${M==null?void 0:M.join(",")}, 0.4) ${U}%,
            rgba(${M==null?void 0:M.join(",")}, 0.4) ${F}%
          `:`
            transparent ${U}%,
            transparent ${F}%
          `}))==null?void 0:$.join(", "))||"transparent"},[y]);let m=B(null);return W(()=>()=>{var v,T;(T=(v=m.current)==null?void 0:v.hideToast)==null||T.call(v)},[]),e("div",{class:`media-modal-container media-modal-count-${t==null?void 0:t.length}`,children:[e("div",{ref:r,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:v=>{(v.target.classList.contains("carousel-item")||v.target.classList.contains("media")||v.target.classList.contains("media-zoom"))&&c()},style:t.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${S})`}:{},children:t==null?void 0:t.map((v,T)=>{const $=t.length===1?y[T]:null;return e("div",{class:"carousel-item",style:$?{"--accent-color":`rgb(${$==null?void 0:$.join(",")})`,"--accent-alpha-color":`rgba(${$==null?void 0:$.join(",")}, 0.4)`}:{},tabindex:"0",ref:T===h?a:null,onClick:M=>{M.target.classList.contains("media")||g(!u)},children:[!!v.description&&e("button",{type:"button",class:"media-alt",hidden:!u,onClick:()=>{C.showMediaAlt={alt:v.description,lang:s}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:s,dir:"auto",children:v.description})]}),e(bs,{media:v,showOriginal:!0,lang:s})]},v.id)})}),e("div",{class:"carousel-top-controls",hidden:!u,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>c(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((v,T)=>e("button",{type:"button",disabled:T===h,class:`carousel-dot ${T===h?"active":""}`,onClick:$=>{$.preventDefault(),$.stopPropagation(),r.current.scrollTo({left:r.current.clientWidth*T,behavior:"smooth"}),r.current.focus()},children:e(w,{icon:"round",size:"s"})},v.id))}):e("span",{}),e("span",{children:[e(Ke,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:[e(Ee,{href:((b=t[h])==null?void 0:b.remoteUrl)||((I=t[h])==null?void 0:I.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]}),!1]})," ",e(ae,{to:`${i?`/${i}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${h+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!u,children:[e("button",{type:"button",class:"carousel-button",hidden:h===0,onClick:v=>{v.preventDefault(),v.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(h-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:h===t.length-1,onClick:v=>{v.preventDefault(),v.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(h+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const po=[,"spam","legal","violation","other"],xt={spam:{label:"Spam",description:"Malicious links, fake engagement, or repetitive replies"},legal:{label:"Illegal",description:"Violates the law of your or the server's country"},violation:{label:"Server rule violation",description:"Breaks specific server rules",stampLabel:"Violation"},other:{label:"Other",description:"Issue doesn't fit other categories",excludeStamp:!0}};function fo({account:t,post:n,onClose:i}){const{masto:s}=K(),[o,c]=A("default"),[l,d]=t.acct.split("@"),[r,h]=ge(()=>{const{rules:m,domain:b}=os();return[m||[],b]}),[f,a]=A(null),[p,u]=A(!1),g=B(null),[y,S]=A(!1);return e("div",{class:"report-modal-container",children:[e("div",{class:"top-controls",children:[e("h1",{children:n?"Report Post":`Report @${l}`}),e("button",{type:"button",class:"plain4 small",disabled:o==="loading",onClick:()=>i(),children:e(w,{icon:"x",size:"xl"})})]}),e("main",{children:[e("div",{class:"report-preview",children:n?e(ze,{status:n,size:"s",previewMode:!0}):e(Je,{account:t,avatarSize:"xxl",useAvatarStatic:!0,showStats:!0,showActivity:!0})}),!!f&&!xt[f].excludeStamp&&e("span",{class:"rubber-stamp","aria-hidden":"true",children:[xt[f].stampLabel||xt[f].label,e("small",{children:"Pending review"})]},f),e("form",{onSubmit:m=>{m.preventDefault();const b=new FormData(m.target),I=Object.fromEntries(b.entries());let{category:v,comment:T,forward:$}=I;T||(T=void 0),$==="on"&&($=!0);const M=v==="violation"?Object.entries(I).filter(([U])=>U.startsWith("rule_ids")).map(([U,F])=>F):void 0,V={category:v,comment:T,forward:$,ruleIds:M};c("loading"),(async()=>{try{await s.v1.reports.create({accountId:t.id,statusIds:n!=null&&n.id?[n.id]:void 0,category:v,comment:T,ruleIds:M,forward:$}),c("success"),ie(n?"Post reported":"Profile reported"),i()}catch(U){c("error"),ie((U==null?void 0:U.message)||(n?"Unable to report post":"Unable to report profile"))}})()},children:[e("p",{children:n?"What's the issue with this post?":"What's the issue with this profile?"}),e("section",{class:"report-categories",children:po.map(m=>m==="violation"&&!(r!=null&&r.length)?null:e(R,{children:[e("label",{class:"report-category",children:[e("input",{type:"radio",name:"category",value:m,required:!0,disabled:o==="loading",onChange:b=>{a(b.target.value),u(b.target.value==="violation")}}),e("span",{children:[xt[m].label,"  ",e("small",{class:"ib insignificant",children:xt[m].description})]})]}),m==="violation"&&!!(r!=null&&r.length)&&e("div",{class:"shazam-container no-animation",hidden:!p,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"report-rules",ref:g,children:r.map((b,I)=>e("label",{class:"report-rule",children:[e("input",{type:"checkbox",name:`rule_ids[${I}]`,value:b.id,required:p&&!y,disabled:o==="loading",onChange:v=>{const{checked:T}=v.target;T?S(!0):g.current.querySelectorAll("input:checked").length||S(!1)}}),e("span",{children:b.text})]},b.id))})})})]},m))}),e("section",{class:"report-comment",children:[e("p",{children:e("label",{for:"report-comment",children:"Additional info"})}),e("textarea",{maxlength:"1000",rows:"1",name:"comment",id:"report-comment",disabled:o==="loading"})]}),!!d&&d!==h&&e("section",{children:e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,name:"forward",disabled:o==="loading"})," ",e("span",{children:["Forward to ",e("i",{children:d})]})]})})}),e("footer",{children:[e("button",{type:"submit",disabled:o==="loading",children:"Send Report"})," ",e("button",{type:"submit",class:"plain2",disabled:o==="loading",onClick:async()=>{try{await s.v1.accounts.$select(t.id).mute(),ie(`Muted ${l}`)}catch{ie(`Unable to mute ${l}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Mute profile"})]})," ",e("button",{type:"submit",class:"plain2",disabled:o==="loading",onClick:async()=>{try{await s.v1.accounts.$select(t.id).block(),ie(`Blocked ${l}`)}catch{ie(`Unable to block ${l}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Block profile"})]}),e($e,{hidden:o!=="loading"})]})]})]})]})}const mo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",go="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",bo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",yo=200,wo=10;async function jt(){const{masto:t}=K(),n=t.v1.followedTags.list({limit:yo}),i=[];let s=0;do{const{value:o,done:c}=await n.next();if(c||(o==null?void 0:o.length)===0)break;i.push(...o),s++}while(s<wo);return i.sort((o,c)=>o.name.localeCompare(c.name)),i.length&&setTimeout(()=>{ce.account.set("followedTags",{tags:i,updatedAt:Date.now()})},1),i}const vo=24*60*60*1e3;async function ko(){try{const{tags:t,updatedAt:n}=ce.account.get("followedTags")||{};return t!=null&&t.length?(Date.now()-n>vo&&jt(),t):await jt()}catch{return[]}}const Fn=document.createElement("div"),So=t=>{if(!t)return[];if(t.indexOf("#")===-1)return[];Fn.innerHTML=t;const n=Fn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(i=>i.innerText.trim().replace(/^[^#]*#+/,"")):[]};function Ft({children:t}){if(typeof t=="string")return t;const[n,i]=A("");return W(()=>{Promise.resolve(t).then(i)},[t]),n}const it=9,Io=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],$s={following:"Home / Following",notifications:"Notifications",list:"Lists",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},Ot={list:[{text:"List ID",name:"id",notRequired:!0}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},Co=lt(async({id:t})=>{const n=await K().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),Yt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:({id:t})=>t?"list":"lists",title:({id:t})=>t?zi(t):"Lists",path:({id:t})=>t?`/l/${t}`:"/l",icon:"list",excludeViewMode:({id:t})=>t?[]:["multi-column"]},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||K().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||K().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t?`“${t}”`:"Search",path:({query:t})=>t?`/search?q=${encodeURIComponent(t)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:t})=>t?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:Co,path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||K().instance,path:({hashtag:t,instance:n,media:i})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${i?"?media=1":""}`,icon:"hashtag"}};function To({onClose:t}){const n=Pe(C),{shortcuts:i}=n,[s,o]=A(!1),[c,l]=A(!1),[d]=ln();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:mo},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:bo},{value:"multi-column",label:"Multi-column",imgURL:go}].map(({value:r,label:h,imgURL:f})=>{const a=n.settings.shortcutsViewMode===r||r==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:a?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:r,checked:a,onChange:p=>{C.settings.shortcutsViewMode=p.target.value}})," ",e("img",{src:f,alt:"",width:"80",height:"58"})," ",e("span",{children:h})]},r)})}),i.length>0?e(R,{children:[e("ol",{class:"shortcuts-list",ref:d,children:i.filter(Boolean).map((r,h)=>{const f=Object.values(r).join("-"),{type:a}=r;if(!Yt[a])return null;let{icon:p,title:u,subtitle:g,excludeViewMode:y}=Yt[a];typeof u=="function"&&(u=u(r,h)),typeof g=="function"&&(g=g(r,h)),typeof p=="function"&&(p=p(r,h)),typeof y=="function"&&(y=y(r,h));const S=y==null?void 0:y.includes(n.settings.shortcutsViewMode);return e("li",{children:[e(w,{icon:p}),e("span",{class:"shortcut-text",children:[e(Ft,{children:u}),g&&e(R,{children:[" ",e("small",{class:"ib insignificant",children:g})]}),S&&e("span",{class:"tag",children:"Not available in current view mode"})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:h===0,onClick:()=>{const m=Array.from(C.shortcuts);if(h>0){const b=C.shortcuts[h-1];m[h-1]=r,m[h]=b,C.shortcuts=m}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:h===i.length-1,onClick:()=>{const m=Array.from(C.shortcuts);if(h<C.shortcuts.length-1){const b=C.shortcuts[h+1];m[h+1]=r,m[h]=b,C.shortcuts=m}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{o({shortcut:r,shortcutIndex:h})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},f)})}),i.length===1&&n.settings.shortcutsViewMode!=="float-button"&&e("div",{class:"ui-state insignificant",children:[e(w,{icon:"info"})," ",e("small",{children:"Add more than one shortcut/column to make this work."})]})]}):e("div",{class:"ui-state insignificant",children:[e("p",{children:n.settings.shortcutsViewMode==="multi-column"?"No columns yet. Tap on the Add column button.":"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:r=>{r.preventDefault(),C.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:i.length>=it&&(n.settings.shortcutsViewMode==="multi-column"?`Max ${it} columns`:`Max ${it} shortcuts`)}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>l(!0),children:"Import/export"}),e("button",{type:"button",disabled:i.length>=it,onClick:()=>o(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),s&&e(_e,{onClick:r=>{r.target===r.currentTarget&&o(!1)},children:e(xo,{shortcut:s.shortcut,shortcutIndex:s.shortcutIndex,onSubmit:({result:r,mode:h})=>{h==="edit"?C.shortcuts[s.shortcutIndex]=r:C.shortcuts.push(r)},onClose:()=>o(!1)})}),c&&e(_e,{onClick:r=>{r.target===r.currentTarget&&l(!1)},children:e($o,{shortcuts:i,onClose:()=>l(!1)})})]})}const On={list:"Specific list is optional. For multi-column mode, list is required, else the column will not be shown.",search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function xo({onSubmit:t,disabled:n,shortcut:i,shortcutIndex:s,onClose:o}){var S,m;const c=!!i,[l,d]=A((i==null?void 0:i.type)||null),{masto:r}=K(),[h,f]=A("default"),[a,p]=A([]),[u,g]=A([]);W(()=>{(async()=>{if(l==="list")try{f("loading");const b=await _t();p(b),f("default")}catch{f("error")}})(),(async()=>{if(l==="hashtag")try{const b=await jt();g(b)}catch{}})()},[l]);const y=B();return W(()=>{if(c&&l&&Ot[l]){const b=y.current;Ot[l].forEach(({name:I,type:v})=>{const T=b.querySelector(`[name="${I}"]`);T&&i[I]&&(v==="checkbox"?T.checked=i[I]==="on":T.value=i[I])})}},[c,l]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[c?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:y,onSubmit:b=>{b.preventDefault();const I=new FormData(b.target),v={};I.forEach((T,$)=>{v[$]=T==null?void 0:T.trim(),$==="instance"&&(v[$]=v[$].replace(/^https?:\/\//,"").replace(/\/+$/,""),v[$]=v[$].replace(/^@?[^@]+@/,""))}),v.type&&(t({result:v,mode:c?"edit":"add"}),b.target.reset(),d(null),o==null||o())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:n,onChange:b=>{d(b.target.value)},defaultValue:c?i.type:void 0,name:"type",children:[e("option",{}),Io.map(b=>e("option",{value:b,children:$s[b]}))]})]})}),(m=(S=Ot[l])==null?void 0:S.map)==null?void 0:m.call(S,({text:b,name:I,type:v,placeholder:T,pattern:$,notRequired:M})=>l==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!M,disabled:n||h==="loading",defaultValue:c?i.id:void 0,children:[e("option",{value:""}),a.map(V=>e("option",{value:V.id,children:V.title}))]})]})}):e("p",{children:e("label",{children:[e("span",{children:b})," ",e("input",{type:v,switch:v==="checkbox"||void 0,name:I,placeholder:T,required:v==="text"&&!M,disabled:n,list:l==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:$}),l==="hashtag"&&u.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:u.map(V=>e("option",{value:V.name}))})]})})),!!On[l]&&e("p",{class:"form-note insignificant",children:[e(w,{icon:"info"}),On[l]]}),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:n||h==="loading",children:c?"Save":"Add"}),c&&e("button",{type:"button",class:"light danger",onClick:()=>{C.shortcuts.splice(s,1),o==null||o()},children:"Remove"})]})]})})]})}function $o({shortcuts:t,onClose:n}){var a;const{masto:i}=K(),s=ge(()=>!t||!t.filter(Boolean).length?"":xn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,c]=A(""),[l,d]=A("default"),r=ge(()=>{if(!o)return d("default"),null;try{const p=JSON.parse(xn.decompressFromEncodedURIComponent(o));if(!Array.isArray(p))throw new Error("Not an array");return d("default"),p}catch{try{const u=JSON.parse(o);if(!Array.isArray(u))throw new Error("Not an array");return d("default"),u}catch{return d("error"),null}}},[o]),h=C.shortcuts.length>0,f=B();return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{class:"field-button",children:[e("input",{ref:f,type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:p=>{c(p.target.value)}}),C.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2 small",disabled:l==="cloud-downloading",onClick:async()=>{d("cloud-downloading");const p=ce.session.get("currentAccount");ie("Downloading saved shortcuts from instance server…");try{const g=(await i.v1.accounts.relationships.fetch({id:[p]}))[0];if(g){const{note:y=""}=g;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(y)){const S=y.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v:m,dt:b,data:I}=JSON.parse(S);f.current.value=I,f.current.dispatchEvent(new Event("input"))}}d("default")}catch{d("error"),ie("Unable to download shortcuts")}},title:"Download shortcuts from instance server",children:[e(w,{icon:"cloud"}),e(w,{icon:"arrow-down"})]})]}),!!r&&Array.isArray(r)&&e(R,{children:[e("p",{children:[e("b",{children:r.length})," shortcut",r.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:r.map(p=>{var u,g;return e("li",{children:[e("span",{style:{opacity:t.some(y=>Object.keys(y).every(S=>y[S]===p[S]))?1:0},children:"*"}),e("span",{children:[$s[p.type],p.type==="list"&&" ⚠️"," ",(g=(u=Ot[p.type])==null?void 0:u.map)==null?void 0:g.call(u,({text:y,name:S,type:m})=>p[S]?e(R,{children:[e("span",{class:"tag collapsed insignificant",children:[y,":"," ",m==="checkbox"?p[S]==="on"?"✅":"❌":p[S]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),l==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[h&&e(R,{children:[e(Qe,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const p=r.filter(y=>!C.shortcuts.some(S=>Object.keys(S).every(m=>S[m]===y[m])));if(!p.length){ie("No new shortcuts to import");return}let u=[...C.shortcuts,...p];const g=u.length>it;g&&(u=u.slice(0,it)),C.shortcuts=u,ie(g?`Shortcuts imported. Exceeded max ${it}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:"Import & append…"})})," "]}),e(Qe,{confirmLabel:h?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:h?"danger":void 0,onClick:()=>{C.shortcuts=r,ie("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:h?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:s,readOnly:!0,onClick:p=>{if(p.target.value){p.target.select();try{navigator.clipboard.writeText(p.target.value),ie("Shortcuts copied")}catch{ie("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.clipboard.writeText(s),ie("Shortcut settings copied")}catch{ie("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((a=navigator==null?void 0:navigator.canShare)==null?void 0:a.call(navigator,{text:s}))&&e("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.share({text:s})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",C.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2",disabled:l==="cloud-uploading",onClick:async()=>{d("cloud-uploading");const p=ce.session.get("currentAccount");try{const g=(await i.v1.accounts.relationships.fetch({id:[p]}))[0];if(g){const{note:y=""}=g;let S="";if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(y)){const m=JSON.stringify({v:"1",dt:Date.now(),data:s});S=y.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${m}</phanpy-shortcuts-settings>`)}else S=`${y}


<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;ie("Saving shortcuts to instance server…"),await i.v1.accounts.$select(p).note.create({comment:S}),d("default"),ie("Shortcuts saved")}}catch{d("error"),ie("Unable to save shortcuts")}},title:"Sync to instance server",children:[e(w,{icon:"cloud"}),e(w,{icon:"arrow-up"})]})," ",s.length>0&&e("small",{class:"insignificant ib",children:[s.length," characters"]})]}),!!s&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]}),C.settings.shortcutSettingsCloudImportExport&&e("footer",{children:e("p",{children:[e(w,{icon:"cloud"})," Import/export settings from/to instance server (Very experimental)"]})})]})]})}const Ao=Zs(()=>Vs(()=>import("./compose-W37-uzig.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));as(C,t=>{for(const[n,i,s,o]of t)/^show/i.test(i)&&!s&&nn()});function Ro(){var s,o,c,l,d,r,h,f;const t=Pe(C),n=rs(),i=It();return e(R,{children:[!!t.showCompose&&e(_e,{class:"solid",children:e(Gs,{children:e(Ao,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((s=window.__COMPOSE__)==null?void 0:s.replyToStatus)||null,editStatus:((o=C.showCompose)==null?void 0:o.editStatus)||((c=window.__COMPOSE__)==null?void 0:c.editStatus)||null,draftStatus:((l=C.showCompose)==null?void 0:l.draftStatus)||((d=window.__COMPOSE__)==null?void 0:d.draftStatus)||null,onClose:a=>{const{newStatus:p,instance:u,type:g}=a||{};C.showCompose=!1,window.__COMPOSE__=null,p&&(C.reloadStatusPage++,ie({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[g||"post"],delay:1e3,duration:1e4,onClick:y=>{y.hideToast(),C.prevLocation=i,n(u?`/${u}/s/${p.id}`:`/s/${p.id}`)}}))}})})}),!!t.showSettings&&e(_e,{onClose:()=>{C.showSettings=!1},children:e(Ni,{onClose:()=>{C.showSettings=!1}})}),!!t.showAccounts&&e(_e,{onClose:()=>{C.showAccounts=!1},children:e(xi,{onClose:()=>{C.showAccounts=!1}})}),!!t.showAccount&&e(_e,{onClose:()=>{C.showAccount=!1},children:e(oo,{account:((r=t.showAccount)==null?void 0:r.account)||t.showAccount,instance:(h=t.showAccount)==null?void 0:h.instance,onClose:({destination:a}={})=>{C.showAccount=!1}})}),!!t.showDrafts&&e(_e,{onClose:()=>{C.showDrafts=!1},children:e(co,{onClose:()=>C.showDrafts=!1})}),!!t.showMediaModal&&e(_e,{onClick:a=>{(a.target===a.currentTarget||a.target.classList.contains("media"))&&(C.showMediaModal=!1)},children:e(xs,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{C.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(_e,{onClose:()=>{C.showShortcutsSettings=!1},children:e(To,{onClose:()=>C.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(_e,{onClose:()=>{C.showGenericAccounts=!1},children:e(lo,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,postID:t.showGenericAccounts.postID,onClose:()=>C.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(_e,{onClose:a=>{C.showMediaAlt=!1},children:e(uo,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(f=t.showMediaAlt)==null?void 0:f.lang,onClose:()=>{C.showMediaAlt=!1}})}),!!t.showEmbedModal&&e(_e,{class:"solid",onClose:()=>{C.showEmbedModal=!1},children:e(ro,{html:t.showEmbedModal.html,url:t.showEmbedModal.url,width:t.showEmbedModal.width,height:t.showEmbedModal.height,onClose:()=>{C.showEmbedModal=!1}})}),!!t.showReportModal&&e(_e,{onClose:()=>{C.showReportModal=!1},children:e(fo,{account:t.showReportModal.account,post:t.showReportModal.post,onClose:()=>{C.showReportModal=!1}})})]})}function on({accountID:t,onChange:n}){const{masto:i}=K(),[s,o]=A("default"),[c,l]=A(null),[d,r]=A(null),h=d!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:s==="loading"||h,onClick:()=>{o("loading"),l("accept"),(async()=>{try{const f=await i.v1.followRequests.$select(t).authorize();if(!(f!=null&&f.followedBy))throw new Error("Follow request not accepted");r(f),n()}catch{}o("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:s==="loading"||h,class:"light danger",onClick:()=>{o("loading"),l("reject"),(async()=>{try{const f=await i.v1.followRequests.$select(t).reject();if(f!=null&&f.followedBy)throw new Error("Follow request not rejected");r(f),n()}catch{o("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:h&&c?c==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e($e,{hidden:s!=="loading"})})]})}const zn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning",severed_relationships:"heart-break",emoji_reaction:"emoji2","pleroma:emoji_reaction":"emoji2"};function Bn(t,n){let i,s;return typeof n=="string"?i=n:(i=n==null?void 0:n.url,s=n==null?void 0:n.staticUrl),i?e(R,{children:["reacted to your post with"," ",e(mi,{url:i,staticUrl:s,alt:t})]}):`reacted to your post with ${t}.`}const yt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(R,{children:["reported ",t]}),severed_relationships:t=>e(R,{children:["Lost connections with ",e("i",{children:t}),"."]}),emoji_reaction:Bn,"pleroma:emoji_reaction":Bn},Lo={account_suspension:({from:t,targetName:n})=>e(R,{children:["An admin from ",e("i",{children:t})," has suspended ",e("i",{children:n}),", which means you can no longer receive updates from them or interact with them."]}),domain_block:({from:t,targetName:n,followersCount:i,followingCount:s})=>e(R,{children:["An admin from ",e("i",{children:t})," has blocked ",e("i",{children:n}),". Affected followers: ",i,", followings: ",s,"."]}),user_domain_block:({targetName:t,followersCount:n,followingCount:i})=>e(R,{children:["You have blocked ",e("i",{children:t}),". Removed followers: ",n,", followings: ",i,"."]})},Qt=50;function _o({notification:t,instance:n,isStatic:i,disableContextMenu:s}){var V,U,F,ee,E,D;const{id:o,status:c,account:l,report:d,event:r,_accounts:h,_statuses:f}=t;let{type:a}=t;const p=(c==null?void 0:c.reblog)||c,u=p==null?void 0:p.id,g=ce.session.get("currentAccount"),y=g===(l==null?void 0:l.id),S=(V=c==null?void 0:c.poll)==null?void 0:V.voted,m=!!(c!=null&&c.inReplyToAccountId)&&(c==null?void 0:c.inReplyToAccountId)!==g&&((U=c==null?void 0:c.account)==null?void 0:U.id)===g;let b=0,I=0;if(a==="favourite+reblog"){for(const x of h)(F=x._types)!=null&&F.includes("favourite")&&b++,(ee=x._types)!=null&&ee.includes("reblog")&&I++;!I&&b&&(a="favourite"),!b&&I&&(a="reblog")}let v;if(a==="poll"?v=yt[y?"poll-self":S?"poll-voted":"poll"]:a==="reblog"||a==="favourite"||a==="favourite+reblog"?(f==null?void 0:f.length)>1?v=yt[`${a}+account`]:m?v=yt[`${a}_reply`]:v=yt[a]:yt[a]?v=yt[a]:v=`[Unknown notification type: ${a}]`,typeof v=="function"){const x=(f==null?void 0:f.length)||(h==null?void 0:h.length);if(a==="admin.report"){const q=d==null?void 0:d.targetAccount;q&&(v=v(e(kt,{account:q,showAvatar:!0})))}else if(a==="severed_relationships"){const q=r==null?void 0:r.targetName;q&&(v=v(q))}else if((a==="emoji_reaction"||a==="pleroma:emoji_reaction")&&t.emoji){const q=t.emoji_url||((D=(E=c==null?void 0:c.emojis)==null?void 0:E.find)==null?void 0:D.call(E,P=>(P==null?void 0:P.shortcode)===t.emoji.replace(/^:/,"").replace(/:$/,"")));v=v(t.emoji,q)}else x&&(v=v(x))}if(a==="mention"&&!c)return null;const T=t.createdAt&&new Date(t.createdAt).toLocaleString(),$={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[a]||"Accounts",M=()=>{C.showGenericAccounts={heading:$,accounts:h,showReactions:a==="favourite+reblog",excludeRelationshipAttrs:a==="follow"?["followedBy"]:[],postID:We(u,n)}};return e("div",{class:`notification notification-${a}`,"data-notification-id":o,tabIndex:"0",children:[e("div",{class:`notification-type notification-${a}`,title:T,children:a==="favourite+reblog"?e(R,{children:[e(w,{icon:"rocket",size:"xl",alt:a,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:a,class:"favourite-icon"})]}):e(w,{icon:zn[a]||"notification",size:"xl",alt:a})}),e("div",{class:"notification-content",children:[a!=="mention"&&e(R,{children:[e("p",{children:[!/poll|update/i.test(a)&&e(R,{children:(h==null?void 0:h.length)>1?e(R,{children:[e("b",{tabIndex:"0",onClick:M,children:[e("span",{title:h.length,children:Ge(h.length)})," ","people"]})," "]}):l&&e(R,{children:[e(kt,{account:l,showAvatar:!0})," "]})}),v,a==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(ft,{datetime:t.createdAt,format:"micro"})]})]}),a==="follow_request"&&e(on,{accountID:l.id}),a==="severed_relationships"&&e("div",{children:[Lo[r.type]({from:n,...r}),e("br",{}),e("a",{href:`https://${n}/severed_relationships`,target:"_blank",rel:"noopener noreferrer",children:["Learn more ",e(w,{icon:"external",size:"s"})]}),"."]})]}),(h==null?void 0:h.length)>1&&e("p",{class:"avatars-stack",children:[h.slice(0,Qt).map(x=>e(R,{children:[e("a",{href:x.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:q=>{q.preventDefault(),C.showAccount=x},children:[e(tt,{url:x.avatarStatic,size:h.length<=10?"xxl":h.length<20?"xl":h.length<30?"l":h.length<40?"m":"s",alt:`${x.displayName} @${x.acct}`,squircle:x==null?void 0:x.bot},x.id),a==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:x._types.map(q=>e(w,{icon:zn[q],size:"s",class:`${q}-icon`}))})]},x.id)," "]},x.id)),e("button",{type:"button",class:"small plain",onClick:M,children:[h.length>Qt&&`+${h.length-Qt}`,e(w,{icon:"chevron-down"})]})]}),(f==null?void 0:f.length)>1&&e("ul",{class:"notification-group-statuses",children:f.map(x=>e("li",{children:e(qn,{class:`status-link status-type-${a}`,to:n?`/${n}/s/${x.id}`:`/s/${x.id}`,children:e(ze,{status:x,size:"s",previewMode:!0,allowContextMenu:!0})})},x.id))}),c&&(!(f!=null&&f.length)||(f==null?void 0:f.length)<=1)&&e(qn,{class:`status-link status-type-${a}`,to:n?`/${n}/s/${u}`:`/s/${u}`,onContextMenu:s?void 0:x=>{const q=x.target.querySelector(".status");if(q){if(x.metaKey)return;x.preventDefault(),q.dispatchEvent(new MouseEvent("contextmenu",{clientX:x.clientX,clientY:x.clientY}))}},children:i?e(ze,{status:p,size:"s",readOnly:!0,allowContextMenu:!0}):e(ze,{statusID:u,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function qn(t){const n=gi();return e(ae,{...t,"data-read-more":"Read more →",ref:n})}const Kt=Ze(_o,(t,n)=>{var i,s;return((i=t.notification)==null?void 0:i.id)===((s=n.notification)==null?void 0:s.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{const{type:n,id:i,accessToken:s}=(t==null?void 0:t.data)||{};n==="notification"&&(C.routeNotification={id:i,accessToken:s})});const Eo=Ze(function(){if(!("serviceWorker"in navigator))return null;const n=Pe(C),{routeNotification:i}=n,{id:s,accessToken:o}=i||{},[c,l]=A(!1);ct(()=>{if(!s||!o)return;const{instance:r}=K(),{masto:h,instance:f}=K({accessToken:o}),a=r===f,p=o?js(o):vt();(async()=>{const u=await h.v1.notifications.$select(s).fetch();if(u&&p){const g=p.instanceURL,{type:y,status:S,account:m}=u,b=!!document.querySelector("#modal-container > *"),I=y==="follow"&&!!(m!=null&&m.id),v=!!(m!=null&&m.id),T=!!(S!=null&&S.id);I&&a?C.showAccount={account:m,instance:g}:b||!a||v&&T?l({id:s,account:p,notification:u,sameInstance:a}):T?location.hash=`/${r}/s/${S.id}`:I?location.hash=`/${r}/a/${m.id}`:location.hash="/notifications"}})()},[s,o]),ct(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),St(r=>{r&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const d=()=>{l(!1),C.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(c){const{id:r,account:h,notification:f,sameInstance:a}=c;return e(_e,{onClick:p=>{p.target===p.currentTarget&&d()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:d,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!a&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:p=>{const{target:u}=p;(p.target.tagName==="BUTTON"||p.target.tagName==="A")&&d()},children:e(Kt,{instance:h.instanceURL,notification:f,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(ae,{to:"/notifications",class:"button light",onClick:d,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null}),As=Xs((t,n)=>{const{instance:i}=K(),[s,o]=nt(),[c,l]=A(!1),[d,r]=A(s.get("q")||""),h=s.get("type"),f=B(null),a=B(null);return Js(n,()=>({setValue:p=>{r(p)},focus:()=>{a.current.focus()},select:()=>{a.current.select()},blur:()=>{a.current.blur()}})),e("form",{ref:f,class:"search-popover-container",onSubmit:p=>{var g;if(p.preventDefault(),/\/search/.test(location.hash))if(d){const y={q:d};h&&(y.type=h),o(y)}else o({});else d?location.hash=`/search?q=${encodeURIComponent(d)}${h?`&type=${h}`:""}`:location.hash="/search";(g=t==null?void 0:t.onSubmit)==null||g.call(t,p)},children:[e("input",{ref:a,value:d,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellCheck:"false",onSearch:p=>{p.target.value||o({})},onInput:p=>{r(p.target.value),l(!0)},onFocus:()=>{var p,u;l(!0),(u=(p=f.current)==null?void 0:p.querySelector(".search-popover-item"))==null||u.classList.add("focus")},onBlur:()=>{var p,u;setTimeout(()=>{l(!1)},100),(u=(p=f.current)==null?void 0:p.querySelector(".search-popover-item.focus"))==null||u.classList.remove("focus")},onKeyDown:p=>{var g;const{key:u}=p;switch(u){case"Escape":l(!1);break;case"Down":case"ArrowDown":if(p.preventDefault(),c){const y=f.current.querySelector(".search-popover-item.focus");if(y){let S=y.nextElementSibling;for(;S&&S.hidden;)S=S.nextElementSibling;S&&(S.classList.add("focus"),Array.from(S.parentElement.children).filter(b=>b!==S).forEach(b=>{b.classList.remove("focus")}))}else{const S=f.current.querySelector(".search-popover-item");S&&S.classList.add("focus")}}break;case"Up":case"ArrowUp":if(p.preventDefault(),c){const y=document.querySelector(".search-popover-item.focus");if(y){let S=y.previousElementSibling;for(;S&&S.hidden;)S=S.previousElementSibling;S&&(S.classList.add("focus"),Array.from(S.parentElement.children).filter(b=>b!==S).forEach(b=>{b.classList.remove("focus")}))}else{const S=document.querySelector(".search-popover-item:last-child");S&&S.classList.add("focus")}}break;case"Enter":if(c){const y=document.querySelector(".search-popover-item.focus");y&&(p.preventDefault(),y.click()),l(!1),(g=t==null?void 0:t.onSubmit)==null||g.call(t,p)}break}}}),e("div",{class:"search-popover",hidden:!c||!d,children:!!d&&[{label:e(R,{children:[d," ",e("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(d)}`,top:!h&&!/\s/.test(d),hidden:!!h},{label:e(R,{children:["Posts with ",e("q",{children:d})]}),to:`/search?q=${encodeURIComponent(d)}&type=statuses`,hidden:/^https?:/.test(d),top:/\s/.test(d),icon:"document",queryType:"statuses"},{label:e(R,{children:["Posts tagged with ",e("mark",{children:["#",d.replace(/^#/,"")]})]}),to:`/${i}/t/${d.replace(/^#/,"")}`,hidden:/^@/.test(d)||/^https?:/.test(d)||/\s/.test(d),top:/^#/.test(d),type:"link",icon:"hashtag",queryType:"hashtags"},{label:e(R,{children:["Look up ",e("mark",{children:d})]}),to:`/${d}`,hidden:!/^https?:/.test(d),top:/^https?:/.test(d),type:"link"},{label:e(R,{children:["Accounts with ",e("q",{children:d})]}),to:`/search?q=${encodeURIComponent(d)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((p,u)=>{if(h){if(p.queryType===h)return-1;if(u.queryType===h)return 1}return p.top&&!u.top?-1:!p.top&&u.top?1:0}).filter(({hidden:p})=>!p).map(({label:p,to:u,icon:g,type:y},S)=>e(ae,{to:u,class:`search-popover-item ${S===0?"focus":""}`,onClick:m=>{var b;(b=t==null?void 0:t.onSubmit)==null||b.call(t,m)},children:[e(w,{icon:g||(y==="link"?"arrow-right":"search"),class:"more-insignificant"}),e("span",{children:p})," "]}))})]})}),Mo=Ze(function({onClose:n=()=>{}}){const[i,s]=A(!1),o=B(null);Me(["Slash","/"],l=>{s(!0),setTimeout(()=>{var d,r,h,f;(r=(d=o.current)==null?void 0:d.focus)==null||r.call(d),(f=(h=o.current)==null?void 0:h.select)==null||f.call(h)},0)},{preventDefault:!0,ignoreEventWhen:l=>{const d=/\/search/.test(location.hash),r=!!document.querySelector("#modal-container > *");return d||r}});const c=()=>{s(!1),n()};return Me("esc",l=>{var d,r;(r=(d=o.current)==null?void 0:d.blur)==null||r.call(d),c()},{enabled:i,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!i,onClick:l=>{l.target===l.currentTarget&&c()},children:e(As,{ref:o,onSubmit:()=>{c()}})})});function Do(){const{instance:t}=K(),n=Pe(C),{shortcuts:i,settings:s}=n;if(!i.length||s.shortcutsViewMode==="multi-column"||!s.shortcutsViewMode&&s.shortcutsColumnsMode)return null;const o=B(),c=B(!1),l=i.map((f,a)=>{const{type:p,...u}=f;if(!Yt[p])return null;let{id:g,path:y,title:S,subtitle:m,icon:b}=Yt[p];return typeof g=="function"&&(g=g(u,a)),typeof y=="function"&&(y=y({...u,instance:u.instance||t},a)),typeof S=="function"&&(S=S(u,a)),typeof m=="function"&&(m=m(u,a)),typeof b=="function"&&(b=b(u,a)),g==="lists"&&(c.current=!0),{id:g,path:y,title:S,subtitle:m,icon:b}}).filter(Boolean),d=rs();Me(["1","2","3","4","5","6","7","8","9"],(f,a)=>{var u,g;const p=parseInt(a.keys[0],10)-1;if(p<l.length){const{path:y}=l[p];y&&(d(y),(g=(u=o.current)==null?void 0:u.closeMenu)==null||g.call(u))}});const[r,h]=A([]);return e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",onContextMenu:f=>{f.preventDefault(),C.showShortcutsSettings=!0},children:e("ul",{children:l.map(({id:f,path:a,title:p,subtitle:u,icon:g},y)=>e("li",{children:e(ae,{class:u?"has-subtitle":"",to:a,onClick:S=>{if(S.target.classList.contains("is-active")){S.preventDefault();const m=document.getElementById(`${f}-page`);if(m){m.scrollTop=0;const b=m.querySelector(".updates-button");b&&b.click()}}},children:[e(w,{icon:g,size:"xl",alt:p}),e("span",{children:[e(Ft,{children:p}),u&&e(R,{children:[e("br",{}),e("small",{children:u})]})]})]})},`${y}-${f}-${p}-${u}-${a}`))})}):e(Ke,{instanceRef:o,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",onMenuChange:f=>{f.open&&c.current&&_t().then(h)},menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:f=>{f.preventDefault(),C.showShortcutsSettings=!0},onTransitionStart:f=>{var a,p;try{const{target:u}=f;getComputedStyle(u).pointerEvents==="none"&&((p=(a=o.current)==null?void 0:a.closeMenu)==null||p.call(a))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:l.map(({id:f,path:a,title:p,subtitle:u,icon:g},y)=>f==="lists"?e(Vt,{menuClassName:"glass-menu",overflow:"auto",gap:-8,label:e(R,{children:[e(w,{icon:g,size:"l"}),e("span",{class:"menu-grow",children:e(Ft,{children:p})}),e(w,{icon:"chevron-right"})]}),children:[e(Ee,{to:"/l",children:e("span",{children:"All Lists"})}),e(Oe,{}),r==null?void 0:r.map(S=>e(Ee,{to:`/l/${S.id}`,children:e("span",{children:S.title})},S.id))]}):e(Ee,{to:a,class:"glass-menu-item",children:[e(w,{icon:g,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Ft,{children:p})}),u&&e(R,{children:[" ",e("small",{class:"more-insignificant",children:u})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:y+1})]},`${y}-${f}-${p}-${u}-${a}`))})})}const Po=Ze(Do);function No(t){var o;let n=[],i=[],s=0;for(let c=0;c<t.length;c++){const l=t[c];l.reblog&&!((o=l.account)!=null&&o.group)?(i.push(l),s++):(n.push(l),s<3&&(s=0))}if(t.length>10&&(i.length>t.length/4||s>=3)){const c=i.map(l=>l.id);if(i.length>t.length*3/4)n=[...n,{id:c,items:i,type:"boosts"}];else{const l=Math.floor(n.length/2);n=[...n.slice(0,l),{id:c,items:i,type:"boosts"},...n.slice(l)]}return n}else return t}function Hn(t,n){const i=ce.account.get("boostedStatusIDs")||{},s=t.filter(c=>{if(!c.reblog)return!0;const l=`${n}-${c.reblog.id}`,d=i[l];return d&&d!==c.id?!1:(i[l]=c.id,!0)}),o=Object.keys(i);return o.length>50&&o.slice(0,o.length-50).forEach(c=>{delete i[c]}),ce.account.set("boostedStatusIDs",i),s}function Uo(t,n){const i=[];let s=0;t.forEach(l=>{for(let r=0;r<i.length;r++){if(i[r].find(h=>h.id===l.id))return;if(i[r].find(h=>h.id===l.inReplyToId)||i[r].find(h=>h.inReplyToId===l.id)){i[r].push(l);return}}const d=t.find(r=>r.id===l.inReplyToId);d&&(i[s++]=[l,d])});for(let l=0;l<i.length;l++)for(let d=l+1;d<i.length;d++)i[l].find(h=>i[d].includes(h))&&(i[l]=[...i[l],...i[d]],i[l]=i[l].filter((h,f,a)=>a.findIndex(p=>p.id===h.id)===f),i.splice(d,1),d--);i.forEach(l=>{l.sort((d,r)=>!d.inReplyToId&&!r.inReplyToId?new Date(d.createdAt)-new Date(r.createdAt):d.inReplyToId===r.id?1:r.inReplyToId===d.id||!d.inReplyToId?-1:r.inReplyToId?new Date(d.createdAt)-new Date(r.createdAt):1)}),i.forEach(l=>{const d=l[0].account.id;l.forEach(r=>{r.account.id!==d&&(r._differentAuthor=!0)})}),i.length;const o=[],c=[];return t.forEach(l=>{if(l.reblog){o.push(l);return}for(let d=0;d<i.length;d++)if(i[d].find(r=>r.id===l.id)){if(c.includes(d))return;const r=i[d];r.sort((f,a)=>{const p=new Date(f.createdAt),u=new Date(a.createdAt);return p-u});const h=r[0].account.id;o.push({id:r.map(f=>f.id),items:r,type:r.every(f=>f.account.id===h)?"thread":"conversation"}),c.push(d);return}if(l.inReplyToId&&l.inReplyToAccountId!==l.account.id){const d=We(l.id,n);C.statusReply[d]||queueMicrotask(async()=>{try{const{masto:r}=K({instance:n}),h=await Fo(l.inReplyToId,r);Be(h,n,{skipThreading:!0,skipUnfurling:!0}),C.statusReply[d]={id:h.id,instance:n}}catch{}})}o.push(l)}),o}const Fo=lt((t,n)=>n.v1.statuses.$select(t).fetch());async function Rs(t,n){const i=await ko();if(!i.length)return;const{statusFollowedTags:s}=C,o=[];if(t.forEach(c=>{var p;if(c.reblog)return;const{id:l,content:d,tags:r=[]}=c,h=We(l,n);if((p=s[h])!=null&&p.length)return;const f=So(d);if(!f.length&&!r.length)return;const a=i.reduce((u,g)=>((f.some(y=>y.toLowerCase()===g.name.toLowerCase())||r.some(y=>y.name.toLowerCase()===g.name.toLowerCase()))&&u.push(g.name),u),[]);a.length&&o.push({item:c,sKey:h,followedTags:a})}),o.length){const c=o.map(d=>d.item.account),l=await bn(c);if(!l)return;o.forEach(d=>{const{item:r,sKey:h,followedTags:f}=d,a=l[r.account.id];a&&!a.following&&(s[h]=f)})}}function Oo(){C.statusFollowedTags={}}function zo({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:s=10,scrollThresholdEnd:o=10,direction:c="vertical",distanceFromStartPx:l,distanceFromEndPx:d}={}){const[r,h]=A(null),[f,a]=A(!1),[p,u]=A(!1),[g,y]=A(!1),[S,m]=A(!1),b=c==="vertical";return ct(()=>{const I=t.current;if(!I)return{};let v=b?I.scrollTop:I.scrollLeft;function T(){const{scrollTop:$,scrollLeft:M,scrollHeight:V,scrollWidth:U,clientHeight:F,clientWidth:ee}=I,E=b?$:M,D=b?V:U,x=b?F:ee,q=Math.abs(E-v),P=l||Math.min(x*n,D,E),oe=d||Math.min(x*i,D,D-E-x);q>=(v<E?o:s)&&(h(v<E?"end":"start"),v=E),a(E<=0),u(E+x>=D),y(E<=P),m(E+x>=D-oe)}return I.addEventListener("scroll",T,{passive:!0}),()=>I.removeEventListener("scroll",T)},[n,i,s,o]),{scrollDirection:r,reachStart:f,reachEnd:p,nearReachStart:g,nearReachEnd:S,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function Bo({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:s=10,scrollThresholdEnd:o=10,direction:c="vertical",distanceFromStartPx:l,distanceFromEndPx:d,init:r}={},h,f){if(!h)return;const a=c==="vertical",p=B(null),u=B(null),g=Qs(()=>{let y=!1,S=!1,m=!1,b=!1;const I=t.current,{scrollTop:v,scrollLeft:T,scrollHeight:$,scrollWidth:M,clientHeight:V,clientWidth:U}=I,F=a?v:T,ee=a?$:M,E=a?V:U,D=Math.abs(F-p.current),x=l||Math.min(E*n,ee,F),q=d||Math.min(E*i,ee,ee-F-E);D>=(p.current<F?o:s)&&(u.current=p.current<F?"end":"start",p.current=F),y=F<=0,S=F+E>=ee,m=F<=x,b=F+E>=ee-q,h({scrollDirection:u.current,reachStart:y,reachEnd:S,nearReachStart:m,nearReachEnd:b})},500);ct(()=>{const y=t.current;return y?(p.current=y[a?"scrollTop":"scrollLeft"],y.addEventListener("scroll",g,{passive:!0}),()=>y.removeEventListener("scroll",g)):{}},[n,i,s,o,...f]),W(()=>{r&&t.current&&queueMicrotask(()=>{t.current.dispatchEvent(new Event("scroll"))})},[r])}function qo({class:t,statusID:n,status:i,instance:s,parent:o,onMediaClick:c}){let l=We(n,s);const d=Pe(C);if(i||(i=d.statuses[l]||d.statuses[n],l=We(i==null?void 0:i.id,s)),!i)return null;const{account:{acct:r,avatar:h,avatarStatic:f,id:a,url:p,displayName:u,username:g,emojis:y,bot:S,group:m},id:b,repliesCount:I,reblogged:v,reblogsCount:T,favourited:$,favouritesCount:M,bookmarked:V,poll:U,muted:F,sensitive:ee,spoilerText:E,visibility:D,language:x,editedAt:q,filtered:P,card:oe,createdAt:Ce,inReplyToId:Ie,inReplyToAccountId:H,content:we,mentions:re,mediaAttachments:pe,reblog:ve,uri:De,url:Se,emojis:Ue,_deleted:Ne,_pinned:Te}=i;if(!(pe!=null&&pe.length))return null;const X=se=>{se.shiftKey},le=ge(()=>ce.session.get("currentAccount"),[]),te=ge(()=>le&&le===a,[a,le]),xe=ei(ys),de=!te&&Gt(P,xe);if((de==null?void 0:de.action)==="hide")return null;const ne=ee,L=ge(()=>(ce.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",J=o||"div";return pe.map((se,_)=>{const Y=`${l}-${se.id}`,Q=de==null?void 0:de.titlesStr;return e(J,{"data-state-post-id":l,onMouseEnter:X,"data-spoiler-text":E||(ee?"Sensitive media":void 0),"data-filtered-text":de?`Filtered${Q?`: ${Q}`:""}`:void 0,class:`
          media-post
          ${de?"filtered":""}
          ${ne?"has-spoiler":""}
          ${L?"show-media":""}
        `,children:e(bs,{class:t,media:se,lang:x,to:`/${s}/s/${b}?media-only=${_+1}`,onClick:c?ke=>c(ke,_,se,i):void 0})},Y)})}const Vn=Ze(qo);function Ho(t){var v,T,$,M,V;const n=Pe(C),{masto:i,instance:s,authenticated:o}=K(),[c,l]=ge(()=>{const U=ce.local.getJSON("accounts")||[];return[U.find(ee=>ee.info.id===ce.session.get("currentAccount"))||U[0],U.length>1]},[]),d=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(U=>U.type==="following"),r=ti(()=>{C.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),h=B(),[f,a]=A(void 0),p=bi([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),u=B();async function g(U){return(U||!u.current)&&(u.current=i.v1.mutes.list({limit:80})),await u.current.next()}const y=B();async function S(U){return(U||!y.current)&&(y.current=i.v1.blocks.list({limit:80})),await y.current.next()}const[m,b]=A([]);W(()=>{f==="open"&&_t().then(b)},[f==="open"]);const I=B();return e(R,{children:[e("button",{ref:h,type:"button",class:`button plain nav-menu-button ${l?"with-avatar":""} ${f==="open"?"active":""}`,style:{position:"relative"},onClick:()=>{I.current=Date.now(),a(U=>U?void 0:"open")},onContextMenu:U=>{U.preventDefault(),C.showAccounts=!0},...r(),children:[l&&e(tt,{url:((v=c==null?void 0:c.info)==null?void 0:v.avatar)||((T=c==null?void 0:c.info)==null?void 0:T.avatarStatic),size:"l",squircle:($=c==null?void 0:c.info)==null?void 0:$.bot}),e(w,{icon:"menu",size:l?"s":"l"})]}),e(ls,{menuClassName:"nav-menu",state:f,anchorRef:h,onClose:()=>{a(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-I.current<300}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:p,unmountOnClose:!0,children:[!!((M=n.appVersion)!=null&&M.commitHash)&&n.appVersion.commitHash!=="65d51b0"&&e("div",{class:"top-menu",children:[e(he,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(Oe,{})]}),e("section",{children:[e(Ee,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),o?e(R,{children:[d&&e(Ee,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Ee,{to:"/catchup",children:[e(w,{icon:"history2",size:"l"}),e("span",{children:"Catch-up"})]}),e(Ee,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Ee,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(Oe,{}),((V=c==null?void 0:c.info)==null?void 0:V.id)&&e(Ee,{to:`/${s}/a/${c.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),(m==null?void 0:m.length)>0?e(Vt,{menuClassName:"nav-submenu",overflow:"auto",gap:-8,label:e(R,{children:[e(w,{icon:"list",size:"l"}),e("span",{class:"menu-grow",children:"Lists"}),e(w,{icon:"chevron-right"})]}),children:[e(Ee,{to:"/l",children:e("span",{children:"All Lists"})}),(m==null?void 0:m.length)>0&&e(R,{children:[e(Oe,{}),m.map(U=>e(Ee,{to:`/l/${U.id}`,children:e("span",{children:U.title})},U.id))]})]}):e(Ee,{to:"/l",children:[e(w,{icon:"list",size:"l"}),e("span",{children:"Lists"})]}),e(Ee,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Vt,{menuClassName:"nav-submenu",overflow:"auto",gap:-8,label:e(R,{children:[e(w,{icon:"more",size:"l"}),e("span",{class:"menu-grow",children:"More…"}),e(w,{icon:"chevron-right"})]}),children:[e(Ee,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]}),e(Ee,{to:"/fh",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Oe,{}),e(Ee,{to:"/ft",children:[e(w,{icon:"filters",size:"l"}),"Filters"]}),e(he,{onClick:()=>{C.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:g,excludeRelationshipAttrs:["muting"]}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(he,{onClick:()=>{C.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:S,excludeRelationshipAttrs:["blocking"]}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]})," "]}),e(Oe,{}),e(he,{onClick:()=>{C.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]})]}):e(R,{children:[e(Oe,{}),e(Ee,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]})]})]}),e("section",{children:[e(Oe,{}),e(Ee,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Ee,{to:`/${s}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]}),e(Ee,{to:`/${s}/p/l`,children:[e(w,{icon:"building",size:"l"})," ",e("span",{children:"Local"})]}),e(Ee,{to:`/${s}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),o?e(R,{children:[e(Oe,{className:"divider-grow"}),e(he,{onClick:()=>{C.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(he,{onClick:()=>{C.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(he,{onClick:()=>{C.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(R,{children:[e(Oe,{}),e(he,{onClick:()=>{C.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})]})]})]})}const mt=Ze(Ho),Mt={block:"nearest",inline:"center",behavior:"smooth"};function at({title:t,titleComponent:n,id:i,instance:s,emptyText:o,errorText:c,useItemID:l,boostsCarousel:d,fetchItems:r=()=>{},checkForUpdates:h=()=>{},checkForUpdatesInterval:f=15e3,headerStart:a,headerEnd:p,timelineStart:u,refresh:g,view:y,filterContext:S,showFollowedTags:m,showReplyParent:b}){const I=Pe(C),[v,T]=A([]),[$,M]=A("start"),[V,U]=A(!1),[F,ee]=A(!1),[E,D]=A(!0),x=B(),q=y!=="media",P=ni(X=>{ee(!1),$!=="loading"&&(M("loading"),(async()=>{try{let{done:le,value:te}=await r(X);if(Array.isArray(te)){const[xe,de]=te.reduce((ne,G)=>(G._pinned?ne[0].push(G):ne[1].push(G),ne),[[],[]]);te=de,q&&(d&&(te=No(te)),te=Uo(te,s)),xe.length&&(te=xe.concat(te)),T(X?te:ne=>[...ne,...te]),te.length||(le=!0),U(!le)}else U(!1);M("default")}catch{M("error")}finally{P.cancel()}})())},1500,{leading:!0,trailing:!1}),oe=".timeline-item, .timeline-item-alt",Ce=Me("j, shift+j",(X,le)=>{const te=document.activeElement.closest(oe),xe=te==null?void 0:te.getBoundingClientRect(),de=Array.from(x.current.querySelectorAll(oe));if(te&&xe.top<x.current.clientHeight&&xe.bottom>0){const ne=de.indexOf(te);let G=de[ne+1];le.shift&&(G=de.find((L,J)=>J>ne&&!L.classList.contains("timeline-item-alt"))),G&&(G.focus(),G.scrollIntoView(Mt))}else{const ne=de.find(G=>{const L=G.getBoundingClientRect();return L.top>=44&&L.left>=0});ne&&(ne.focus(),ne.scrollIntoView(Mt))}}),Ie=Me("k, shift+k",(X,le)=>{const te=document.activeElement.closest(oe),xe=te==null?void 0:te.getBoundingClientRect(),de=Array.from(x.current.querySelectorAll(oe));if(te&&xe.top<x.current.clientHeight&&xe.bottom>0){const ne=de.indexOf(te);let G=de[ne-1];le.shift&&(G=de.findLast((L,J)=>J<ne&&!L.classList.contains("timeline-item-alt"))),G&&(G.focus(),G.scrollIntoView(Mt))}else{const ne=de.find(G=>{const L=G.getBoundingClientRect();return L.top>=44&&L.left>=0});ne&&(ne.focus(),ne.scrollIntoView(Mt))}}),H=Me(["enter","o"],()=>{const X=document.activeElement.closest(oe);X&&X.click()}),we=v.length>0&&$!=="loading"&&F,re=Xe(()=>{var X;we&&P(!0),(X=x.current)==null||X.scrollTo({top:0,behavior:"smooth"})},[P,we]),pe=Me(".",re),ve=B(),[De,Se]=A(!1);Bo({scrollableRef:x,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:X,nearReachStart:le,reachStart:te})=>{if(ve.current){const xe=X==="end"&&!le;ve.current.hidden=xe}Se(le),te&&P(!0)},[]),W(()=>{var X;(X=x.current)==null||X.scrollTo({top:0}),P(!0)},[]),W(()=>{P(!0)},[g]);const Ue=B(y);W(()=>{Ue.current!==y&&(Ue.current=y,T([]))},[y]);const Ne=Xe(async({disableIdleCheck:X=!1}={})=>{const le=x.current?getComputedStyle(x.current).pointerEvents==="none":!1;I.settings.autoRefresh&&x.current.scrollTop<16&&(X||window.__IDLE__)&&!Yo()&&!le?P(!0):await h()&&ee(!0)},[i,P,h,I.settings.autoRefresh]),Te=B();return St(X=>{if(X){const le=Date.now()-Te.current;(!Te.current||le>1e3*3)&&Ne({disableIdleCheck:!0})}else Te.current=Date.now();D(X)},[h,Ne,I.settings.autoRefresh]),hn(Ne,E&&!F?f*(De?1:2):null),e(ys.Provider,{value:S,children:e("div",{id:`${i}-page`,class:"deck-container",ref:X=>{x.current=X,Ce.current=X,Ie.current=X,H.current=X,pe.current=X},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{ref:ve,onClick:X=>{var le;X.target.closest("a, button")||(le=x.current)==null||le.scrollTo({top:0,behavior:"smooth"})},onDblClick:X=>{X.target.closest("a, button")||P(!0)},class:$==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),a??e(ae,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!p&&p})]}),we&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:re,children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!u&&e("div",{class:`timeline-start ${$==="loading"?"loading":""}`,children:u}),v.length?e(R,{children:[e("ul",{class:`timeline ${y?`timeline-${y}`:""}`,children:[v.map(X=>e(Vo,{status:X,instance:s,useItemID:l,filterContext:S,view:y,showFollowedTags:m,showReplyParent:b},X.id+(X==null?void 0:X._pinned)+y)),V&&$==="loading"&&(y==="media"?null:e(R,{children:[e("li",{style:{height:"20vh"},children:e(ze,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(ze,{skeleton:!0})})]}))]}),$==="default"&&(V?e(ot,{root:x.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:X=>{X&&P()},children:e("button",{type:"button",class:"plain block",onClick:()=>P(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):$==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((X,le)=>y==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(ze,{skeleton:!0})},le))}):$!=="error"&&$!=="start"&&e("p",{class:"ui-state",children:o}),$==="error"&&e("p",{class:"ui-state",children:[c,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>P(!v.length),children:"Try again"})]})]})})})}const Vo=Ze(({status:t,instance:n,useItemID:i,filterContext:s,view:o,showFollowedTags:c,showReplyParent:l})=>{const{id:d,reblog:r,items:h,type:f,_pinned:a}=t;a&&(i=!1);const p=(r==null?void 0:r.id)||d,u=n?`/${n}/s/${p}`:`/s/${p}`;if(h){const y=Tt(h,s);let S="";if(f==="boosts"?S=`${y.length} Boosts`:f==="pinned"&&(S="Pinned posts"),f==="boosts"||f==="pinned")return y.sort((I,v)=>{const T=Gt(I.filtered,s),$=Gt(v.filtered,s);return T&&!$?1:!T&&$?-1:0}),e("li",{class:"timeline-item-carousel",children:e(Go,{title:S,class:`${f}-carousel`,children:y.map(I=>{const{id:v,reblog:T,_pinned:$}=I,M=(T==null?void 0:T.id)||v,V=n?`/${n}/s/${M}`:`/s/${M}`;return $&&(i=!1),e("li",{children:e(ae,{class:"status-carousel-link timeline-item-alt",to:V,children:i?e(ze,{statusID:v,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):e(ze,{status:I,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},v)})})},`timeline-${d}`);const b=y.length>3;return y.map((I,v)=>{const{id:T,_differentAuthor:$}=I,M=n?`/${n}/s/${T}`:`/s/${T}`,V=v>0&&v<y.length-1,U=I.sensitive&&!!I.spoilerText,F=!$&&U&&v>0||b&&V&&(f==="thread"||f==="conversation"&&!$&&!y[v-1]._differentAuthor&&!y[v+1]._differentAuthor),ee=v===0,E=v===y.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${f} timeline-item-container-${ee?"start":E?"end":"middle"} ${$?"timeline-item-diff-author":""}`,children:e(ae,{class:"status-link timeline-item",to:M,children:F?e(jo,{status:I,instance:n}):i?e(ze,{statusID:T,instance:n,enableCommentHint:E,showFollowedTags:c}):e(ze,{status:I,instance:n,enableCommentHint:E,showFollowedTags:c})})},`timeline-${T}`)})}const g=`timeline-${d+a}`;return o==="media"?i?e(Vn,{class:"timeline-item",parent:"li",statusID:d,instance:n},g):e(Vn,{class:"timeline-item",parent:"li",status:t,instance:n},g):e("li",{children:e(ae,{class:"status-link timeline-item",to:u,children:i?e(ze,{statusID:d,instance:n,enableCommentHint:!0,showFollowedTags:c,showReplyParent:l}):e(ze,{status:t,instance:n,enableCommentHint:!0,showFollowedTags:c,showReplyParent:l})})},g)},(t,n)=>{var o,c;const i=(((o=t.status)==null?void 0:o.id)||"").toString(),s=(((c=n.status)==null?void 0:c.id)||"").toString();return i===s&&t.instance===n.instance&&t.view===n.view});function Go({title:t,class:n,children:i}){const s=B(),o=B(),c=B(),[l,d]=A(!1);return W(()=>{setTimeout(()=>{d(!0)},1)},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{ref:o,type:"button",class:"small plain2",onClick:()=>{var r,h;(h=s.current)==null||h.scrollBy({left:-Math.min(320,(r=s.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{ref:c,type:"button",class:"small plain2",onClick:()=>{var r,h;(h=s.current)==null||h.scrollBy({left:Math.min(320,(r=s.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:s,children:[e(ot,{class:"status-carousel-beacon",onChange:r=>{o.current&&(o.current.disabled=r)}}),i[0],l&&i.slice(1),e(ot,{class:"status-carousel-beacon",onChange:r=>{c.current&&(c.current.disabled=r)}})]})]})}function jo({status:t,instance:n}){const i=Pe(C),{id:s,visibility:o,language:c}=t,l=pn(t),d=We(s,n);return e("article",{class:`status compact-thread ${o==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[i.statusThreadNumber[d]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),i.statusThreadNumber[d]?` ${i.statusThreadNumber[d]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:l,lang:c,dir:"auto",children:[l,t.sensitive&&t.spoilerText&&e(R,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function Yo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const wt=20,vn=1983,Gn=`${vn}-01`,Wo=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function Ko(t){var s;const{masto:n}=K({instance:t}),i=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((s=i==null?void 0:i.statuses)!=null&&s.length)}const Zo=lt(Ko);function Jo(){const t=Pe(C),{id:n,...i}=pt(),[s,o]=nt(),c=s.get("month"),l=!s.get("replies"),d=!!s.get("boosts"),r=s.get("tagged"),h=!!s.get("media"),{masto:f,instance:a,authenticated:p}=K({instance:i.instance}),{masto:u,instance:g}=K(),y=B(),S=[c,l,d,r,h],[m,b]=A(),I=B(0);W(()=>{I.current=0},S);const v=ge(()=>a===g,[a,g]),[T,$]=A(!1);W(()=>{v&&m!=null&&m.acct&&(async()=>{const H=await Zo(a);$(H)})()},[a,v,m==null?void 0:m.acct]);async function M(H){var Se,Ue,Ne;const we=/^\d{4}-[01]\d$/.test(c),re=((Ue=(Se=c==null?void 0:c.split)==null?void 0:Se.call(c,"-"))==null?void 0:Ue[0])>=vn;if(we&&re){if(!m)return{value:[],done:!0};const[Te,X]=c.split("-"),le=parseInt(X,10)-1,te=new Date(Te,le,0),xe=`${te.getFullYear()}-${(te.getMonth()+1).toString().padStart(2,"0")}-${te.getDate().toString().padStart(2,"0")}`,de=new Date(Te,le+1,1),ne=`${de.getFullYear()}-${(de.getMonth()+1).toString().padStart(2,"0")}-${de.getDate().toString().padStart(2,"0")}`;let G;H?(G=wt+1,I.current=0):(G=wt+I.current+1,I.current+=wt);const L=await f.v2.search.fetch({q:`from:${m.acct} after:${xe} before:${ne}`,type:"statuses",limit:G,offset:I.current});if((Ne=L==null?void 0:L.statuses)!=null&&Ne.length){const J=L.statuses.slice(0,wt);J.forEach(_=>{Be(_,a)});const se=L.statuses.length<=wt;return{value:J,done:se}}else return{value:[],done:!0}}const pe=[];if(H){const{value:Te}=await f.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(Te!=null&&Te.length&&!r&&!h){const X=Te.map(le=>(Be(le,a),{...le,_pinned:!0}));if(X.length>=3){const le=X.map(te=>te.id);pe.push({id:le,items:X,type:"pinned"})}else pe.push(...X)}}(H||!y.current)&&(y.current=f.v1.accounts.$select(n).statuses.list({limit:wt,exclude_replies:l,exclude_reblogs:d,only_media:h,tagged:r}));const{value:ve,done:De}=await y.current.next();return ve!=null&&ve.length&&(pe.push(...ve),ve.forEach(Te=>{Be(Te,a)})),{value:pe,done:De}}const[V,U]=A([]);qe(m!=null&&m.acct?`${m!=null&&m.displayName?`${m.displayName} (${/@/.test(m.acct)?"":"@"}${m.acct})`:`${/@/.test(m.acct)?"":"@"}${m.acct}`}${l?d?" (- Boosts)":r?` (#${r})`:h?" (Media)":c?` (${new Date(c).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const F=B(),ee=Xe(()=>{const H=F.current||f.v1.accounts.$select(n).fetch();return F.current=H,H},[n,f]);W(()=>{(async()=>{try{const H=await ee();b(H)}catch{}try{const H=await f.v1.accounts.$select(n).featuredTags.list();U(H)}catch{}})()},[n]);const{displayName:E,acct:D,emojis:x}=m||{},q=B(),P=ge(()=>{const H=!l||d||r||h||!!c,we=t.accounts[`${n}@${a}`];return e(R,{children:[e(Ts,{instance:a,account:we||n,fetchAccount:ee,authenticated:p,standalone:!0}),e("div",{class:"filter-bar",ref:q,style:{position:"relative"},children:[H?e(ae,{to:`/${a}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(ae,{to:`/${a}/a/${n}${l?"?replies=1":""}`,onClick:()=>{l&&ie("Showing post with replies")},class:l?"":"is-active",children:"+ Replies"}),e(ae,{to:`/${a}/a/${n}${d?"":"?boosts=0"}`,onClick:()=>{d||ie("Showing posts without boosts")},class:d?"is-active":"",children:"- Boosts"}),e(ae,{to:`/${a}/a/${n}${h?"":"?media=1"}`,onClick:()=>{h||ie("Showing posts with media")},class:h?"is-active":"",children:"Media"}),V.map(re=>e(ae,{to:`/${a}/a/${n}${r===re.name?"":`?tagged=${encodeURIComponent(re.name)}`}`,onClick:()=>{r!==re.name&&ie(`Showing posts tagged with #${re.name}`)},class:r===re.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),re.name]})},re.id)),T&&(Wo?e("label",{class:`filter-field ${c?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(m!=null&&m.acct),value:c||"",min:Gn,max:new Date().toISOString().slice(0,7),onInput:re=>{const{value:pe,validity:ve}=re.currentTarget;if(!ve.valid)return;o(pe?{month:pe}:{});const[De,Se]=pe.split("-"),Ue=parseInt(Se,10)-1,Ne=new Date(De,Ue);ie(`Showing posts in ${Ne.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):e(Xo,{class:`filter-field ${c?"is-active":""}`,disabled:!(m!=null&&m.acct),value:c||"",min:Gn,max:new Date().toISOString().slice(0,7),onInput:re=>{const{value:pe,validity:ve}=re;ve.valid&&o(pe?{month:pe}:{})}}))]})]})},[n,a,p,V,ee,T,...S]);W(()=>{var we;const H=(we=q.current)==null?void 0:we.querySelector(".is-active");H&&q.current.scrollTo({behavior:"smooth",left:H.offsetLeft-(q.current.offsetWidth-H.offsetWidth)/2})},[V,T,...S]);const oe=ge(()=>m!=null&&m.url?new URL(m.url).hostname:null,[m]),Ie=!!m&&!(a===oe);return e(at,{title:`${m!=null&&m.acct?"@"+m.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(ms,{text:E,emojis:x})}),e("div",{children:e("span",{children:["@",D]})})]}),id:"account-statuses",instance:a,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:M,useItemID:!0,view:h?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:P,refresh:[l,d,r,h,c+(m==null?void 0:m.acct)].toString(),headerEnd:e(Ke,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(he,{disabled:!Ie,onClick:()=>{(async()=>{try{const{masto:H}=K({instance:oe}),we=await H.v1.accounts.lookup({acct:m.acct}),{id:re}=we;location.hash=`/${oe}/a/${re}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance"," ",oe?e(R,{children:[" ","(",e("b",{children:Ct.toUnicode(oe)}),")"]}):null]})]}),!v&&e(he,{onClick:()=>{(async()=>{try{const H=await u.v1.accounts.lookup({acct:m.acct+"@"+a}),{id:we}=H;location.hash=`/${g}/a/${we}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to my instance (",e("b",{children:g}),")"]})]})]})},n)}function Xo(t){const{class:n,disabled:i,value:s,min:o,max:c,onInput:l=()=>{}}=t,[d,r]=(s==null?void 0:s.split("-"))||[],h=B(),f=B(),a=(p,u)=>{const[g,y]=(o==null?void 0:o.split("-"))||[],[S,m]=(c==null?void 0:c.split("-"))||[];return!(u<g||u>S||u===g&&p<y||u===S&&p>m)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:h,disabled:i,value:r||"",onInput:p=>{const{value:u}=p.currentTarget,g=f.current.value;if(!a(u,g))return{value:"",validity:{valid:!1}};l({value:u?`${g}-${u}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(p,u)=>e("option",{value:(u+1).toString().padStart(2,"0"),children:new Date(0,u).toLocaleString("default",{month:"long"})},u))]})," ",e("input",{ref:f,type:"number",disabled:i,value:d||new Date().getFullYear(),min:(o==null?void 0:o.slice(0,4))||vn,max:(c==null?void 0:c.slice(0,4))||new Date().getFullYear(),onInput:p=>{const{value:u,validity:g}=p.currentTarget,y=h.current.value;if(!g.valid||!a(y,u))return{value:"",validity:{valid:!1}};l({value:u?`${u}-${y}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const Qo=20;function Ls(){qe("Bookmarks","/b");const{masto:t,instance:n}=K(),i=B();async function s(o){return(o||!i.current)&&(i.current=t.v1.bookmarks.list({limit:Qo})),await i.current.next()}return e(at,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:s})}const ec=""+new URL("catch-up-DuauQu-W.png",import.meta.url).href,tc="home",Ye=[{label:"last 1 hour",value:1},{label:"last 2 hours",value:2},{label:"last 3 hours",value:3},{label:"last 4 hours",value:4},{label:"last 5 hours",value:5},{label:"last 6 hours",value:6},{label:"last 7 hours",value:7},{label:"last 8 hours",value:8},{label:"last 9 hours",value:9},{label:"last 10 hours",value:10},{label:"last 11 hours",value:11},{label:"last 12 hours",value:12},{label:"beyond 12 hours",value:13}],nc=["Original","Replies","Boosts","Followed tags","Groups","Filtered"],sc=["createdAt","repliesCount","favouritesCount","reblogsCount","density"],ic=[null,"account"],jn={Filtered:"filtered",Groups:"group",Boosts:"boost",Replies:"reply","Followed tags":"followedTags",Original:"original"},oc={Filtered:"filtered posts",Groups:"group posts",Boosts:"boosts",Replies:"replies","Followed tags":"followed-tag posts",Original:"original posts"},cc={createdAt:["oldest","latest"],repliesCount:["fewest replies","most replies"],favouritesCount:["fewest likes","most likes"],reblogsCount:["fewest boosts","most boosts"],density:["least dense","most dense"]};function ac(){qe("Catch-up","/catchup");const{masto:t,instance:n}=K(),[i,s]=nt(),o=i.get("id"),[c,l]=A("start"),[d,r]=A(!1),h=ge(()=>ce.session.get("currentAccount"),[]),f=k=>k===h;async function a({maxCreatedAt:k}){var j,be,ue;const N=k?new Date(k):null,z=[],O=t.v1.timelines.home.list({limit:40});e:for(;;)try{const me=await O.next(),{value:fe}=me;if(fe!=null&&fe.length){await Rs(fe,n);let Ae=!1;for(let Ve=0;Ve<fe.length;Ve++){const Re=fe[Ve],He=new Date(Re.createdAt);if(!N||He>=N){const Z=!f(((be=(j=Re.reblog)==null?void 0:j.account)==null?void 0:be.id)||Re.account.id)&&Gt(((ue=Re.reblog)==null?void 0:ue.filtered)||Re.filtered,tc);if((Z==null?void 0:Z.action)==="hide")continue;Re._filtered=Z;const Le=We(Re.id,n);Re._followedTags=C.statusFollowedTags[Le]?[...C.statusFollowedTags[Le]]:[],z.push(Re),Ae=!0}if(!Ae)break e}}else break e;await new Promise(Ae=>setTimeout(Ae,1e3))}catch{break e}return z.forEach(me=>{if(me!=null&&me.inReplyToId){const fe=z.find(Ae=>Ae.id===me.inReplyToId);fe&&!fe.inReplyToId&&(fe._thread=!0)}}),z}const[p,u]=A([]),g=B(),y=B(),S=ge(()=>Ht(),[]),m=Xe(async({duration:k}={})=>{const N=Date.now(),z=k?N-k:null;l("loading");const O=await a({maxCreatedAt:z}),j=`${S}-${si()}`;try{await et.catchup.set(j,{id:j,posts:O,count:O.length,startAt:z,endAt:N}),s({id:j})}catch{}},[]);W(()=>{o?(async()=>{const k=await et.catchup.get(o);k&&(k.posts.sort((N,z)=>N.createdAt>z.createdAt?1:-1),u(k.posts),l("results"))})():c==="results"&&(u([]),l("start"))},[o]);const[b,I]=ht(k=>k+1,0),[v,T]=A(null),[$,M]=A([]);W(()=>{(async()=>{try{const k=await et.catchup.keys();if(k.length){const N=Ht(),z=k.filter(O=>O.startsWith(`${N}-`));if(z.length){let O=await et.catchup.getMany(z);O.sort((me,fe)=>fe.endAt-me.endAt);let j=O.slice(0,3),be=O.slice(3);const ue=j.map(me=>{const{id:fe,count:Ae,startAt:Ve,endAt:Re}=me;return{id:fe,count:Ae,startAt:Ve,endAt:Re}});M(ue),T(j[0].endAt),O=null,j=null,queueMicrotask(()=>{be.length&&et.catchup.delMany(be.map(me=>me.id)).then(()=>{be=null}).catch(me=>{})});return}}}catch{}M([])})()},[b]),W(()=>{c==="start"&&I()},[c==="start"]);const[V,U]=ge(()=>{var fe,Ae,Ve,Re,He;let k=0,N=0,z=0,O=0,j=0,be=0;const ue={};for(const ye of p){ye._filtered?(k++,ye.__FILTER="filtered"):ye.group?(N++,ye.__FILTER="group"):ye.reblog?(z++,ye.__FILTER="boost"):(fe=ye._followedTags)!=null&&fe.length?(j++,ye.__FILTER="followedTags"):ye.inReplyToId&&ye.inReplyToAccountId!==((Ae=ye.account)==null?void 0:Ae.id)?(O++,ye.__FILTER="reply"):(be++,ye.__FILTER="original");const Z=ye.reblog||ye;if(ye.__FILTER!=="filtered"&&((Ve=Z.card)!=null&&Ve.url)&&((Re=Z.card)!=null&&Re.image)&&((He=Z.card)==null?void 0:He.type)==="link"){const{card:Le,favouritesCount:gt,reblogsCount:dt}=Z;let{url:je}=Le;if(je=je.replace(/\/$/,""),!ue[je])ue[je]={postID:Z.id,card:Le,shared:1,sharers:[ye.account],likes:gt,boosts:dt};else{if(ue[je].sharers.find(bt=>bt.id===ye.account.id))continue;ue[je].shared++,ue[je].sharers.push(ye.account),ue[je].postID!==Z.id&&(ue[je].likes+=gt,ue[je].boosts+=dt)}}}let me=[];for(const ye in ue)me.push({url:ye,...ue[ye]});if(me.sort((ye,Z)=>ye.shared>Z.shared?-1:ye.shared<Z.shared?1:ye.boosts>Z.boosts?-1:ye.boosts<Z.boosts?1:ye.likes>Z.likes?-1:ye.likes<Z.likes?1:0),me.length>10)e:for(let ye=10;ye<me.length;ye++){const{shared:Z}=me[ye];if(Z<=1){me=me.slice(0,ye);break e}}return[{Filtered:k,Groups:N,Boosts:z,Replies:O,"Followed tags":j,Original:be},me]},[p]),[F,ee]=A("All"),[E,D]=A(null),[x,q]=A(1),[P,oe]=A("createdAt"),[Ce,Ie]=A("asc"),[H,we]=A(null),[re,pe,ve]=ge(()=>{const k={},N=new Map;let z=p.filter(j=>{const be=F==="All"||j.__FILTER===jn[F];return be&&(k[j.account.id]=j.account,N.set(j.account.id,(N.get(j.account.id)||0)+1)),be});const O={};return z.forEach(j=>{j.reblog&&(O[j.reblog.id]?(O[j.reblog.id].__BOOSTERS?O[j.reblog.id].__BOOSTERS.add(j.account):O[j.reblog.id].__BOOSTERS=new Set([j.account]),j.__HIDDEN=!0):O[j.reblog.id]=j)}),E&&N.has(E)&&(z=z.filter(j=>j.account.id===E||[...j.__BOOSTERS||[]].find(be=>be.id===E))),[z,k,Object.fromEntries(N)]},[F,E,p]),De=ge(()=>{const k={};return re.forEach(N=>{k[N.id]=N}),k},[re]),Se=ge(()=>Object.keys(ve).sort((k,N)=>ve[N]-ve[k]),[ve]),Ue=ge(()=>{const k={};return Se.forEach((N,z)=>{k[N]=z}),re.filter(N=>!N.__HIDDEN).sort((N,z)=>{if(H==="account"){const O=N.account.id,j=z.account.id,be=k[O],ue=k[j],me=be-ue;if(me!==0)return me}if(P!=="createdAt"&&(N=N.reblog||N,z=z.reblog||z,P!=="density"&&N[P]===z[P]))return N.createdAt>z.createdAt?1:-1;if(P==="density"){const O=Yn(N),j=Yn(z);return Ce==="asc"?O>j?1:-1:j>O?1:-1}return Ce==="asc"?N[P]>z[P]?1:-1:z[P]>N[P]?1:-1})},[re,P,Ce,H,Se]),Ne=B(null),Te=B(null),X=B(!1);W(()=>{p.length>100||X.current||Te.current&&(ii(Te.current,{duration:200}),X.current=!0)},[p,Te]);const le=p.length>160?"3d":"2d",te=ge(()=>le!=="2d"?null:p.map(k=>{const N=De[k.id];return e("span",{class:`post-dot ${N?"post-dot-highlight":""}`},k.id)}),[De]),xe=ge(()=>le!=="3d"||!(p!=null&&p.length)?null:mc(p,"createdAt",320).map((N,z)=>e("div",{class:"posts-bin",children:N.map(O=>{const j=De[O.id];return e("span",{class:`post-dot ${j?"post-dot-highlight":""}`},O.id)})},z)),[De]),de=B(null),ne=ge(()=>v?(Date.now()-v)/1e3/60/60:null,[v,x]);W(()=>{if(c!=="results")return;const k=E&&pe[E]?pe[E].username:"",N=Ce==="asc"?0:1,z={account:"authors"};let O=ie({duration:5e3,text:`Showing ${oc[F]||"all posts"}${k?` by @${k}`:""}, ${cc[P][N]} first${H?`, grouped by ${H==="account"?z[H]:""}`:""}`});return()=>{var j;(j=O==null?void 0:O.hideToast)==null||j.call(O)}},[c,F,E,P,Ce,H,pe]),W(()=>{var k;if(E&&pe[E]){const N=Te.current.querySelector(`[data-author="${E}"]`),z=(k=Te.current)==null?void 0:k.getBoundingClientRect(),O=N==null?void 0:N.getBoundingClientRect();O.left<z.left||O.right>z.right?N.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}):O.top<0&&N.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}},[E,pe]);const[G,L]=A(!1),J=".catchup-list > li > a",se=Me("j",()=>{const k=document.activeElement.closest(J),N=k==null?void 0:k.getBoundingClientRect(),z=Array.from(de.current.querySelectorAll(J));if(k&&N.top<de.current.clientHeight&&N.bottom>0){const O=z.indexOf(k),j=z[O+1];j&&(j.focus(),j.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const O=z.find(j=>j.getBoundingClientRect().top>=0);O&&(O.focus(),O.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),_=Me("k",()=>{const k=document.activeElement.closest(J),N=k==null?void 0:k.getBoundingClientRect(),z=Array.from(de.current.querySelectorAll(J));if(k&&N.top<de.current.clientHeight&&N.bottom>0){const O=z.indexOf(k);let j=z[O-1];j&&(j.focus(),j.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const O=z.find(j=>{const be=j.getBoundingClientRect();return be.top>=44&&be.left>=0});O&&(O.focus(),O.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),Y=Me("h, l",(k,N)=>{var O,j,be;const z=N.keys[0];if(E){const ue=Se.indexOf(E);z==="h"?ue>0&&ue<Se.length&&(D(Se[ue-1]),(O=de.current)==null||O.focus()):z==="l"&&ue<Se.length-1&&ue>=0&&(D(Se[ue+1]),(j=de.current)==null||j.focus())}else z==="l"&&(D(Se[0]),(be=de.current)==null||be.focus())},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]}),Q=Me("esc",()=>{var k;D(null),(k=de.current)==null||k.focus()},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]}),ke=Me(".",()=>{var k;(k=de.current)==null||k.scrollTo({top:0,behavior:"smooth"})},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]});return e("div",{ref:k=>{de.current=k,se.current=k,_.current=k,Y.current=k,Q.current=k},id:"catchup-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck wide",children:[e("header",{class:`${c==="loading"?"loading":""}`,onClick:k=>{var N;k.target.closest("a, button")||(N=de.current)==null||N.scrollTo({top:0,behavior:"smooth"})},children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),c==="results"&&e(ae,{to:"/catchup",class:"button plain",children:e(w,{icon:"history2",size:"l"})}),c==="start"&&e(ae,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:c!=="start"&&e(R,{children:["Catch-up ",e("sup",{children:"beta"})]})}),e("div",{class:"header-side",children:c!=="start"&&c!=="loading"&&e("button",{type:"button",class:"plain",onClick:()=>{L(!0)},children:"Help"})})]})}),e("main",{children:[c==="start"&&e("div",{class:"catchup-start",children:[e("h1",{children:["Catch-up ",e("sup",{children:"beta"})]}),e("details",{children:[e("summary",{children:"What is this?"}),e("p",{children:"Catch-up is a separate timeline for your followings, offering a high-level view at a glance, with a simple, email-inspired interface to effortlessly sort and filter through posts."}),e("img",{src:ec,width:"1200",height:"900",alt:"Preview of Catch-up UI"}),e("p",{children:e("button",{type:"button",onClick:k=>{k.target.closest("details").open=!1},children:"Let's catch up"})})]}),e("p",{children:"Let's catch up on the posts from your followings."}),e("p",{children:e("b",{children:"Show me all posts from…"})}),e("div",{class:"catchup-form",children:[e("input",{ref:g,type:"range",value:x,min:Ye[0].value,max:Ye[Ye.length-1].value,step:"1",list:"catchup-ranges",onChange:k=>q(+k.target.value)})," ",e("span",{style:{width:"8em"},children:[Ye[x-1].label,e("br",{}),e("small",{class:"insignificant",children:x==Ye[Ye.length-1].value?"until the max":st(new Date(Date.now()-x*60*60*1e3))})]}),e("datalist",{id:"catchup-ranges",children:Ye.map(({label:k,value:N})=>e("option",{value:N,label:k}))})," ",e("button",{type:"button",onClick:()=>{var k;if(x<Ye[Ye.length-1].value){let N;x===Ye[Ye.length-1].value&&((k=y.current)!=null&&k.checked)?N=Date.now()-v:N=x*60*60*1e3,m({duration:N})}else m()},children:"Catch up"})]}),ne&&x>ne?e("p",{class:"catchup-info",children:[e(w,{icon:"info"})," Overlaps with your last catch-up"]}):x===Ye[Ye.length-1].value&&v?e("p",{class:"catchup-info",children:e("label",{children:[e("input",{type:"checkbox",switch:!0,checked:!0,ref:y})," ","Until the last catch-up (",Dt.format(new Date(v)),")"]})}):null,e("p",{class:"insignificant",children:e("small",{children:"Note: your instance might only show a maximum of 800 posts in the Home timeline regardless of the time range. Could be less or more."})}),!!($!=null&&$.length)&&e("div",{class:"catchup-prev",children:[e("p",{children:"Previously…"}),e("ul",{children:$.map(k=>e("li",{children:[e(ae,{to:`/catchup?id=${k.id}`,children:[e(w,{icon:"history2"})," ",e("span",{children:k.startAt?Dt.formatRange(new Date(k.startAt),new Date(k.endAt)):`… – ${Dt.format(new Date(k.endAt))}`})]})," ",e("span",{children:[e("small",{class:"ib insignificant",children:[k.count," posts"]})," ",e("button",{type:"button",class:"light danger small",onClick:async()=>{var z;if(confirm("Remove this catch-up?")){let O=ie(`Removing Catch-up ${k.id}`);await et.catchup.del(k.id),(z=O==null?void 0:O.hideToast)==null||z.call(O),ie(`Catch-up ${k.id} removed`),I()}},children:e(w,{icon:"x"})})]})]},k.id))}),$.length>=3&&e("p",{children:e("small",{children:"Note: Only max 3 will be stored. The rest will be automatically removed."})})]})]}),c==="loading"&&e("div",{class:"ui-state catchup-start",children:[e($e,{abrupt:!0}),e("p",{class:"insignificant",children:"Fetching posts…"}),e("p",{class:"insignificant",children:"This might take a while."})]}),c==="results"&&e(R,{children:[e("div",{class:"catchup-header",children:[p.length>0&&e("p",{children:e("b",{class:"ib",children:Dt.formatRange(new Date(p[0].createdAt),new Date(p[p.length-1].createdAt))})}),e("aside",{children:[e("button",{hidden:F==="All"&&!E&&P==="createdAt"&&Ce==="asc",type:"button",class:"plain4 small",onClick:()=>{ee("All"),D(null),oe("createdAt"),we(null),Ie("asc")},children:"Reset filters"}),(U==null?void 0:U.length)>0&&e("button",{type:"button",class:"plain small",onClick:()=>r(!d),children:["Top links"," ",e(w,{icon:"chevron-down",style:{transform:d?"rotate(180deg)":"rotate(0deg)"}})]})]})]}),e("div",{class:"shazam-container no-animation",hidden:!d,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"catchup-top-links links-bar",children:U.map(k=>{const{card:N,shared:z,sharers:O,likes:j,boosts:be}=k,{blurhash:ue,title:me,description:fe,url:Ae,image:Ve,imageDescription:Re,language:He,width:ye,height:Z,publishedAt:Le}=N,gt=Ct.toUnicode(new URL(Ae).hostname.replace(/^www\./,"").replace(/\/$/,""));let dt;if(ue){const je=dn(ue),bt=yn(je);dt=wn([.6,bt[1],bt[2]])}return e("a",{href:Ae,target:"_blank",rel:"noopener noreferrer",style:dt?{"--accent-color":`rgb(${dt.join(",")})`,"--accent-alpha-color":`rgba(${dt.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:Ve,alt:Re,width:ye,height:Z,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:gt})," ",!!Le&&e(R,{children:"· "}),!!Le&&e(R,{children:e(ft,{datetime:Le,format:"micro"})})]}),!!me&&e("h1",{class:"title",lang:He,dir:"auto",title:me,children:me})]}),!!fe&&e("p",{class:"description",lang:He,dir:"auto",title:fe,children:fe}),e("hr",{}),e("p",{style:{whiteSpace:"nowrap"},children:["Shared by"," ",O.map(je=>{const{avatarStatic:bt,displayName:qs}=je;return e(tt,{url:bt,size:"s",alt:qs})})]})]})]})},Ae)})})})}),p.length>=5&&(le==="3d"?e("div",{class:"catchup-posts-viz-time-bar",children:xe}):e("div",{class:"catchup-posts-viz-bar",children:te})),p.length>=2&&e("div",{class:"catchup-filters",children:[e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:F.toLowerCase()==="all",onChange:()=>{ee("All")}}),"All ",e("span",{class:"count",children:p.length})]}),nc.map(k=>!!V[k]&&e("label",{class:"filter-cat",title:(V[k]/p.length*100).toFixed(2)+"%",children:[e("input",{type:"radio",name:"filter-cat",checked:F.toLowerCase()===k.toLowerCase(),onChange:()=>{ee(k)}}),k," ",e("span",{class:"count",children:V[k]})]},k))]}),p.length>=2&&!!ve&&e("div",{class:"catchup-filters authors-filters",ref:Te,children:[Se.map(k=>e("label",{class:"filter-author","data-author":k,children:[e("input",{type:"radio",name:"filter-author",checked:E===k,onChange:()=>{D(k)},onClick:()=>{E===k&&D(null)}}),e(tt,{url:pe[k].avatarStatic||pe[k].avatar,size:"xxl",alt:`${pe[k].displayName} (@${pe[k].acct})`})," ",e("span",{class:"count",children:ve[k]}),e("span",{class:"username",children:pe[k].username})]},`${k}-${ve[k]}`)),Se.length>5&&e("small",{style:{whiteSpace:"nowrap",paddingInline:"1em",opacity:.33},children:[Se.length," authors"]},"authors-count")]}),p.length>=2&&e("div",{class:"catchup-filters",children:[e("span",{class:"filter-label",children:"Sort"})," ",e("fieldset",{class:"radio-field-group",children:sc.map(k=>e("label",{class:"filter-sort",onClick:N=>{P===k&&(N.preventDefault(),N.stopPropagation(),Ie(Ce==="asc"?"desc":"asc"))},children:[e("input",{type:"radio",name:"filter-sort-cat",checked:P===k,onChange:()=>{oe(k);const N=/(replies|favourites|reblogs)/.test(k)?"desc":"asc";Ie(N)}}),{createdAt:"Date",repliesCount:"Replies",favouritesCount:"Likes",reblogsCount:"Boosts",density:"Density"}[k],P===k&&(Ce==="asc"?" ↑":" ↓")]},k))}),e("span",{class:"filter-label",children:"Group"})," ",e("fieldset",{class:"radio-field-group",children:ic.map(k=>e("label",{class:"filter-group",children:[e("input",{type:"radio",name:"filter-group",checked:H===k,onChange:()=>{we(k)},disabled:k==="account"&&E}),{account:"Authors"}[k]||"None"]},k||"none"))}),E&&Se.length>1?e("button",{type:"button",class:"plain6 small",onClick:()=>{D(null)},style:{whiteSpace:"nowrap"},children:"Show all authors"}):null]}),e("ul",{class:`catchup-list catchup-filter-${jn[F]||""} ${P?`catchup-sort-${P}`:""} ${E&&pe[E]?"catchup-selected-author":""} ${H?`catchup-group-${H}`:""}`,children:Ue.map((k,N)=>{var j;const z=((j=k.reblog)==null?void 0:j.id)||k.id;let O=!1;return H==="account"&&(Ne.current&&k.account.id!==Ne.current&&N>0&&(O=!0),Ne.current=k.account.id),e(R,{children:[O&&e("li",{class:"separator"}),e(lc,{to:`/${n}/s/${z}`,post:k,root:de.current})]},`${k.id}-${O}`)})}),e("footer",{children:re.length>5&&e("p",{children:[F==="Boosts"?"You don't have to read everything.":"That's all."," ",e("button",{type:"button",class:"textual",onClick:()=>{de.current.scrollTop=0},children:"Back to top"}),"."]})})]})]})]}),G&&e(_e,{onClose:()=>L(!1),children:e("div",{class:"sheet",id:"catchup-help-sheet",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>L(!1),children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Help"})}),e("main",{children:e("dl",{children:[e("dt",{children:"Top links"}),e("dd",{children:"Links shared by followings, sorted by shared counts, boosts and likes."}),e("dt",{children:"Sort: Density"}),e("dd",{children:'Posts are sorted by information density or depth. Shorter posts are "lighter" while longer posts are "heavier". Posts with photos are "heavier" than posts without photos.'}),e("dt",{children:"Group: Authors"}),e("dd",{children:"Posts are grouped by authors, sorted by posts count per author."}),e("dt",{children:"Keyboard shortcuts"}),e("dd",{children:[e("kbd",{children:"j"}),": Next post"]}),e("dd",{children:[e("kbd",{children:"k"}),": Previous post"]}),e("dd",{children:[e("kbd",{children:"l"}),": Next author"]}),e("dd",{children:[e("kbd",{children:"h"}),": Previous author"]}),e("dd",{children:[e("kbd",{children:"Enter"}),": Open post details"]}),e("dd",{children:[e("kbd",{children:"."}),": Scroll to top"]})]})})]})})]})}const rc=Ze(function({post:t}){const{id:n,account:i,group:s,reblog:o,inReplyToId:c,inReplyToAccountId:l,_followedTags:d,_filtered:r,visibility:h,__BOOSTERS:f}=t,a=c&&l!==i.id,p=!!r,u=g=>{g.shiftKey};return e("article",{class:`post-line ${s?"group":o?"reblog":d!=null&&d.length?"followed-tags":""} ${a?"reply-to":""} ${p?"filtered":""} visibility-${h}`,onMouseEnter:u,children:[e("span",{class:"post-author",children:o?e("span",{class:"post-reblog-avatar",children:[e(tt,{url:i.avatarStatic||i.avatar,squircle:i.bot}),(f==null?void 0:f.size)>0?[...f].map(g=>e(tt,{url:g.avatarStatic||g.avatar,squircle:g.bot})):""," ",e(w,{icon:"rocket"})," ",e(kt,{account:o.account,showAvatar:!0})]}):e(kt,{account:i,showAvatar:!0})}),e(hc,{post:o||t,filterInfo:r}),e("span",{class:"post-meta",children:[e(pc,{post:o||t})," ",e(ft,{datetime:new Date((o==null?void 0:o.createdAt)||t.createdAt),format:"micro"})]})]})},(t,n)=>{var i,s;return((i=t==null?void 0:t.post)==null?void 0:i.id)===((s=n==null?void 0:n.post)==null?void 0:s.id)}),lc=({root:t,to:n,...i})=>{const s=B(),[o,c]=A(!1);return W(()=>{const l=new IntersectionObserver(d=>{d[0].isIntersecting&&(queueMicrotask(()=>c(!0)),l.unobserve(s.current))},{root:t,rootMargin:`${Math.max(320,screen.height*.75)}px`});return s.current&&l.observe(s.current),()=>{s.current&&l.unobserve(s.current)}},[]),o?e("li",{children:e(ae,{to:n,children:e(rc,{...i})})}):e("li",{ref:s,style:{height:"4em"}})},dc=8,uc=8;function Yn(t){var r;const{spoilerText:n,content:i,poll:s,mediaAttachments:o,card:c}=t,l=(r=s==null?void 0:s.options)!=null&&r.length?s.options.reduce((h,f)=>h+f.title,""):"";return(n.length+ws(i)+l.length)/140+(o!=null&&o.length?dc*o.length:c!=null&&c.image?uc:0)}const rt=48;function hc({post:t,filterInfo:n}){var S;const{spoilerText:i,sensitive:s,content:o,emojis:c,poll:l,mediaAttachments:d,card:r,inReplyToId:h,inReplyToAccountId:f,account:a,_thread:p}=t,u=h&&f===a.id||!!p,g=!i&&!s,y=o?pn(t):"";return e("div",{class:"post-peek",title:i?"":y,children:[e("span",{class:"post-peek-content",children:n?e(R,{children:[u&&e(R,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-filtered",children:["Filtered",n!=null&&n.titlesStr?`: ${n.titlesStr}`:""]})]}):i?e(R,{children:[u&&e(R,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-spoiler",children:[e(w,{icon:"eye-close"})," ",i]})]}):e("div",{class:"post-peek-html",children:[u&&e(R,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),!!o&&e("div",{dangerouslySetInnerHTML:{__html:yi(o,c)}}),!!((S=l==null?void 0:l.options)!=null&&S.length)&&l.options.map(m=>e("div",{children:[l.multiple?"▪️":"•"," ",m.title]})),!o&&(d==null?void 0:d.length)===1&&d[0].description&&e(R,{children:[e("span",{class:"post-peek-tag post-peek-alt",children:"ALT"})," ",e("div",{children:d[0].description})]})]})}),!n&&e("span",{class:"post-peek-post-content",children:[!!l&&e("span",{class:"post-peek-tag post-peek-poll",children:[e(w,{icon:"poll",size:"s"}),"Poll"]}),d!=null&&d.length?d.map(m=>{const b=m.previewUrl||m.url,I=m.previewRemoteUrl||m.remoteUrl;return e("span",{class:"post-peek-media",children:{image:(b||I)&&g?e("img",{src:b,width:rt,height:rt,alt:m.description,loading:"lazy",onError:v=>{const{src:T}=v.target;T===b&&(v.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"🖼"}),gifv:(b||I)&&g?e("img",{src:b,width:rt,height:rt,alt:m.description,loading:"lazy",onError:v=>{const{src:T}=v.target;T===b&&(v.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"🎞️"}),video:(b||I)&&g?e("img",{src:b,width:rt,height:rt,alt:m.description,loading:"lazy",onError:v=>{const{src:T}=v.target;T===b&&(v.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"📹"}),audio:e("span",{class:"post-peek-faux-media",children:"🎵"})}[m.type]||null},m.id)}):!!r&&r.image&&g&&e("span",{class:`post-peek-media post-peek-card card-${r.type||""}`,children:r.image?e("img",{src:r.image,width:rt,height:rt,alt:r.title||r.description||r.imageDescription,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"🔗"})})]})]})}function pc({post:t}){const{reblogsCount:n,repliesCount:i,favouritesCount:s}=t;return e("span",{class:"post-stats",children:[i>0&&e("span",{class:"post-stat-replies",children:[e(w,{icon:"comment2",size:"s"})," ",Ge(i)]}),s>0&&e("span",{class:"post-stat-likes",children:[e(w,{icon:"heart",size:"s"})," ",Ge(s)]}),n>0&&e("span",{class:"post-stat-boosts",children:[e(w,{icon:"rocket",size:"s"})," ",Ge(n)]})]})}const{locale:fc}=new Intl.DateTimeFormat().resolvedOptions(),Dt=new Intl.DateTimeFormat(fc,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"});function mc(t,n,i){const s=t.map(r=>new Date(r[n])),o=s.reduce((r,h)=>h<r?h:r,s[0]),l=s.reduce((r,h)=>h>r?h:r,s[0]).getTime()-o.getTime(),d=Array.from({length:i},()=>[]);return t.forEach(r=>{const f=(new Date(r[n]).getTime()-o.getTime())/l,a=Math.floor(f*(i-1));d[a].push(r)}),d}const gc=20;function _s(){qe("Likes","/f");const{masto:t,instance:n}=K(),i=B();async function s(o){return(o||!i.current)&&(i.current=t.v1.favourites.list({limit:gc})),await i.current.next()}return e(at,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:s})}const bc=["home","public","notifications","thread","account"],Wn=["notifications","thread","account"],yc={home:"Home and lists",notifications:"Notifications",public:"Public timelines",thread:"Conversations",account:"Profiles"},wc=[0,30*60,60*60,6*60*60,12*60*60,60*60*24,60*60*24*7,60*60*24*30],vc={0:"Never",1800:"30 minutes",3600:"1 hour",21600:"6 hours",43200:"12 hours",86400:"24 hours",604800:"7 days",2592e3:"30 days"};function kc(){const{masto:t}=K();qe("Filters","/ft");const[n,i]=A("default"),[s,o]=A(!1),[c,l]=ht(h=>h+1,0),[d,r]=A([]);return W(()=>{i("loading"),(async()=>{try{const h=await t.v2.filters.list();h.sort((f,a)=>f.title.localeCompare(a.title)),h.forEach(f=>{var a;(a=f.keywords)!=null&&a.length&&f.keywords.sort((p,u)=>p.id-u.id)}),r(h),i("default")}catch{i("error")}})()},[c]),e("div",{id:"filters-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),e(ae,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Filters"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{o(!0)},children:e(w,{icon:"plus",size:"l",alt:"New filter"})})})]})}),e("main",{children:d.length>0?e(R,{children:[e("ul",{class:"filters-list",children:d.map(h=>{const{id:f,title:a,expiresAt:p,keywords:u}=h;return e("li",{children:[e("div",{children:[e("h2",{children:a}),(u==null?void 0:u.length)>0&&e("div",{children:u.map(g=>e(R,{children:[e("span",{class:"tag collapsed insignificant",children:g.wholeWord?`“${g.keyword}”`:g.keyword})," "]}))}),e("small",{class:"insignificant",children:e(Es,{expiresAt:p})})]}),e("button",{type:"button",class:"plain",onClick:()=>{o({filter:h})},children:e(w,{icon:"pencil",size:"l",alt:"Edit filter"})})]},f)})}),d.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[d.length," filter",d.length===1?"":"s"]})})]}):n==="loading"?e("p",{class:"ui-state",children:e($e,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load filters."}):e("p",{class:"ui-state",children:"No filters yet."})})]}),!!s&&e(_e,{title:"Add filter",onClose:()=>{o(!1)},children:e(Cc,{filter:s==null?void 0:s.filter,onClose:h=>{h.state==="success"&&l(),o(!1)}})})]})}let Sc=1;const Ic=()=>Sc++;function Cc({filter:t,onClose:n}){const{masto:i}=K(),[s,o]=A("default"),c=!!t,{context:l,expiresAt:d,id:r,keywords:h,title:f,filterAction:a}=t||{},u=!!d&&new Date(d),[g,y]=A(h||[]),S=B(),[m,b]=A([]),[I,v]=A([]),T=g.filter($=>!m.includes($.id)&&!I.includes($._id));return e("div",{class:"sheet",id:"filters-add-edit-modal",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:c?"Edit filter":"New filter"})}),e("main",{children:e("form",{onSubmit:$=>{$.preventDefault();const M=new FormData($.target),V=M.get("title"),U=M.getAll("keyword_attributes[][id]"),F=M.getAll("keyword_attributes[][keyword]"),ee=[...S.current.querySelectorAll('input[name="keyword_attributes[][whole_word]"]')].map(P=>P.checked),E=F.map((P,oe)=>({id:U[oe]||void 0,keyword:P,wholeWord:ee[oe]}));c&&(m!=null&&m.length)&&m.forEach(P=>{E.push({id:P,_destroy:!0})});const D=M.getAll("context");let x=M.get("expires_in");const q=M.get("filter_action");!V||!(D!=null&&D.length)||(o("loading"),(async()=>{try{let P;c?(x===""||x===null?x=Math.floor((u-new Date)/1e3):x==="0"||x===0?x=null:x=+x,P=await i.v2.filters.$select(r).update({title:V,context:D,expiresIn:x,keywordsAttributes:E,filterAction:q})):(x=+x||null,P=await i.v2.filters.create({title:V,context:D,expiresIn:x,keywordsAttributes:E,filterAction:q})),o("default"),n==null||n({state:"success",filter:P})}catch{o("error"),alert(c?"Unable to edit filter":"Unable to create filter")}})())},children:[e("div",{class:"filter-form-row",children:e("label",{children:[e("b",{children:"Title"}),e("input",{type:"text",name:"title",defaultValue:f,disabled:s==="loading",dir:"auto",required:!0})]})}),e("div",{class:"filter-form-keywords",ref:S,children:[T.length?e("ul",{class:"filter-keywords",children:T.map($=>{const{id:M,keyword:V,wholeWord:U,_id:F}=$;return e("li",{children:[e("input",{type:"hidden",name:"keyword_attributes[][id]",value:M}),e("input",{name:"keyword_attributes[][keyword]",type:"text",defaultValue:V,disabled:s==="loading",required:!0}),e("div",{class:"filter-keyword-actions",children:[e("label",{children:[e("input",{name:"keyword_attributes[][whole_word]",type:"checkbox",value:M,defaultChecked:U,disabled:s==="loading"})," ","Whole word"]}),e("button",{type:"button",class:"light danger small",disabled:s==="loading",onClick:()=>{M?(m.push(M),b([...m])):F&&(I.push(F),v([...I]))},children:e(w,{icon:"x"})})]})]},`${M}-${F}`)})}):e("div",{class:"filter-keywords",children:e("div",{class:"insignificant",children:"No keywords. Add one."})}),e("footer",{class:"filter-keywords-footer",children:[e("button",{type:"button",class:"light",onClick:()=>{y([...g,{_id:Ic(),keyword:"",wholeWord:!0}]),setTimeout(()=>{var M,V;const $=S.current.querySelectorAll('input[type="text"]');(V=(M=$[$.length-1])==null?void 0:M.focus)==null||V.call(M)},10)},children:"Add keyword"})," ",(T==null?void 0:T.length)>1&&e("small",{class:"insignificant",children:[T.length," keyword",T.length===1?"":"s"]})]})]}),e("div",{class:"filter-form-cols",children:[e("div",{class:"filter-form-col",children:[e("div",{children:e("b",{children:"Filter from…"})}),bc.map($=>e("div",{children:[e("label",{class:Wn.includes($)?"insignificant":"",children:[e("input",{type:"checkbox",name:"context",value:$,defaultChecked:l?l.includes($):!0,disabled:s==="loading"})," ",yc[$],Wn.includes($)?"*":""]})," "]})),e("p",{children:e("small",{class:"insignificant",children:"* Not implemented yet"})})]}),e("div",{class:"filter-form-col",children:[c&&e(R,{children:["Status:"," ",e("b",{children:e(Es,{expiresAt:d,showNeverExpires:!0})})]}),e("div",{children:[e("label",{for:"filters-expires_in",children:c?"Change expiry":"Expiry"}),e("select",{id:"filters-expires_in",name:"expires_in",disabled:s==="loading",defaultValue:c?void 0:0,children:[c&&e("option",{}),wc.map($=>e("option",{value:$,children:vc[$]}))]})]}),e("p",{children:["Filtered post will be…",e("br",{}),e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"warn",defaultChecked:a==="warn"||!c,disabled:s==="loading"})," ","minimized"]})," ",e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"hide",defaultChecked:a==="hide",disabled:s==="loading"})," ","hidden"]})]})]})]}),e("footer",{class:"filter-form-footer",children:[e("span",{children:[e("button",{type:"submit",disabled:s==="loading",children:c?"Save":"Create"})," ",e($e,{abrupt:!0,hidden:s!=="loading"})]}),c&&e(Qe,{disabled:s==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this filter?",onClick:()=>{o("loading"),(async()=>{try{await i.v2.filters.$select(r).remove(),o("default"),n==null||n({state:"success"})}catch{o("error"),alert("Unable to delete filter.")}})()},children:e("button",{type:"button",class:"light danger",onClick:()=>{},disabled:s==="loading",children:"Delete…"})})]})]})})]})}function Es({expiresAt:t,showNeverExpires:n}){const i=!!t,s=i&&new Date(t),o=i&&s<=new Date,[c,l]=ht(d=>d+1,0);return hn(l,o||3e4),o?"Expired":i?e(R,{children:["Expiring ",e(ft,{datetime:s})]}):n&&"Never expires"}function Tc(){const{masto:t,instance:n}=K();qe("Followed Hashtags","/fh");const[i,s]=A("default"),[o,c]=A([]);return W(()=>{s("loading"),(async()=>{try{const l=await jt();c(l),s("default")}catch{s("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),e(ae,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:o.length>0?e(R,{children:[e("ul",{class:"link-list",children:o.map(l=>e("li",{children:e(ae,{to:n?`/${n}/t/${l.name}`:`/t/${l.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:l.name})]})}))}),o.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[o.length," hashtag",o.length===1?"":"s"]})})]}):i==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):i==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const xc=20;function kn({title:t,path:n,id:i,...s}){qe(t||"Following",n||"/following");const{masto:o,streaming:c,instance:l}=K(),d=Pe(C),r=B(),h=B();async function f(p){(p||!r.current)&&(r.current=o.v1.timelines.home.list({limit:xc}));const u=await r.current.next();let{value:g}=u;if(g!=null&&g.length){let y=!1;p&&(g[0].id!==h.current&&(y=!0),h.current=g[0].id),g.forEach(S=>{Be(S,l)}),g=Hn(g,l),p&&y&&Oo(),Rs(g,l),g.sort((S,m)=>{const b=new Date(S.createdAt);return new Date(m.createdAt)-b})}return{...u,value:g}}async function a(){try{const p=await o.v1.timelines.home.list({limit:5,since_id:h.current}).next();let{value:u}=p;return!!(u!=null&&u.length&&(h.current=u[0].id,u=Hn(u,l),u=Tt(u,"home"),u.some(g=>!g.reblog)))}catch{return!1}}return W(()=>{let p;return(async()=>{if(c){p=c.user.subscribe();for await(const u of p){if(!p)break;if(u.event==="status.update"){const g=u.payload;Be(g,l)}else if(u.event==="delete"){const g=u.payload,y=cs(g,l);y&&(y._deleted=!0)}}}})(),()=>{var u;(u=p==null?void 0:p.unsubscribe)==null||u.call(p),p=null}},[c]),e(at,{title:t||"Following",id:i||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:l,fetchItems:f,checkForUpdates:a,useItemID:!0,boostsCarousel:d.settings.boostsCarousel,...s,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const $c=20,Ac=4,Kn=Ac+1;function Ms({media:t,columnMode:n,...i}){let{hashtag:s,...o}=n?{}:pt();i.hashtag&&(s=i.hashtag);let c=s.trim().split(/[\s+]+/);c.sort(),s=c[0];const[l,d]=nt(),r=t||!!l.get("media"),h=r?"?media=1":"",{masto:f,instance:a,authenticated:p}=K({instance:(i==null?void 0:i.instance)||o.instance}),{masto:u,instance:g,authenticated:y}=K(),S=c.map(E=>`#${E}`).join(" "),m=r?" (Media only)":"",b=a?`${S}${m} on ${a}`:`${S}${m}`;qe(b,"/:instance?/t/:hashtag");const I=B(),v=B(void 0);async function T(E){const D=await f.v1.timelines.tag.$select(s).list({limit:$c,any:c.slice(1),maxId:E?void 0:v.current,onlyMedia:r}).next();let{value:x}=D;return x!=null&&x.length&&(E&&(I.current=x[0].id),x.forEach(q=>{Be(q,a,{skipThreading:r})}),v.current=x[x.length-1].id),{...D,value:x}}async function $(){try{const E=await f.v1.timelines.tag.$select(s).list({limit:1,any:c.slice(1),since_id:I.current,onlyMedia:r}).next();let{value:D}=E;return D=Tt(D,"public"),!!(D!=null&&D.length)}catch{return!1}}const[M,V]=A("default"),[U,F]=A();W(()=>{(async()=>{try{const E=await f.v1.tags.$select(s).fetch();F(E)}catch{}})()},[s]);const ee=c.length>=Kn;return e(at,{title:b,titleComponent:!!a&&e("h1",{class:"header-double-lines",children:[e("b",{children:S}),e("div",{children:a})]}),id:"hashtag",instance:a,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:T,checkForUpdates:$,useItemID:!0,view:r?"media":void 0,refresh:r,filterContext:"public",headerEnd:e(Ke,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!U&&c.length===1&&e(R,{children:[e(Qe,{subMenu:!0,confirm:U.following,confirmLabel:`Unfollow #${s}?`,disabled:M==="loading"||!p,onClick:()=>{V("loading"),U.following?f.v1.tags.$select(s).unfollow().then(()=>{F({...U,following:!1}),ie(`Unfollowed #${s}`)}).catch(E=>{alert(E)}).finally(()=>{V("default")}):f.v1.tags.$select(s).follow().then(()=>{F({...U,following:!0}),ie(`Followed #${s}`)}).catch(E=>{alert(E)}).finally(()=>{V("default")})},children:U.following?e(R,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(R,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(Oe,{})]}),e(ds,{className:"plain",children:"Filters"}),e(he,{type:"checkbox",checked:!!r,onClick:()=>{r?l.delete("media"):l.set("media","1"),d(l)},children:[e(w,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(Oe,{}),e(oi,{className:"menu-field",disabled:ee,children:({ref:E})=>e("form",{onSubmit:D=>{var q,P;D.preventDefault();const x=(P=(q=D.target[0].value)==null?void 0:q.trim)==null?void 0:P.call(q);x&&!c.some(oe=>oe.toLowerCase()===x.toLowerCase())&&(c.push(x),c.sort(),location.hash=a?`/${a}/t/${c.join("+")}`:`/t/${c.join("+")}${h}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:E,type:"text",placeholder:ee?`Max ${Kn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:ee})]})}),e(ci,{takeOverflow:!0,children:c.map((E,D)=>e(he,{disabled:c.length===1,onClick:x=>{c.splice(D,1),c.sort(),location.hash=a?`/${a}/t/${c.join("+")}${h}`:`/t/${c.join("+")}${h}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),E]})]},E))}),e(Oe,{}),e(he,{disabled:!y,onClick:()=>{if(C.shortcuts.length>=it){alert(`Max ${it} shortcuts reached. Unable to add shortcut.`);return}const E={type:"hashtag",hashtag:c.join(" "),instance:a,media:r?"on":void 0};C.shortcuts.some(x=>x.type===E.type&&x.hashtag.split(/[\s+]+/).sort().join(" ")===E.hashtag.split(/[\s+]+/).sort().join(" ")&&(x.instance?x.instance===E.instance:!0)&&(x.media?!!x.media==!!E.media:!0))?alert("This shortcut already exists"):(C.shortcuts.push(E),ie("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(he,{onClick:()=>{let E=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(E)){E&&alert("Invalid instance");return}E&&(E=E.toLowerCase().trim(),location.hash=`/${E}/t/${c.join("+")}${h}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),g!==a&&e(he,{onClick:()=>{location.hash=`/${g}/t/${c.join("+")}${h}`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:g}),")"]})]})]})},a+S)}const Rc=20;function Ds(t){var m;const n=Pe(C),{masto:i,instance:s}=K(),o=(t==null?void 0:t.id)||((m=pt())==null?void 0:m.id),c=B(),l=B();async function d(b){(b||!l.current)&&(l.current=i.v1.timelines.list.$select(o).list({limit:Rc}));const I=await l.current.next();let{value:v}=I;return v!=null&&v.length&&(b&&(c.current=v[0].id),v.forEach(T=>{Be(T,s)})),{...I,value:v}}async function r(){try{const b=await i.v1.timelines.list.$select(o).list({limit:1,since_id:c.current});let{value:I}=b;return I=Tt(I,"home"),!!(I!=null&&I.length)}catch{return!1}}const[h,f]=A([]);W(()=>{_t().then(f)},[]);const[a,p]=A({title:"List"});qe(a.title,"/l/:id"),W(()=>{(async()=>{try{const b=await Is(o);p(b)}catch{}})()},[o]);const[u,g]=A(!1),[y,S]=A(!1);return e(R,{children:[e(at,{title:a.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:s,fetchItems:d,checkForUpdates:r,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:e(Ke,{overflow:"auto",menuButton:e("button",{type:"button",class:"plain",children:[e(w,{icon:"list",size:"l",alt:"Lists"}),e(w,{icon:"chevron-down",size:"s"})]}),children:[e(Ee,{to:"/l",children:e("span",{children:"All Lists"})}),(h==null?void 0:h.length)>0&&e(R,{children:[e(Oe,{}),h.map(b=>e(Ee,{to:`/l/${b.id}`,children:e("span",{children:b.title})},b.id))]})]}),headerEnd:e(Ke,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(he,{onClick:()=>g({list:a}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(he,{onClick:()=>S(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},o),u&&e(_e,{onClick:b=>{b.target===b.currentTarget&&g(!1)},children:e(gn,{list:u==null?void 0:u.list,onClose:b=>{b.state==="success"&&b.list?p(b.list):b.state==="deleted"&&(location.hash="/l"),g(!1)}})}),y&&e(_e,{onClick:b=>{b.target===b.currentTarget&&S(!1)},children:e(_c,{listID:o,onClose:()=>S(!1)})})]})}const Lc=40;function _c({listID:t,onClose:n}){const{masto:i,instance:s}=K(),[o,c]=A([]),[l,d]=A("default"),[r,h]=A(!1),f=B();async function a(p){h(!1),d("loading"),(async()=>{try{(p||!f.current)&&(f.current=i.v1.lists.$select(t).accounts.list({limit:Lc}));const u=await f.current.next();let{done:g,value:y}=u;y!=null&&y.length?(c(p?y:o.concat(y)),h(!g)):h(!1),d("default")}catch{d("error")}})()}return W(()=>{a(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[o.map(p=>e("li",{children:[e(Je,{account:p,instance:s}),e(Ec,{account:p,listID:t})]},p.id)),r&&l==="default"&&e(ot,{as:"li",onChange:p=>p&&a(),children:e("button",{type:"button",class:"light block",onClick:a,children:"Show more…"})})]})})]})}function Ec({account:t,listID:n}){const{masto:i}=K(),[s,o]=A("default"),[c,l]=A(!1);return e(Qe,{confirm:!c,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{c?(o("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),o("default"),l(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),o("default"),l(!0)}catch{o("error")}})())},children:e("button",{type:"button",class:`light ${c?"":"danger"}`,disabled:s==="loading",children:c?"Add":"Remove…"})})}const Zn=20,Mc=new URLSearchParams;function Ps({columnMode:t,...n}){const{masto:i,instance:s}=K(),[o]=t?[Mc]:nt(),[c,l]=A(null),d=(n==null?void 0:n.type)||o.get("type")||c;qe(`Mentions${d==="private"?" (Private)":""}`,"/mentions");const r=B(),h=B();async function f(m){(m||!r.current)&&(r.current=i.v1.notifications.list({limit:Zn,types:["mention"]}));const b=await r.current.next();let{value:I}=b;return I!=null&&I.length&&(m&&(h.current=I[0].id),I.forEach(({status:v})=>{Be(v,s)})),{...b,value:I==null?void 0:I.map(v=>v.status)}}const a=B(),p=B();async function u(m){(m||!a.current)&&(a.current=i.v1.conversations.list({limit:Zn}));const b=await a.current.next();let{value:I}=b;return I=I==null?void 0:I.filter(v=>v.lastStatus),I!=null&&I.length&&(m&&(p.current=I[0].lastStatus.id),I.forEach(({lastStatus:v})=>{Be(v,s)})),{...b,value:I==null?void 0:I.map(v=>v.lastStatus)}}function g(...m){return d==="private"?u(...m):f(...m)}async function y(){if(d==="private")try{const m=await i.v1.conversations.list({limit:1,since_id:p.current}).next();let{value:b}=m;return b!=null&&b.length?(p.current=b[0].lastStatus.id,!0):!1}catch{return!1}else try{const m=await i.v1.notifications.list({limit:1,types:["mention"],since_id:h.current}).next();let{value:b}=m;return b!=null&&b.length?(h.current=b[0].id,!0):!1}catch{return!1}}const S=ge(()=>e("div",{class:"filter-bar centered",children:[e(ae,{to:"/mentions",class:d?"":"is-active",onClick:m=>{t&&(m.preventDefault(),l(null))},children:"All"}),e(ae,{to:"/mentions?type=private",class:d==="private"?"is-active":"",onClick:m=>{t&&(m.preventDefault(),l("private"))},children:"Private"})]}),[d]);return e(at,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:s,fetchItems:g,checkForUpdates:y,useItemID:!0,timelineStart:S,refresh:d})}const Dc={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function Pc(t){return t.filter(n=>{const{type:i,id:s,createdAt:o}=n;if(!i)return!1;const c=Dc[i];return c!=null&&c.length?c.every(l=>!!n[l]):!0})}function Ns(t){t=Pc(t);const n={},i=[];for(let c=0,l=0;c<t.length;c++){const d=t[c],{id:r,status:h,account:f,type:a,createdAt:p}=d,u=p?new Date(p).toLocaleDateString():"";let g=a;(a==="favourite"||a==="reblog")&&(g="favourite+reblog");const y=`${h==null?void 0:h.id}-${g}-${u}`,S=n[y];if(g==="follow_request")i[l++]=d;else if(S!=null&&S.account){const m=S._accounts.find(b=>b.id===f.id);m?(m._types.push(a),m._types.sort().reverse(),S.id+=`-${r}`):(f._types=[a],S._accounts.push(f),S.id+=`-${r}`)}else{f&&(f._types=[a]);let m=n[y]={...d,type:g,_accounts:f?[f]:[]};i[l++]=m}}const s={},o=[];for(let c=0,l=0;c<i.length;c++){const d=i[c],{id:r,account:h,_accounts:f,type:a,createdAt:p}=d,u=p?new Date(p).toLocaleDateString():"";if(a==="favourite+reblog"&&h&&f.length===1){const g=`${h==null?void 0:h.id}-${a}-${u}`,y=s[g];if(y)y._statuses.push(d.status),y.id+=`-${r}`;else{let S=s[g]={...d,type:a,_statuses:[d.status]};o[l++]=S}}else o[l++]=d}return o}const Nc=30,Uc=new URLSearchParams,Pt={block:"center",inline:"center",behavior:"smooth"};function Fc({columnMode:t}){var G;qe("Notifications","/notifications");const{masto:n,instance:i}=K(),s=Pe(C),[o,c]=A("default"),[l]=t?[Uc]:nt(),d=l.get("id"),r=l.get("access_token"),[h,f]=A(!1),[a,p]=A(!1),u=B(),{nearReachEnd:g,scrollDirection:y,reachStart:S,nearReachStart:m}=zo({scrollableRef:u}),b=y==="end"&&!m,[I,v]=A([]),[T,$]=A([]),M=B();async function V(L){(L||!M.current)&&(M.current=n.v1.notifications.list({limit:Nc,excludeTypes:["follow_request"]}));const J=await M.current.next(),se=J.value;if(se!=null&&se.length){se.forEach(Y=>{Be(Y.status,i,{skipThreading:!0})});const _=Ns(se);L?(C.notificationsLast=se[0],C.notifications=_,n.v1.markers.create({notifications:{lastReadId:se[0].id}}).catch(()=>{})):C.notifications.push(..._)}return C.notificationsShowNew=!1,C.notificationsLastFetchTime=Date.now(),J}async function U(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const F=()=>{c("loading"),(async()=>{try{const L=await U();v(L),c("default")}catch{c("error")}})()};async function ee(){try{return await n.v1.announcements.list()}catch{return[]}}const E=ps("@mastodon/filtered-notifications"),[D,x]=A(!1),[q,P]=A({});function oe(){return n.v1.notifications.policy.fetch().catch(()=>{})}function Ce(){oe().then(L=>{P(L)}).catch(()=>{})}const[Ie,H]=A(null);function we(){return n.v1.notifications.requests.list()}const re=L=>{ve(!1),c("loading"),(async()=>{try{const J=V(L);L&&(ee().then(_=>{_.sort((Y,Q)=>{const ke=new Date(Y.updatedAt||Y.createdAt);return new Date(Q.updatedAt||Q.createdAt)-ke}),$(_)}).catch(()=>{}),U().then(_=>{v(_)}).catch(()=>{}),E&&Ce());const{done:se}=await J;f(!se),c("default")}catch{c("error")}})()};W(()=>{re(!0)},[]),W(()=>{S&&re(!0)},[S]);const[pe,ve]=A(!1),De=Xe(({disableIdleCheck:L=!1}={})=>{var J;o!=="loading"&&s.settings.autoRefresh&&((J=u.current)==null?void 0:J.scrollTop)<16&&(L||window.__IDLE__)&&!Oc()&&re(!0)},[s.notificationsShowNew,s.settings.autoRefresh,o]),Se=B();St(L=>{let J;if(L){const se=Date.now()-Se.current;!Se.current||se>1e3*3?De({disableIdleCheck:!0}):Se.current=Date.now(),J=ai(C,"notificationsShowNew",_=>{o!=="loading"&&(_&&De(),ve(_))})}return()=>{J==null||J()}});const Ue=new Date,Ne=new Date(Ue-24*60*60*1e3);let Te=new Date;const X=!s.notifications.some(L=>new Date(L.createdAt).toDateString()===Ue.toDateString()),le=B();W(()=>{d&&(C.routeNotification={id:d,accessToken:atob(r)})},[d,r]);const te=".notification",xe=Me("j",()=>{const L=document.activeElement.closest(te),J=L==null?void 0:L.getBoundingClientRect(),se=Array.from(u.current.querySelectorAll(te));if(L&&J.top<u.current.clientHeight&&J.bottom>0){const _=se.indexOf(L);let Y=se[_+1];Y&&(Y.focus(),Y.scrollIntoView(Pt))}else{const _=se.find(Y=>{const Q=Y.getBoundingClientRect();return Q.top>=44&&Q.left>=0});_&&(_.focus(),_.scrollIntoView(Pt))}}),de=Me("k",()=>{const L=document.activeElement.closest(te),J=L==null?void 0:L.getBoundingClientRect(),se=Array.from(u.current.querySelectorAll(te));if(L&&J.top<u.current.clientHeight&&J.bottom>0){const _=se.indexOf(L);let Y=se[_-1];Y&&(Y.focus(),Y.scrollIntoView(Pt))}else{const _=se.find(Y=>{const Q=Y.getBoundingClientRect();return Q.top>=44&&Q.left>=0});_&&(_.focus(),_.scrollIntoView(Pt))}}),ne=Me(["enter","o"],()=>{const L=document.activeElement.closest(te),J=L==null?void 0:L.querySelector(".status-link");J&&J.click()});return e("div",{id:"notifications-page",class:"deck-container",ref:L=>{u.current=L,xe.current=L,de.current=L,ne.current=L},tabIndex:"-1",children:[e("div",{class:`timeline-deck deck ${a?"only-mentions":""}`,children:[e("header",{hidden:b,onClick:L=>{var J;L.target.closest("a, button")||(J=u.current)==null||J.scrollTo({top:0,behavior:"smooth"})},onDblClick:L=>{L.target.closest("a, button")||re(!0)},class:o==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),e(ae,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side",children:E&&e("button",{type:"button",class:"button plain",onClick:()=>{x(!0)},children:e(w,{icon:"settings",size:"l",alt:"Notifications settings"})})})]}),pe&&o!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var L;re(!0),(L=u.current)==null||L.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),T.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",T.length>1?"s":""]})," ",e("small",{class:"insignificant",children:i})]}),T.length>1&&e("span",{class:"announcements-nav-buttons",children:T.map((L,J)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var se;(se=le.current)==null||se.children[J].scrollIntoView({behavior:"smooth",block:"nearest"})},children:J+1}))})]}),e("ul",{class:`announcements-list-${T.length>1?"multiple":"single"}`,ref:le,children:T.map(L=>e("li",{children:e(zc,{announcement:L})}))})]})})}),I.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),I.length>5?e("details",{children:[e("summary",{children:[I.length," follow requests"]}),e("ul",{children:I.map(L=>e("li",{children:[e(Je,{account:L}),e(on,{accountID:L.id,onChange:()=>{}})]},L.id))})]}):e("ul",{children:I.map(L=>e("li",{children:[e(Je,{account:L}),e(on,{accountID:L.id,onChange:()=>{}})]},L.id))})]}),E&&((G=q==null?void 0:q.summary)==null?void 0:G.pendingRequestsCount)>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("div",{class:"filtered-notifications",children:e("details",{onToggle:async L=>{const{open:J}=L.target;if(J){const se=await we();H(se)}},children:[e("summary",{children:["Filtered notifications from"," ",q.summary.pendingRequestsCount," people"]}),Ie?(Ie==null?void 0:Ie.length)>0&&e("ul",{children:Ie.map(L=>{var J,se;return e("li",{children:[e("div",{class:"request-notifcations",children:[!((J=L.lastStatus)!=null&&J.id)&&e(Je,{useAvatarStatic:!0,showStats:!0,account:L.account}),((se=L.lastStatus)==null?void 0:se.id)&&e("div",{class:"last-post",children:e(ae,{class:"status-link",to:`/${i}/s/${L.lastStatus.id}`,children:e(ze,{status:L.lastStatus,size:"s",readOnly:!0})})}),e(qc,{request:L})]}),e(Hc,{request:L,onChange:()=>{re(!0)}})]},L.id)})}):e("p",{class:"ui-state",children:e($e,{abrupt:!0})})]})})})}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:a,onChange:L=>{p(L.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),X&&!!s.notifications.length&&e("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":e(R,{children:"…"})}),s.notifications.length?e(R,{children:s.notifications.filter(L=>L.type!=="follow_request").map(L=>{if(a&&L.type!=="mention")return null;const J=new Date(L.createdAt),se=J.toDateString()!==Te.toDateString();se&&(Te=J);const _=J.toDateString()===Ne.toDateString()?"Yesterday":st(Te,{hideTime:!0});return e(R,{children:[se&&e("h2",{class:"timeline-header",children:_}),e(Kt,{instance:i,notification:L},L.id)]},L.id)})}):e(R,{children:[o==="loading"&&e(R,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((L,J)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),o==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>re(!0),children:"Try again"})]})]}),h&&e(ot,{onChange:L=>{L&&re()},children:e("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>re(),style:{marginBlockEnd:"6em"},children:o==="loading"?e($e,{abrupt:!0}):e(R,{children:"Show more…"})})})]}),E&&D&&e(_e,{onClick:L=>{L.target===L.currentTarget&&x(!1)},children:e("div",{class:"sheet",id:"notifications-settings",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>x(!1),children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Notifications settings"})}),e("main",{children:e("form",{onSubmit:L=>{L.preventDefault();const{filterNotFollowing:J,filterNotFollowers:se,filterNewAccounts:_,filterPrivateMentions:Y}=L.target,Q={filterNotFollowing:J.checked,filterNotFollowers:se.checked,filterNewAccounts:_.checked,filterPrivateMentions:Y.checked};P({...q,...Q}),x(!1),(async()=>{try{await n.v1.notifications.policy.update(Q),ie("Notifications settings updated")}catch{}})()},children:[e("p",{children:"Filter out notifications from people:"}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:q.filterNotFollowing,name:"filterNotFollowing"})," ","You don't follow"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:q.filterNotFollowers,name:"filterNotFollowers"})," ","Who don't follow you"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:q.filterNewAccounts,name:"filterNewAccounts"})," ","With a new account"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:q.filterPrivateMentions,name:"filterPrivateMentions"})," ","Who unsolicitedly private mention you"]})}),e("p",{children:e("button",{type:"submit",children:"Save"})})]})})]})})]})}function Oc(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function zc({announcement:t}){const{instance:n}=K(),{contact:i}=os(),s=i==null?void 0:i.account,{id:o,content:c,startsAt:l,endsAt:d,published:r,allDay:h,publishedAt:f,updatedAt:a,read:p,mentions:u,statuses:g,tags:y,emojis:S,reactions:m}=t,b=new Date(f),I=st(b),v=new Date(a),T=st(v);return e("div",{class:"announcement-block",children:[e(Je,{account:s}),e("div",{class:"announcement-content",onClick:fs({mentions:u,instance:n}),dangerouslySetInnerHTML:{__html:tn(c,{emojis:S})}}),e("p",{class:"insignificant",children:[e("time",{datetime:b.toISOString(),children:st(b)}),a&&T!==I&&e(R,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:v.toISOString(),children:st(v)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:m.map($=>{const{name:M,count:V,me:U,staticUrl:F,url:ee}=$;return e("button",{type:"button",class:`plain4 small ${U?"reacted":""}`,children:[ee||F?e("img",{src:ee||F,alt:M,width:"16",height:"16"}):e("span",{children:M})," ",e("span",{class:"count",children:Ge(V)})]})})})]})}function Bc(t){const{masto:n}=K();return n.v1.notifications.list({accountID:t})}function qc({request:t}){var a;const{instance:n}=K(),[i,s]=A("loading"),{account:o,lastStatus:c}=t,[l,d]=A(!1),[r,h]=A([]);function f(){d(!1)}return W(()=>{var p;(p=t==null?void 0:t.account)!=null&&p.id&&l&&(s("loading"),(async()=>{const u=await Bc(t.account.id);h(u||[]),s("default")})())},[l,(a=t==null?void 0:t.account)==null?void 0:a.id]),e(R,{children:[e("button",{type:"button",class:"plain4 request-notifications-account",onClick:()=>{d(!0)},children:[e(w,{icon:"notification",class:"more-insignificant"})," ",e("small",{children:["View notifications from @",o.username]})," ",e(w,{icon:"chevron-down"})]}),l&&e(_e,{onClick:p=>{p.target===p.currentTarget&&f()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:f,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Notifications from @",o.username]})}),e("main",{children:i==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):r.map(p=>e("div",{class:"notification-peek",onClick:u=>{const{target:g}=u;(u.target.tagName==="BUTTON"||u.target.tagName==="A")&&f()},children:e(Kt,{instance:n,notification:p,isStatic:!0})}))})]})})]})}function Hc({request:t,onChange:n}){const{masto:i}=K(),[s,o]=A("default"),[c,l]=A(null),d=c!==null;return e("p",{class:"notification-request-buttons",children:[e("button",{type:"button",disabled:s==="loading"||d,onClick:()=>{o("loading"),(async()=>{try{await i.v1.notifications.requests.$select(t.id).accept(),l("accept"),o("default"),n({request:t,state:"accept"}),ie(`Notifications from @${t.account.username} will not be filtered from now on.`)}catch{o("error"),ie("Unable to accept notification request")}})()},children:"Allow"})," ",e("button",{type:"button",disabled:s==="loading"||d,class:"light danger",onClick:()=>{o("loading"),(async()=>{try{await i.v1.notifications.requests.$select(t.id).dismiss(),l("dismiss"),o("default"),n({request:t,state:"dismiss"}),ie(`Notifications from @${t.account.username} will not show up in Filtered notifications from now on.`)}catch{o("error"),ie("Unable to dismiss notification request")}})()},children:"Dismiss"}),e("span",{class:"notification-request-states",children:s==="loading"?e($e,{abrupt:!0}):c==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"notification-accepted"}):c==="dismiss"&&e(w,{icon:"x-circle",alt:"Dismissed",class:"notification-dismissed"})})]})}const Us=Ze(Fc),Vc=20;function cn({local:t,columnMode:n,...i}){const s=Pe(C),o=!!t,c=n?{}:pt(),{masto:l,instance:d}=K({instance:(i==null?void 0:i.instance)||c.instance}),{masto:r,instance:h}=K(),f=`${o?"Local":"Federated"} timeline (${d})`;qe(f,o?"/:instance?/p/l":"/:instance?/p");const a=B(),p=B();async function u(y){(y||!p.current)&&(p.current=l.v1.timelines.public.list({limit:Vc,local:o}));const S=await p.current.next();let{value:m}=S;return m!=null&&m.length&&(y&&(a.current=m[0].id),m.forEach(b=>{Be(b,d)})),{...S,value:m}}async function g(){try{const y=await l.v1.timelines.public.list({limit:1,local:o,since_id:a.current}).next();let{value:S}=y;return S=Tt(S,"public"),!!(S!=null&&S.length)}catch{return!1}}return e(at,{title:f,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:o?"Local timeline":"Federated timeline"}),e("div",{children:d})]}),id:"public",instance:d,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:u,checkForUpdates:g,useItemID:!0,headerStart:e(R,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",headerEnd:e(Ke,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(he,{href:o?`/#/${d}/p`:`/#/${d}/p/l`,children:o?e(R,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(R,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(Oe,{}),e(he,{onClick:()=>{let y=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(y)){y&&alert("Invalid instance");return}y&&(y=y.toLowerCase().trim(),location.hash=o?`/${y}/p/l`:`/${y}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),h!==d&&e(he,{onClick:()=>{location.hash=o?`/${h}/p/l`:`/${h}/p`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:h}),")"]})]})]})},d+o)}const Nt=5,en=40,Gc=new URLSearchParams;function Fs({columnMode:t,...n}){const i=t?{}:pt(),{masto:s,instance:o,authenticated:c}=K({instance:i.instance}),[l,d]=A("default"),[r]=t?[Gc]:nt(),h=B(),f=(n==null?void 0:n.query)||r.get("q"),a=t?"statuses":(n==null?void 0:n.type)||r.get("type");qe(f?`Search: ${f}${a?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[a]})`:""}`:"Search","/search");const[p,u]=A(!1),g=B(0);W(()=>{g.current=0},[f,a]);const y=B();ct(()=>{var D,x;(x=(D=y.current)==null?void 0:D.scrollTo)==null||x.call(D,0,0)},[f,a]);const[S,m]=A([]),[b,I]=A([]),[v,T]=A([]);W(()=>{m([]),I([]),T([])},[f]);const $={statuses:m,accounts:I,hashtags:T},[M,V]=A({}),U=async D=>{if(!(D!=null&&D.length))return;const x=await bn(D,M);x&&V({...M,...x})};function F(D){D&&(g.current=0),!(!D&&!c)&&(d("loading"),D&&!a&&(m(S.slice(0,Nt)),I(b.slice(0,Nt)),T(v.slice(0,Nt))),(async()=>{var q,P;const x={q:f,resolve:c,limit:Nt};a&&(x.limit=en,x.type=a,c&&(x.offset=g.current));try{const oe=await s.v2.search.fetch(x);if(a)if(D){$[a](oe[a]);const Ce=(q=oe[a])==null?void 0:q.length;g.current=en,u(!!Ce)}else{$[a](Ie=>[...Ie,...oe[a]]);const Ce=(P=oe[a])==null?void 0:P.length;g.current=g.current+en,u(!!Ce)}else m(oe.statuses||[]),I(oe.accounts||[]),T(oe.hashtags||[]),g.current=0,u(!1);U(oe.accounts),d("default")}catch{d("error")}})())}const ee=B();St(D=>{var q;const x=((q=y.current)==null?void 0:q.scrollTop)===0;if(D&&x){const P=Date.now()-ee.current;!ee.current||P>1e3*3?F(!0):ee.current=Date.now()}}),W(()=>{var D,x,q,P;(x=(D=h.current)==null?void 0:D.setValue)==null||x.call(D,f||""),f?F(!0):(P=(q=h.current)==null?void 0:q.focus)==null||P.call(q)},[f,a,o]),Me(["/","Slash"],D=>{var x,q,P,oe;(q=(x=h.current)==null?void 0:x.focus)==null||q.call(x),(oe=(P=h.current)==null?void 0:P.select)==null||oe.call(P)},{preventDefault:!0});const[E]=ln();return e("div",{id:"search-page",class:"deck-container",ref:y,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:l==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(mt,{})}),e(As,{ref:h}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{F(!0)},disabled:l==="loading",children:e(w,{icon:"search",size:"l"})})})]})}),e("main",{children:[!!f&&!t&&e("div",{ref:E,class:`filter-bar ${l==="loading"?"loading":""}`,children:[!!a&&e(ae,{to:`/search${f?`?q=${encodeURIComponent(f)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(f)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(f)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(f)}&type=statuses`}].sort((D,x)=>D.type===a?-1:x.type===a?1:0).map(D=>e(ae,{to:D.to,children:D.label},D.type))]}),f?e(R,{children:[(!a||a==="accounts")&&e(R,{children:[a!=="accounts"&&e("h2",{class:"timeline-header",children:["Accounts"," ",e(ae,{to:`/search?q=${encodeURIComponent(f)}&type=accounts`,children:e(w,{icon:"arrow-right",size:"l"})})]}),b.length>0?e(R,{children:[e("ul",{class:"timeline flat accounts-list",children:b.map(D=>e("li",{children:e(Je,{account:D,instance:o,showStats:!0,relationship:M[D.id]})},D.id))}),a!=="accounts"&&e("div",{class:"ui-state",children:e(ae,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!a&&(l==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!a||a==="hashtags")&&e(R,{children:[a!=="hashtags"&&e("h2",{class:"timeline-header",children:["Hashtags"," ",e(ae,{to:`/search?q=${encodeURIComponent(f)}&type=hashtags`,children:e(w,{icon:"arrow-right",size:"l"})})]}),v.length>0?e(R,{children:[e("ul",{class:"link-list hashtag-list",children:v.map(D=>{var oe;const{name:x,history:q}=D,P=(oe=q==null?void 0:q.reduce)==null?void 0:oe.call(q,(Ce,Ie)=>Ce+ +Ie.uses,0);return e("li",{children:e(ae,{to:o?`/${o}/t/${x}`:`/t/${x}`,children:[e(w,{icon:"hashtag"}),e("span",{children:x}),!!P&&e("span",{class:"count",children:Ge(P)})]})},`${x}-${P}`)})}),a!=="hashtags"&&e("div",{class:"ui-state",children:e(ae,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!a&&(l==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!a||a==="statuses")&&e(R,{children:[a!=="statuses"&&e("h2",{class:"timeline-header",children:["Posts"," ",e(ae,{to:`/search?q=${encodeURIComponent(f)}&type=statuses`,children:e(w,{icon:"arrow-right",size:"l"})})]}),S.length>0?e(R,{children:[e("ul",{class:"timeline",children:S.map(D=>e("li",{children:e(ae,{class:"status-link",to:o?`/${o}/s/${D.id}`:`/s/${D.id}`,children:e(ze,{status:D})})},D.id))}),a!=="statuses"&&e("div",{class:"ui-state",children:e(ae,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!a&&(l==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!a&&(l==="default"?p?e(ot,{onChange:D=>{D&&F()},children:e("button",{type:"button",class:"plain block",onClick:()=>F(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):l==="loading"&&e("p",{class:"ui-state",children:e($e,{abrupt:!0})}))]}):l==="loading"?e("p",{class:"ui-state",children:e($e,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const jc=20,Yc=lt(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Os({columnMode:t,...n}){const i=Pe(C),s=t?{}:pt(),{masto:o,instance:c}=K({instance:(n==null?void 0:n.instance)||s.instance}),{masto:l,instance:d}=K(),r=`Trending (${c})`;qe(r,"/:instance?/trending");const h=B(),[f,a]=A([]),[p,u]=A([]),g=B();async function y(b){var T;if(b||!g.current){g.current=o.v1.trends.statuses.list({limit:jc});try{const $=o.v1.trends.tags.list(),{value:M}=await $.next();M!=null&&M.length&&a(M)}catch{}try{const{value:$}=await Yc(o,c),M=(T=$==null?void 0:$.filter)==null?void 0:T.call($,V=>V.type==="link");M!=null&&M.length&&u(M)}catch{}}const I=await g.current.next();let{value:v}=I;return v!=null&&v.length&&(b&&(h.current=v[0].id),v.forEach($=>{Be($,c)})),{...I,value:v}}async function S(){try{const b=await o.v1.trends.statuses.list({limit:1}).next();let{value:I}=b;return I=Tt(I,"public"),I!=null&&I.length&&I[0].id!==h.current?(h.current=I[0].id,!0):!1}catch{return!1}}const m=ge(()=>e(R,{children:[!!f.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),f.map((b,I)=>{const{name:v,history:T}=b,$=T.reduce((M,V)=>M+ +V.uses,0);return e(ae,{to:`/${c}/t/${v}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),v]}),e("span",{class:"filter-count",children:Ge($)})]},v)})]}),!!p.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),p.map(b=>{const{authorName:I,authorUrl:v,blurhash:T,description:$,height:M,image:V,imageDescription:U,language:F,providerName:ee,providerUrl:E,publishedAt:D,title:x,url:q,width:P}=b,oe=Ct.toUnicode(new URL(q).hostname.replace(/^www\./,"").replace(/\/$/,""));let Ce;if(T){const Ie=dn(T),H=yn(Ie);Ce=wn([.6,H[1],H[2]])}return e("a",{href:q,target:"_blank",rel:"noopener noreferrer",style:Ce?{"--accent-color":`rgb(${Ce.join(",")})`,"--accent-alpha-color":`rgba(${Ce.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:V,alt:U,width:P,height:M,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:oe})," ",!!D&&e(R,{children:"· "}),!!D&&e(R,{children:e(ft,{datetime:D,format:"micro"})})]}),!!x&&e("h1",{class:"title",lang:F,dir:"auto",title:x,children:x})]}),!!$&&e("p",{class:"description",lang:F,dir:"auto",title:$,children:$})]})]})},q)})]})]}),[f,p]);return e(at,{title:r,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:c})]}),id:"trending",instance:c,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:y,checkForUpdates:S,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(R,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",timelineStart:m,headerEnd:e(Ke,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(he,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),d!==c&&e(he,{onClick:()=>{location.hash=`/${d}/trending`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:d}),")"]})]})]})},c)}function Wc(){qe("Home","/");const t=Pe(C),{shortcuts:n}=t,i=n.map(s=>{if(!s)return null;const{type:o,...c}=s,l={following:kn,notifications:Us,list:Ds,public:cn,bookmarks:Ls,favourites:_s,hashtag:Ms,mentions:Ps,trending:Os,search:Fs}[o];return!l||o==="search"&&!c.query||o==="list"&&!c.id?null:e(l,{...c,columnMode:!0},o+JSON.stringify(c))});return Me(["1","2","3","4","5","6","7","8","9"],(s,o)=>{try{const c=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[c].focus()}catch{}}),e("div",{id:"columns",onContextMenu:s=>{s.target.closest(".deck > header")&&!s.target.closest("a")&&!s.target.closest("button")&&(s.preventDefault(),C.showShortcutsSettings=!0)},children:i})}function Kc(){var n;const t=Pe(C);return W(()=>{(async()=>{const i=await et.drafts.keys();if(i.length){const s=Ht();i.filter(c=>c.startsWith(s)).length&&(C.showDrafts=!0)}})()},[]),e(R,{children:(t.settings.shortcutsViewMode==="multi-column"||!t.settings.shortcutsViewMode&&t.settings.shortcutsColumnsMode)&&((n=t.shortcuts)!=null&&n.length)?e(Wc,{}):e(kn,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(Zc,{})})})}function Zc(){const t=Pe(C),n=B(),[i,s]=A(void 0);return e(R,{children:[e(ae,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${i||""}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),s(c=>c?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(Qc,{state:i,anchorRef:n,onClose:()=>s(void 0)})]})}const Jc=30,Xc=5;function Qc({anchorRef:t,state:n,onClose:i}){const{masto:s,instance:o}=K(),c=Pe(C),[l,d]=A("default"),r=s.v1.notifications.list({limit:Jc});async function h(){const g=await r.next(),y=g.value;if(y!=null&&y.length){y.forEach(m=>{Be(m.status,o,{skipThreading:!0})});const S=Ns(y);C.notificationsLast=y[0],C.notifications=S,s.v1.markers.create({notifications:{lastReadId:y[0].id}}).catch(()=>{})}return C.notificationsShowNew=!1,C.notificationsLastFetchTime=Date.now(),g}const[f,a]=A(!1);function p(){return s.v1.followRequests.list({limit:1})}function u(){d("loading"),(async()=>{try{await h();const g=await p();a(!!(g!=null&&g.length)),d("default")}catch{d("error")}})()}return W(()=>{n==="open"&&u()},[n]),e(ls,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:i,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:c.notifications.length?e(R,{children:c.notifications.slice(0,Xc).map(g=>e(Kt,{instance:o,notification:g,disableContextMenu:!0},g.id))}):l==="loading"?e("div",{class:"ui-state",children:e($e,{abrupt:!0})}):l==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:u,children:"Try again"})})]})}),e("footer",{children:[e(ae,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(ae,{to:"/notifications",class:"button plain2",children:[f?e(R,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const ea=Ze(Kc),ta=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function zs(t){const{hostname:n,pathname:i}=new URL(t);for(const s of ta){const[,o]=i.match(s)||[];if(o)return{instance:n,id:o}}return{}}function na(t){const{instance:n,id:i}=zs(t);return n&&i?`/${n}/s/${i}`:null}function sa(){const n=It().pathname.replace(/^\//,""),i=zs(n),s=i!=null&&i.instance?`/${i.instance}/s/${i.id}`:null,[o,c]=A("loading");return ct(()=>{c("loading"),(async()=>{try{const{instance:l,id:d}=i,{masto:r}=K({instance:l});if(await r.v1.statuses.$select(d).fetch()){window.location.hash=s+"?view=full";return}}catch{}{const{masto:l,instance:d}=K(),r=await l.v2.search.fetch({q:n,limit:1,resolve:!0});if(r.statuses.length){const h=r.statuses[0];window.location.hash=`/${d}/s/${h.id}?view=full`}else if(r.accounts.length){const h=r.accounts[0];window.location.hash=`/${d}/a/${h.id}`}else s?window.location.hash=s+"?view=full":c("error")}})()},[s]),e("div",{class:"ui-state",tabIndex:"-1",children:[o==="loading"?e(R,{children:[e($e,{abrupt:!0}),e("h2",{children:"Resolving…"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):e(R,{children:[e("h2",{children:"Unable to resolve URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(ae,{to:"/",children:"Go home"})})]})}function ia(){qe("Lists","/l");const[t,n]=A("default"),[i,s]=ht(r=>r+1,0),[o,c]=A([]);W(()=>{n("loading"),(async()=>{try{const r=await sn();c(r),n("default")}catch{n("error")}})()},[i]);const[l,d]=A(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),e(ae,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>d(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:o.length>0?e(R,{children:[e("ul",{class:"link-list",children:o.map(r=>e("li",{children:e(ae,{to:`/l/${r.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:r.title})]})})}))}),o.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[o.length," list",o.length===1?"":"s"]})})]}):t==="loading"?e("p",{class:"ui-state",children:e($e,{})}):t==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),l&&e(_e,{onClick:r=>{r.target===r.currentTarget&&d(!1)},children:e(gn,{list:l==null?void 0:l.list,onClose:r=>{r.state==="success"&&s(),d(!1)}})})]})}const oa=""+new URL("instances-MzK7fGXv.json",import.meta.url).href;var ca={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:aa,PHANPY_WEBSITE:ra}=ca,Sn="read write follow push";async function la({instanceURL:t}){const n=new URLSearchParams({client_name:aa,redirect_uris:location.origin+location.pathname,scopes:Sn,website:ra});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function da({instanceURL:t,client_id:n}){const i=new URLSearchParams({client_id:n,scope:Sn,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${i.toString()}`}async function ua({instanceURL:t,client_id:n,client_secret:i,code:s}){const o=new URLSearchParams({client_id:n,client_secret:i,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:s,scope:Sn});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}var ha={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:pa}=ha;function fa(){qe("Log in");const t=B(),n=ce.local.get("instanceURL"),[i,s]=A("default"),[o]=nt(),c=o.get("instance"),l=o.get("submit"),[d,r]=A(c||(n==null?void 0:n.toLowerCase())||""),[h,f]=A([]);W(()=>{(async()=>{try{const b=await(await fetch(oa)).json();f(b)}catch{}})()},[]);const a=m=>{m&&(ce.local.set("instanceURL",m),(async()=>{s("loading");try{const{client_id:b,client_secret:I,vapid_key:v}=await la({instanceURL:m});b&&I?(ce.session.set("clientID",b),ce.session.set("clientSecret",I),ce.session.set("vapidKey",v),location.href=await da({instanceURL:m,client_id:b})):alert("Failed to register application"),s("default")}catch{s("error")}})())},p=d?d.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,u=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(p)&&!/[\s\/\\@]/.test(p),g=p?h.filter(m=>m.includes(d)).sort((m,b)=>{const I=m.toLowerCase().startsWith(d.toLowerCase()),v=b.toLowerCase().startsWith(d.toLowerCase());return I&&!v?-1:!I&&v?1:0}).slice(0,10):[],y=u?p:g!=null&&g.length?g[0]:d?h.find(m=>m.includes(d)):null,S=m=>{m.preventDefault(),a(y)};return l&&W(()=>{a(c||y)},[]),e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:S,children:[e("h1",{children:[e("img",{src:fn,alt:"",width:"80",height:"80"}),e("br",{}),"Log in"]}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:d,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:i==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellCheck:!1,placeholder:"instance domain",onInput:m=>{r(m.target.value)}}),(g==null?void 0:g.length)>0?e("ul",{id:"instances-suggestions",children:g.map((m,b)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{a(m)},children:m})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),i==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{disabled:i==="loading"||!d||!y,children:y?`Continue with ${y}`:"Continue"})," "]}),e($e,{hidden:i!=="loading"}),e("hr",{}),!pa&&e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(ae,{to:"/",children:"Go home"})})]})})}const Ut=40,ma=10,ga=5;let an={},zt={},Bt={};function qt(t){delete zt[t],delete Bt[t]}const $t={block:"nearest",inline:"center",behavior:"smooth"},Jn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",Xn=/\/s\//i;function ba(t){var v;const{id:n}=t,{masto:i,instance:s}=K({instance:t.instance}),o=Pe(C),[c,l]=nt(),d=c.get("media"),r=c.get("media-only"),h=parseInt(d||r,10);let f=h>0;const a=c.get("mediaStatusID"),p=cs(a,s);a&&!p&&(f=!1);const u=f&&!!r,g=We(n,s),[y,S]=A(C.statuses[g]);W(()=>{C.statuses[g]&&S(C.statuses[g])},[g]);const m=ge(()=>{const{prevLocation:T}=C,$=((T==null?void 0:T.pathname)||"")+((T==null?void 0:T.search)||""),M=Lt("/:instance/s/:id",$)||Lt("/s/:id",$);return!$||M?"/":$},[]);W(()=>{!y&&f&&(async()=>{try{const T=await i.v1.statuses.$select(n).fetch();Be(T,s),S(T)}catch{alert("Unable to load post."),location.hash=m}})()},[f]);const b=a?(v=o.statuses[We(a,s)])==null?void 0:v.mediaAttachments:y==null?void 0:y.mediaAttachments,I=Xe(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():u?location.hash=m:(c.delete("media"),c.delete("mediaStatusID"),l(c))},[u,m,o.prevLocation]);return W(()=>{let T=setTimeout(()=>{const $=document.querySelector(".carousel");$&&$.focus()},100);return()=>clearTimeout(T)},[u]),e("div",{class:"deck-backdrop",children:[f?b!=null&&b.length?e(xs,{mediaAttachments:b,statusID:a||n,instance:s,lang:y==null?void 0:y.language,index:h-1,onClose:I}):e("div",{class:"media-modal-container loading",children:e($e,{abrupt:!0})}):e(ae,{to:m}),!u&&e(wa,{id:n,instance:t.instance,closeLink:m})]})}function ya(t){const{linkable:n,to:i,onClick:s,...o}=t;return n?e(ae,{class:"status-link",to:i,onClick:s,...o}):e("div",{class:"status-focus",tabIndex:0,...o})}function wa({id:t,closeLink:n="/",instance:i}){var J,se;const[s,o]=nt(),c=s.get("media"),l=s.get("mediaStatusID"),d=parseInt(c,10)>0,r=B(!C.prevLocation&&(history.length===1||"navigation"in window&&((se=(J=navigation==null?void 0:navigation.entries)==null?void 0:J.call(navigation))==null?void 0:se.length)===1)),[h,f]=A(s.get("view")||r.current?"full":null),a=!!parseInt(s.get("translate")),{masto:p,instance:u}=K({instance:i}),{masto:g,instance:y,authenticated:S}=K(),m=u===y,b=Pe(C),[I,v]=A([]),[T,$]=A("default"),M=B(),V=We(t,u),U=B(0),F=B();W(()=>{var _;(_=F.current)==null||_.focus()},[]),W(()=>{var Y;const _=us(()=>{if(!F.current)return;const{scrollTop:Q}=F.current;T!=="loading"&&(Bt[t]=Q)},50);return(Y=F.current)==null||Y.addEventListener("scroll",_,{passive:!0}),_(),()=>{var Q;_.cancel(),(Q=F.current)==null||Q.removeEventListener("scroll",_)}},[t,T!=="loading"]);const ee=B(),E=B(),D=({reloadHero:_}={})=>{$("loading");let Y;const Q=zt[t];if(Q){const ke=Q.filter(k=>C.statuses[V]);v(ke)}else v([{id:t}]);return(async()=>{var O,j;const ke=()=>$n(()=>p.v1.statuses.$select(t).fetch(),{retries:4}),k=$n(()=>p.v1.statuses.$select(t).context.fetch(),{retries:8}),N=!!b.statuses[V];let z=b.statuses[V];if(!(N&&!_))try{z=await ke(),Be(z,u),await new Promise(be=>{setTimeout(be,100)})}catch{$("error");return}try{let be=function(Z){return Z==null?void 0:Z.map(Le=>({id:Le.id,account:Le.account,repliesCount:Le.repliesCount,content:Le.content,weight:Rt(Le),replies:be(Le.__replies)}))};const ue=await k,{ancestors:me,descendants:fe}=ue;U.current=(fe==null?void 0:fe.length)||0;const Ae=new Set;me.forEach(Z=>{Be(Z,u,{skipThreading:!0}),Z.inReplyToId&&!me.find(Le=>Le.id===Z.inReplyToId)&&Ae.add(Z.inReplyToId)});const Ve=me.every(Z=>Z.account.id===z.account.id),Re=[];fe.forEach(Z=>{if(Be(Z,u,{skipThreading:!0}),Z.inReplyToId&&!fe.find(Le=>Le.id===Z.inReplyToId)&&Z.inReplyToId!==z.id&&Ae.add(Z.inReplyToId),Z.inReplyToAccountId===Z.account.id)Re.push(Z);else if(Z.inReplyToId===z.id)Re.push(Z);else if(!Z.inReplyToAccountId&&Re.find(Le=>Le.id===Z.inReplyToId)&&Z.account.id===z.account.id)Re.push(Z);else{const Le=fe.find(gt=>gt.id===Z.inReplyToId);Le&&(Le.__replies||(Le.__replies=[]),Le.__replies.push(Z))}}),Ae.size;const He=[...me.map(Z=>({id:Z.id,ancestor:!0,isThread:Ve,accountID:Z.account.id,account:Z.account,repliesCount:Z.repliesCount,weight:Rt(Z)})),{id:t,accountID:z.account.id,weight:Rt(z)},...Re.map(Z=>({id:Z.id,account:Z.account,accountID:Z.account.id,descendant:!0,thread:Z.account.id===z.account.id,weight:Rt(Z),replies:be(Z.__replies)}))];$("default"),ee.current={offsetTop:(O=M.current)==null?void 0:O.offsetTop,scrollTop:(j=F.current)==null?void 0:j.scrollTop};const ye=He.findIndex(Z=>Z.id===t);ye>=we&&re(ye+1),v(He),zt[t]=He,Ys(z,u)}catch{$("error")}})(),E.current=Date.now(),()=>{clearTimeout(Y)}};W(D,[t,p]);const[x,q]=A(!1);W(()=>{let _=setInterval(()=>{const Y=Date.now();E.current&&Y-E.current>=6e4&&q(!0)},6e4);return()=>{clearInterval(_)}},[]),ct(()=>{var Y,Q;if(!I.length)return;const _=Bt[t];if(_)F.current.scrollTop=_;else if(ee.current){const ke={offsetTop:(Y=M.current)==null?void 0:Y.offsetTop,scrollTop:(Q=F.current)==null?void 0:Q.scrollTop},k=ke.offsetTop-ee.current.offsetTop+ke.scrollTop;F.current.scrollTop=k}else I.length===1&&(F.current.scrollTop=0);ee.current=null},[I]),W(()=>{b.reloadStatusPage<=0||(async()=>{try{const{instanceURL:_}=vt(),Y=`https://${_}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(Y,{ignoreVary:!0}),D({reloadHero:!0})}catch{}})()},[b.reloadStatusPage]),W(()=>()=>{Bt={},C.reloadStatusPage=0,zt={},an={},rn.clear()},[]);const P=b.statuses[V]||b.statuses[t],oe=ge(()=>{if(!P)return"";const{account:_}=P,Y=document.createElement("div");return Y.innerHTML=_.displayName,Y.innerText.trim()},[P]),Ce=ge(()=>{if(!P)return"";let _=pn(P);return _.length>64&&(_=_.slice(0,64)+"…"),_},[P]);qe(oe&&Ce?`${oe}: "${Ce}"`:"Status","/:instance?/s/:id");const Ie=ge(()=>{if(!P)return;const{url:_}=P;if(_)return new URL(_).hostname},[P]),H=ge(()=>{if(Ie)return Ie===u},[Ie,u]),[we,re]=A(Ut),pe=ge(()=>I.length-we,[I.length,we]),ve=I.some(_=>_.descendant),De=I.filter(_=>_.ancestor),[Se,Ue]=A(!0),Ne=ge(()=>{if(!M.current||Se)return null;const{top:_}=M.current.getBoundingClientRect();return _>0?"down":"up"},[Se]);Me("esc",()=>{location.hash=n},{enabled:!d,ignoreEventWhen:_=>!!document.querySelector("#modal-container > *")}),Me("backspace",()=>{location.hash=n}),Me("j",()=>{const _=document.activeElement.closest(".status-link, .status-focus"),Y=_==null?void 0:_.getBoundingClientRect(),Q=Array.from(F.current.querySelectorAll(Jn));if(_&&Y.top<F.current.clientHeight&&Y.bottom>0){const ke=Q.indexOf(_);let k=Q[ke+1];k&&(k.focus(),k.scrollIntoView($t))}else{const ke=Q.find(k=>{const N=k.getBoundingClientRect();return N.top>=44&&N.left>=0});ke&&(ke.focus(),ke.scrollIntoView($t))}}),Me("k",()=>{const _=document.activeElement.closest(".status-link, .status-focus"),Y=_==null?void 0:_.getBoundingClientRect(),Q=Array.from(F.current.querySelectorAll(Jn));if(_&&Y.top<F.current.clientHeight&&Y.bottom>0){const ke=Q.indexOf(_);let k=Q[ke-1];k&&(k.focus(),k.scrollIntoView($t))}else{const ke=Q.find(k=>{const N=k.getBoundingClientRect();return N.top>=44&&N.left>=0});ke&&(ke.focus(),ke.scrollIntoView($t))}}),Me("x",()=>{const _=document.activeElement.closest(".status-link, .status-focus");if(_){const Y=_.nextElementSibling;Y&&Y.tagName.toLowerCase()==="details"&&(Y.open=!Y.open)}});const[Te,X]=A(!1),le=B(d?"media+status":"status"),te=Xe((_,Y,Q,ke)=>{_.preventDefault(),_.stopPropagation(),o({media:Y+1,mediaStatusID:ke.id})},[t]),xe=Xe((_,Y)=>{qt(Y.id)},[]);W(()=>{let _;return l&&d&&(_=setTimeout(()=>{var Q;const Y=(Q=F.current)==null?void 0:Q.querySelector(`.status-link[href*="/${l}"]`);Y&&Y.scrollIntoView($t)},400)),()=>{clearTimeout(_)}},[l,d]);const de=Xe((_,Y)=>{const{id:Q,ancestor:ke,isThread:k,descendant:N,thread:z,replies:O,repliesCount:j,weight:be}=_,ue=Q===t;return e("li",{ref:ue?M:null,class:`${ke?"ancestor":""} ${N?"descendant":""} ${z?"thread":""} ${ue?"hero":""}`,children:[ue?e(R,{children:[e(ot,{threshold:.1,onChange:fe=>{queueMicrotask(()=>{requestAnimationFrame(()=>{Ue(fe)})})},class:"status-focus",tabIndex:0,children:e(ze,{statusID:Q,instance:u,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:a})}),T!=="loading"&&!S?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(ae,{to:"/login",class:"button",children:"Log in"})]}):!m&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:u}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:T==="loading",onClick:()=>{$("loading"),(async()=>{try{const fe=await g.v2.search.fetch({q:P.url,type:"statuses",resolve:!0,limit:1});if(fe.statuses.length){const Ae=fe.statuses[0];location.hash=y?`/${y}/s/${Ae.id}`:`/s/${Ae.id}`}else throw new Error("No results")}catch(fe){$("default"),alert("Error: "+fe)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(ya,{linkable:k||ke,to:u?`/${u}/s/${Q}`:`/s/${Q}`,onClick:()=>{qt(Q)},children:[Y===0&&ke?e(ot,{threshold:.5,onChange:fe=>{queueMicrotask(()=>{requestAnimationFrame(()=>{X(fe)})})},children:e(ze,{statusID:Q,instance:u,withinContext:!0,size:z||ke?"m":"s",enableTranslate:!0,onMediaClick:te,onStatusLinkClick:xe})}):e(ze,{statusID:Q,instance:u,withinContext:!0,size:z||ke?"m":"s",enableTranslate:!0,onMediaClick:te,onStatusLinkClick:xe,showActionsBar:!!N}),ke&&j>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:j,children:Ge(j)})]})," "]}),N&&(O==null?void 0:O.length)>0&&e(Bs,{instance:u,replies:O,hasParentThread:z,level:1,accWeight:be,openAll:U.current<ma,parentLink:{to:u?`/${u}/s/${Q}`:`/s/${Q}`,onClick:()=>qt(Q)}}),T==="loading"&&ue&&!!(P!=null&&P.repliesCount)&&!ve&&e("div",{class:"status-loading",children:e($e,{abrupt:P.repliesCount>=3})}),T==="error"&&ue&&!!(P!=null&&P.repliesCount)&&!ve&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{C.reloadStatusPage++},children:"Try again"})]})]},Q)},[t,u,T,S,m,a,te,xe,ve]),ne=ge(()=>{var _;if("navigation"in window&&(navigation!=null&&navigation.entries)){const Y=navigation.entries()[navigation.currentEntry.index-1];if(Y!=null&&Y.url)return Xn.test(Y.url)}return Xn.test((_=C.prevLocation)==null?void 0:_.pathname)},[V]),G=ge(()=>{if(!pe)return[];const _=[];function Y(Q){_.push(Q.id),Q.replies&&Q.replies.forEach(Y)}return I.slice(we).forEach(Y),_.map(Q=>We(Q,u))},[pe,I,we,u]),L=ge(()=>I.slice(0,we).map(de),[I,we,de]);return e("div",{tabIndex:"-1",ref:F,class:`status-deck deck contained ${I.length>1?"padded-bottom":""} ${le.current==="status"&&!r.current?"slide-in":""} ${h?`deck-view-${h}`:""}`,onAnimationEnd:_=>{le.current==="status"&&(le.current=null)},children:[e("header",{class:`${T==="loading"?"loading":""}`,onDblClick:_=>{C.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[ne&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!Se&&P&&T!=="loading"?e(R,{children:[e("span",{class:"hero-heading",children:[e(kt,{account:P.account,instance:u,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(ft,{datetime:P.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:_=>{_.preventDefault(),_.stopPropagation(),M.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:Ne==="down"?"arrow-down":"arrow-up"})})]}):e(R,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:_=>{_.preventDefault(),_.stopPropagation(),F.current.scrollTo({top:0,behavior:"smooth"})},hidden:!De.length||Te,title:`${De.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),De.filter((_,Y,Q)=>Q.findIndex(ke=>ke.accountID===_.accountID)===Y).slice(0,3).map(_=>e(tt,{url:_.account.avatar,alt:_.account.displayName},_.account.id)),De.length>3&&e(R,{children:[" ",e("span",{class:"insignificant",children:Ge(De.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:h==="full"?"":"none"},onClick:()=>{f(null),s.delete("media"),s.delete("media-only"),s.delete("view"),o(s)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),x&&e("button",{type:"button",class:"plain button-refresh",onClick:()=>{C.reloadStatusPage++,q(!1)},children:e(w,{icon:"refresh",size:"l"})}),e(Ke,{align:"end",portal:{target:F.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(he,{disabled:T==="loading",onClick:()=>{C.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(he,{className:"menu-switch-view",onClick:()=>{f(h==="full"?null:"full"),s.delete("media"),s.delete("media-only"),h==="full"?s.delete("view"):s.set("view","full"),o(s)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[h||""]}),e("span",{children:["Switch to ",h==="full"?"Side Peek":"Full"," view"]})]}),e(he,{onClick:()=>{Array.from(F.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(Y=>{Y.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(Oe,{}),e(ds,{className:"plain",children:"Experimental"}),e(he,{disabled:!Ie||H,onClick:()=>{const _=na(P.url);_?location.hash=_:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance",Ie?e(R,{children:[" ","(",e("b",{children:Ct.toUnicode(Ie)}),")"]}):""]})]})]}),e(ae,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),I.length&&P?e("ul",{class:`timeline flat contextual grow ${T==="loading"?"loading":""}`,children:[L,pe>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:T==="loading",onClick:()=>re(_=>_+Ut),style:{marginBlockEnd:"6em"},"data-state-post-ids":G.join(" "),children:[e("div",{class:"ib avatars-bunch",children:I.slice(we,we+5).map(_=>e(tt,{url:_.account.avatarStatic},_.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:pe>Ut?`${Ut}+`:pe})]})]})})]}):e(R,{children:[T==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(ze,{skeleton:!0,size:"l"})})}),T==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{C.reloadStatusPage++},children:"Try again"})]})]})]})}function Bs({replies:t,instance:n,hasParentThread:i,level:s,accWeight:o,openAll:c,parentLink:l}){const[d,r]=nt(),h=b=>b.reduce((I,v)=>{const{repliesCount:T,replies:$}=v,M=($==null?void 0:$.length)||T;return I+M+h($||[])},0),f=t.length+h(t),a=t.length===f,p=t.map(b=>b.account).filter((b,I,v)=>v.findIndex(T=>T.id===b.id)===I).slice(0,3),u=ge(()=>t==null?void 0:t.reduce((b,I)=>b+(I==null?void 0:I.weight),o),[o,t==null?void 0:t.length]);let g=!1;(c||u<=ga||!i&&f===1&&Rt(t[0])<2)&&(g=!0);const y=an[t[0].id],S=Xe((b,I,v,T)=>{b.preventDefault(),b.stopPropagation(),r({media:I+1,mediaStatusID:T.id})},[]),m=B();return ct(()=>{var I;function b(v){v.target.dataset.scrollLeft=v.target.scrollLeft}return(I=m.current)==null||I.addEventListener("scroll",b,{passive:!0}),()=>{var v;(v=m.current)==null||v.removeEventListener("scroll",b)}},[]),e("details",{ref:m,class:"replies",open:y||g,onToggle:b=>{const{open:I}=b.target;an[t[0].id]=I},style:{"--comments-level":s},"data-comments-level":s,"data-comments-level-overflow":s>4,children:[e("summary",{class:"replies-summary",hidden:g,children:[e("span",{class:"avatars",children:p.map(b=>e(tt,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),e("span",{class:"replies-counts",children:[e("b",{children:[e("span",{title:t.length,children:Ge(t.length)})," ","repl",t.length===1?"y":"ies"]}),!a&&f>1&&e(R,{children:[" ","·"," ",e("span",{children:[e("span",{title:f,children:Ge(f)})," ","comment",f===1?"":"s"]})]})]}),e(w,{icon:"chevron-down",class:"replies-summary-chevron"}),!!l&&e(ae,{class:"replies-parent-link",to:l.to,onClick:l.onClick,title:"View post with its replies",children:"»"})]}),e("ul",{children:t.map(b=>{var I,v;return e("li",{children:[e("div",{class:"status-focus",tabIndex:0,children:[e(ze,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:S,showActionsBar:!0}),!((I=b.replies)!=null&&I.length)&&b.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:b.repliesCount,children:Ge(b.repliesCount)})]})]}),((v=b.replies)==null?void 0:v.length)&&e(Bs,{instance:n,replies:b.replies,level:s+1,accWeight:g?u:b.weight,openAll:c,parentLink:{to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{qt(b.id)}}})]},b.id)})})]})}const va=140,ka=35,Sa=70,Ia=140,rn=new Map;function Rt(t){var u,g;const n=rn.get(t.id);if(n)return n;const{spoilerText:i,content:s,mediaAttachments:o,poll:c,card:l}=t,d=ws(i+s),r=o!=null&&o.length?va:0,h=(((u=c==null?void 0:c.options)==null?void 0:u.length)||0)*ka,f=l&&(o!=null&&o.length||(g=c==null?void 0:c.options)!=null&&g.length)?0:Sa,p=(d+r+h+f)/Ia;return rn.set(t.id,p),p}const Ca=Ze(ba);function Ta(){const t=pt(),{id:n,instance:i}=t;return e(Ca,{id:n,instance:i})}const xa=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,$a=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,Aa=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,Ra=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,La=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,_a="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var Ea={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:At,PHANPY_WEBSITE:Qn,PHANPY_PRIVACY_POLICY_URL:Ma,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:es}=Ea,ts=Qn?Qn.replace(/https?:\/\//g,"").replace(/\/$/,""):null,ns=`${"2024-04-04T11:41:32.789Z".slice(0,10).replace(/-/g,".")}.65d51b0`;function ss(){return qe(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:fn,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:_a,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),e("p",{children:e(ae,{to:At?`/login?instance=${At}&submit=1`:"/login",class:"button",children:At?"Log in":"Log in with Mastodon"})}),At&&es&&e("p",{children:e("a",{href:es,class:"button plain5",children:"Sign up"})}),!At&&e("p",{class:"insignificant",children:e("small",{children:["Connect your existing Mastodon/Fediverse account.",e("br",{}),"Your credentials are not stored on this server."]})})]}),(ts||ns)&&e("p",{class:"app-site-version",children:e("small",{children:[ts," ",ns]})}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),C.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:Ma,target:"_blank",children:"Privacy Policy"}),"."]})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:xa,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:La,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:$a,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:Aa,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:Ra,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Da=window.alert;window.__nativeAlert||(window.__nativeAlert=Da);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=ri({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=C;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(o=>{n[o]=Object.keys(C[o]).length});const{statuses:i}=C,s=[];for(const o in i)document.querySelector(`[data-state-post-id~="${o}"], [data-state-post-ids~="${o}"]`)||s.push(o)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:t,unfurledLinks:n,notifications:i}=C;let s=0;const{instance:o}=K();for(const c in t){if(!window.__IDLE__)break;try{const l=document.querySelector(`[data-state-post-id~="${c}"], [data-state-post-ids~="${c}"]`),d=i.some(r=>{var h;return c===We((h=r.status)==null?void 0:h.id,o)});if(!l&&!d){delete C.statuses[c],delete C.statusQuotes[c];for(const r in n){const h=n[r];if(We(h.id,h.instance)===c){delete C.unfurledLinks[r];break}}s++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const t in Et)queueMicrotask(()=>{var n,i,s,o;Array.isArray(Et[t])?(i=(n=Et[t])[0])==null||i.call(n):(o=(s=Et)[t])==null||o.call(s)})},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},s=us(n,3e3),o=()=>{window.__IDLE__=!1,s()};t.forEach(c=>{window.addEventListener(c,o,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",c=>{!c.relatedTarget&&!c.toElement&&n()},{passive:!0})})();const Pa=/iPad|iPhone|iPod/.test(navigator.userAgent);Pa&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const t=ce.local.get("theme");let n;if(t){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const i=n.content,s=t==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=s||"",setTimeout(()=>{n.content=i},10)}}else{const i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${i}"]`),n){const s=n.dataset.content,o=n.dataset.contentTemp;n.content=o||"",setTimeout(()=>{n.content=s},10)}}}});{const t=ce.local.get("theme");if(t){document.documentElement.classList.add(`is-${t}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",t||"dark light");const i=document.querySelector('meta[data-theme-setting="manual"]');i&&(i.name="theme-color",i.content=t==="light"?i.dataset.themeLightColor:i.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(o=>{o.name=""})}const n=ce.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}as(C,t=>{var n;for(const[i,s,o,c]of t){if(s.join(".")==="settings.shortcutsViewMode"){const l=document.getElementById("app");l&&(l.dataset.shortcutsViewMode=(n=C.shortcuts)!=null&&n.length?o:"")}s.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",o)}});function Na(){const[t,n]=A(!1),[i,s]=A("loading");W(()=>{const c=ce.local.get("instanceURL"),l=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(l){window.history.replaceState({},document.title,window.location.pathname||"/");const d=ce.session.get("clientID"),r=ce.session.get("clientSecret"),h=ce.session.get("vapidKey");(async()=>{s("loading");const{access_token:f}=await ua({instanceURL:c,client_id:d,client_secret:r,code:l}),a=Ws({instance:c,accessToken:f});await Promise.allSettled([In(a,c),Ks(a,c,f,h)]),Cn(),Tn(a),n(!0),s("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const d=vt();if(d){ce.session.set("currentAccount",d.info.id);const{client:r}=K({account:d}),{instance:h}=r;Cn(),Tn(r),s("loading"),(async()=>{try{await In(r,h)}catch{}finally{n(!0),s("default")}})()}else s("default")}},[]);let o=It();return C.currentLocation=o.pathname,W(nn,[o,t]),/\/https?:/.test(o.pathname)?e(sa,{}):e(R,{children:[e(Ua,{isLoggedIn:t,loading:i==="loading"}),e(Fa,{isLoggedIn:t}),i==="default"&&e(un,{children:e(Fe,{path:"/:instance?/s/:id",element:e(Ta,{})})}),t&&e(Ci,{}),t&&e(Po,{}),e(Ro,{}),t&&e(Eo,{}),e(ki,{isLoggedIn:t}),i!=="loading"&&e(Mo,{onClose:nn}),e(Ti,{})]})}function Ua({isLoggedIn:t,loading:n}){const i=It(),s=ge(()=>{const{pathname:o}=i;return!/^\/(login|welcome)/i.test(o)},[i]);return e(un,{location:s||i,children:[e(Fe,{path:"/",element:t?e(ea,{}):n?e($e,{id:"loader-root"}):e(ss,{})}),e(Fe,{path:"/login",element:e(fa,{})}),e(Fe,{path:"/welcome",element:e(ss,{})})]})}function is(){return C.prevLocation||null}function Fa({isLoggedIn:t}){const n=It(),i=B(is());return ge(()=>Lt("/:instance/s/:id",n.pathname)||Lt("/s/:id",n.pathname),[n.pathname,Lt])?i.current||(i.current=is()):i.current=null,e(un,{location:i.current||n,children:[t&&e(R,{children:[e(Fe,{path:"/notifications",element:e(Us,{})}),e(Fe,{path:"/mentions",element:e(Ps,{})}),e(Fe,{path:"/following",element:e(kn,{})}),e(Fe,{path:"/b",element:e(Ls,{})}),e(Fe,{path:"/f",element:e(_s,{})}),e(Fe,{path:"/l",children:[e(Fe,{index:!0,element:e(ia,{})}),e(Fe,{path:":id",element:e(Ds,{})})]}),e(Fe,{path:"/fh",element:e(Tc,{})}),e(Fe,{path:"/ft",element:e(kc,{})}),e(Fe,{path:"/catchup",element:e(ac,{})})]}),e(Fe,{path:"/:instance?/t/:hashtag",element:e(Ms,{})}),e(Fe,{path:"/:instance?/a/:id",element:e(Jo,{})}),e(Fe,{path:"/:instance?/p",children:[e(Fe,{index:!0,element:e(cn,{})}),e(Fe,{path:"l",element:e(cn,{local:!0})})]}),e(Fe,{path:"/:instance?/trending",element:e(Os,{})}),e(Fe,{path:"/:instance?/search",element:e(Fs,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));di(e(li,{children:e(Na,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-2E-xdSO4.js.map
